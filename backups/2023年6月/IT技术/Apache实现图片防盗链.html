---
title: Apache实现图片防盗链
updated: 2013-03-12 03:24:54Z
created: 2013-03-12 03:24:54Z
---




<en-note STYLE="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">
Apache实现图片防盗链<br/><br/>
Apache实现图片防盗链以及，显示一张&ldquo;禁止盗链&rdquo;的图片，我们可以用mod_rewrite 来实现。<br/>
假设充许连结图片的主机域名为：www.php100.com<br/>
修改httpd.conf<br/>
SetEnvIfNoCase Referer &quot;^&quot; local_ref=1<br/>
&lt;FilesMatch &quot;.(gif|jpg)&quot;&gt;<br/>
Order Allow,Deny<br/>
Allow from env=local_ref<br/>
&lt;/FilesMatch&gt;<br/><br/><br/>
这个简单的应用不光可以解决图片盗链的问题，稍加修改还可以防止任意文件盗链下载的问题。<br/>
使用以上的方法当从非指定的主机连结图片时，图片将无法显示。<br/>
如果希望显示一张&ldquo;禁止盗链&rdquo;的图片，我们可以用mod_rewrite 来实现。<br/>
首先在安装 apache 时要加上 --enable-rewrite 参数加载 mod_rewrite 模组。<br/>
假设&ldquo;禁止盗链&rdquo;的图片为abc.gif，我们在 httpd.conf 中可以这样配置：<br/>
RewriteEngine on<br/>
RewriteCond %{HTTP_REFERER} !^$<br/>
RewriteCond %{HTTP_REFERER} !^http://(www\.)?demo.com.cn /.*$ [NC]<br/>
RewriteRule \.(gif|jpg)$ abc.gif [R,L]<br/>
DocumentRoot &quot;/usr/local/apache/htdocs&quot;<br/>
#设置存放站点html文件的目录。<br/>
&lt;Directory /&gt;<br/>
Options FollowSymLinks<br/>
AllowOverride None<br/>
&lt;/Directory&gt;<br/>
#设置/目录的指令。具体地说明：<br/>
Option：定义在目录内所能执行的操作。<br/>
None：表示只能浏览，<br/>
FollowSymLinks：允许页面连接到别处，<br/>
ExecCGI：允许执行CGI，<br/>
MultiViews：允许看动画或是听音乐之类的操作，<br/>
Indexes：允许服务器返回目录的格式化列表，<br/>
Includes：允许使用SSI。这些设置可以复选。<br/>
All：则可以做任何事，但不包括MultiViews。<br/>
AllowOverride：加None参数表示任何人都可以浏览该目录下的文件。<br/>
另外的参数有：FileInfo、AuthConfig、Limit。
</en-note>      