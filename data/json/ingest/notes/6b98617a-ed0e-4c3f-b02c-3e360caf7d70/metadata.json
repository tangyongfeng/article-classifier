{
  "ingest_source": {
    "id": "bd378dfd-c57b-41bf-ab87-948232ba0962",
    "source_type": "evernote_html",
    "source_path": "/Users/tang/workbench/article-classifier/backups/2023年6月/IT技术/线性同余产生不重复的随机数.html",
    "collected_at": "2025-11-09T20:05:15.360325Z",
    "external_id": null,
    "title_hint": null,
    "language_hint": "zh-cn",
    "captured_at": null,
    "checksum": "5f8fe19a5cf824e20b7c4c17ccbc013f3e7ceec41e09596a1a05dd022b54fb13",
    "status": "pending",
    "notes": {
      "batch_id": null
    }
  },
  "note": {
    "id": "6b98617a-ed0e-4c3f-b02c-3e360caf7d70",
    "ingest_source_id": "bd378dfd-c57b-41bf-ab87-948232ba0962",
    "canonical_title": "线性同余产生不重复的随机数",
    "language": "zh-cn",
    "ingested_at": "2025-11-09T20:05:15.360329Z",
    "created_at": null,
    "status": "active",
    "importance": 0,
    "attributes": {
      "source_filename": "线性同余产生不重复的随机数.html"
    }
  },
  "variants": [
    {
      "id": "a927a5df-de74-443f-8c1e-af69dda3afb6",
      "note_id": "6b98617a-ed0e-4c3f-b02c-3e360caf7d70",
      "variant_type": "raw_html",
      "version": 1,
      "created_by": "evernote_ingest:v0",
      "created_at": "2025-11-09T20:05:15.360332Z",
      "content": "---\ntitle: 线性同余产生不重复的随机数\nupdated: 2017-11-24 16:49:35Z\ncreated: 2017-11-24 16:49:20Z\nsource: http://www.cnblogs.com/zrhai/p/4071023.html\nauthor: tangyongfeng@gmail.com\ntags:\n  - 算法\n---\n\n\n\n\n<en-note><div><h2 STYLE=\"margin: 0px 0px 4px; font-size: 20px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);\"><a HREF=\"http://www.cnblogs.com/zrhai/p/4071023.html\" STYLE=\"font-size: 20px; color: rgb(34, 51, 85); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);\">团购码，你知多少？&mdash;&mdash;线性同余产生随机数</a></h2><div STYLE=\"margin-bottom: 20px; word-break: break-word; font-size: 9pt;\"><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">在互联网时代，经常会有产生【随机数】的应用场景。</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">比如说最常见的团购业务，用户购买一张团购券，然后客户的手机中会接收到一个随机的团购码。客户拿着这个团购码去门店验证消费。</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">相面大家都对上面的这种方式比较熟悉。如果站上技术的角度，我们来分析一下这个【团购码】其实还是有很多细节在里面的。接下来我们来对这部分细节进行探讨。</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">&nbsp;</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">假设用点击领用团购码，产生一个10000 以内的随机数。该数字发到用户手机上，作为验证凭证。</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">那么这个团购码需要满足下面的几个条件：</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">1：每次都是随机产生，用户不能轻易猜测到下一个验证码。</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">2：团购码的数值范围必需【00001，10000】。&mdash;&mdash;实际中这个数字会比较大。</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">3：用户领用的团购码是决对唯一的，即产生的每个数字，只会出现一次。不会存在多个用户领用同一个验证码的情况。</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">上面条件的技术难点在于</span><span STYLE=\"text-indent: 0px; font-weight: bold; font-size: 9pt;\">如何生成不重复的随机数</span><span STYLE=\"text-indent: 0px; font-size: 9pt;\">？</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">大家知道，一般我们用的编程语言所提供的随机数方法，都不能保证下一次的随机数和前面的不重复。即我们生成了100个随机数里面，就可能会有N个是重复。</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">那么如何保证其不重复性? 很容易想到的方案是，每次生成一个新的随机数后，再去和前面的所有的随机数进行比较，如果重复则抛弃。</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">但是这样做好么？</span><span STYLE=\"text-indent: 0px; font-weight: bold; font-size: 9pt;\">假设要生成1000个随机数，每次都和前面的进行比较好像问题不大。要是要1亿的范围呢？</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">我有个朋友正好在一家知明的团购公司工作，我向他了解下他们公司生成团购码的方法。</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">总体思路是：</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">1：生成一批待用的码放在码池中。用的是编程语言所提供的随机数方法。</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">2：用户领用码后，生成一条领用记录，并且码池中除非该码。</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">3：定期检查码池，生成新的码放入池中。</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><img src=\"../_resources/cc229dc7d4600eaec76c54fd097b6711.png\"  hash=\"cc229dc7d4600eaec76c54fd097b6711\" style=\"border: 0px; max-width: 900px; font-size: 9pt;\" type=\"image/png\" alt=\"\" /></en-media></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">同样面临重复码的问题。如果两个用户a,b 在不同时间段领到了相同的团购码。用户a 比用户 b 更先一步去门店消费，然后更新该团购码的状态。那么用户b的那个码也会更新，则用户b来消费的时候会发现该码已经被用了。</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">他们如何解决这个问题，在步骤1 批量生成码的时想，先check码池的所有记录是否重复。当然最好再和用户领用记录check一下。</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">这样会带来性能上的很大消耗。或许可以想一些办法可以减少这方面的损失，比如码池放更多的码，过期的领用的记录及时清理。</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">更多的具体细节，不再去深入。</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">&nbsp;</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">上面的做法，多多少少不是很理想。没有在关键点上解决问题&mdash;&mdash;</span><span STYLE=\"text-indent: 0px; font-weight: bold; font-size: 9pt;\">用一种算法每次生成一个和前面不重复的随机数。</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">&nbsp;</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">基于上述类似场景，提供一个《线性同余产生随机数》算法，每次生成一个不重复的随机数。</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">算法参考：<a HREF=\"http://www.asmedu.net/algorithm.jsp?index=46\">http://www.asmedu.net/algorithm.jsp?index=46</a></span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">&nbsp;</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">线性同余产生随机数算法解析：</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">Xn+1&nbsp;=&nbsp;（&nbsp;a * Xn&nbsp;+&nbsp;c&nbsp;）&nbsp;mod&nbsp;&nbsp;m&nbsp;，n&nbsp;&gt;=&nbsp;0</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">其中：&nbsp; 0&nbsp;&lt;&nbsp;m ;0&nbsp;&lt;=&nbsp;a&lt;m ;&nbsp; 0&nbsp;&lt;=c&lt;m&nbsp;</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">开始指定一个X0( 0&lt;=X0&lt;m )，依赖上次的值Xn，每次得到一个数Xn+1。根据这个算法所求的随机数序列{X0,X1,...Xn}，称作</span><span STYLE=\"text-indent: 0px; font-weight: bold; font-size: 9pt;\">线性同余序列</span><span STYLE=\"text-indent: 0px; font-size: 9pt;\">。&nbsp;</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">同余序列总是进入一个循环，它最终必定在n个数之间无休止的重复循环。它的</span><span STYLE=\"text-indent: 0px; font-weight: bold; font-size: 9pt;\">最大循环周期为m</span><span STYLE=\"text-indent: 0px; font-size: 9pt;\">。&nbsp;</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><div STYLE=\"font-size: 9pt;\"><span STYLE=\"font-size: 9pt;\">得到最大的周期m的条件如下：&nbsp;</span></div><div STYLE=\"font-size: 9pt;\"><span STYLE=\"font-size: 9pt;\">（1）c与m为互质数。&nbsp;</span></div><div STYLE=\"font-size: 9pt;\"><span STYLE=\"font-size: 9pt;\">（2）对于整除m的每个素数p，b=a-1是p的倍数。&nbsp;</span></div><div STYLE=\"-en-paragraph: true; margin-top: 1em; margin-bottom: 1em; font-size: 9pt;\"><span STYLE=\"-en-paragraph: true; font-size: 9pt;\">（3）如果m是4的倍数，则b也是4的倍数。&nbsp;</span></div></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">&nbsp;</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">以取10000个 随机数为例，m = 10000;按最大的周期条件设定</span><span STYLE=\"text-indent: 0px; font-style: italic; font-size: 9pt;\">c = 3;</span><span STYLE=\"text-indent: 0px; font-style: italic; line-height: 1.5; font-size: 9pt;\">&nbsp;a = 21; x0=4。</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">代码如下：</span></div><div STYLE=\"background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot; !important; font-size: 12px !important;\"><div STYLE=\"margin-top: 5px; background-color: rgb(245, 245, 245); font-size: 9pt;\"><img src=\"../_resources/51e409b11aa51c150090697429a953ed.gif\"  hash=\"51e409b11aa51c150090697429a953ed\" style=\"border: none !important; background-color: rgb(245, 245, 245) !important; max-width: 900px; font-size: 9pt;\" type=\"image/gif\" alt=\"\" /></en-media></div><div STYLE=\"margin: 0px 0px 0px 22px; white-space: pre-wrap; word-wrap: break-word; font-size: 12px !important; font-family: &quot;Courier New&quot; !important;\"><div STYLE=\"font-size: 9pt;\"><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128);\">1</span> <span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255);\">public</span> <span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255);\">static</span> <span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255);\">void</span> <span STYLE=\"font-size: 9pt;\">RandomGenerator(</span><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255);\">ref</span> <span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255);\">long</span> <span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);\">previousVaule)</span></div><div STYLE=\"font-size: 9pt;\"><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128);\">2</span> <span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);\">{</span></div><div STYLE=\"font-size: 9pt;\"><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128);\">3</span> <span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0);\">//</span><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0);\">Xn+1 = （ aXn + c ） mod m ，n &gt;= 0</span> <span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128);\">4</span> <span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255);\">long</span> <span STYLE=\"font-size: 9pt;\">m =</span> <span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128);\">10000L</span><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);\">;</span></div><div STYLE=\"font-size: 9pt;\"><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128);\">5</span> <span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255);\">long</span> <span STYLE=\"font-size: 9pt;\">c =</span> <span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128);\">3L</span><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);\">;</span></div><div STYLE=\"font-size: 9pt;\"><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128);\">6</span> <span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255);\">long</span> <span STYLE=\"font-size: 9pt;\">a =</span> <span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128);\">21L</span><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);\">;</span></div><div STYLE=\"font-size: 9pt;\"><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128);\">7</span></div><div STYLE=\"font-size: 9pt;\"><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128);\">8</span> <span STYLE=\"font-size: 9pt;\">previousVaule = (a * previousVaule + c) %</span> <span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);\">m;</span></div><div STYLE=\"font-size: 9pt;\"><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128);\">9</span> <span STYLE=\"font-size: 9pt;\">}</span></div></div><div STYLE=\"margin-top: 5px; background-color: rgb(245, 245, 245); font-size: 9pt;\"><img src=\"../_resources/51e409b11aa51c150090697429a953ed.gif\"  hash=\"51e409b11aa51c150090697429a953ed\" style=\"border: none !important; background-color: rgb(245, 245, 245) !important; max-width: 900px; font-size: 9pt;\" type=\"image/gif\" alt=\"\" /></en-media></div></div><div STYLE=\"background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot; !important; font-size: 12px !important;\"><div STYLE=\"margin-top: 5px; background-color: rgb(245, 245, 245); font-size: 9pt;\"><img src=\"../_resources/51e409b11aa51c150090697429a953ed.gif\"  hash=\"51e409b11aa51c150090697429a953ed\" style=\"border: none !important; background-color: rgb(245, 245, 245) !important; max-width: 900px; font-size: 9pt;\" type=\"image/gif\" alt=\"\" /></en-media></div><div STYLE=\"margin: 0px 0px 0px 22px; white-space: pre-wrap; word-wrap: break-word; font-size: 12px !important; font-family: &quot;Courier New&quot; !important;\"><div STYLE=\"font-size: 9pt;\"><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255);\">long</span> <span STYLE=\"font-size: 9pt;\">ab =</span> <span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128);\">4</span><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);\">;</span></div><div STYLE=\"font-size: 9pt;\"><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);\">HashSet</span><span STYLE=\"font-size: 9pt;\">&lt;</span><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255);\">long</span><span STYLE=\"font-size: 9pt;\">&gt; hash =</span> <span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255);\">new</span> <span STYLE=\"font-size: 9pt;\">HashSet&lt;</span><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255);\">long</span><span STYLE=\"font-size: 9pt;\">&gt;</span><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);\">();</span></div><div STYLE=\"font-size: 9pt;\"><br STYLE=\"font-size: 9pt;\"/></div><div STYLE=\"font-size: 9pt;\"><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255);\">for</span> <span STYLE=\"font-size: 9pt;\">(</span><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255);\">int</span> <span STYLE=\"font-size: 9pt;\">i =</span> <span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128);\">0</span><span STYLE=\"font-size: 9pt;\">; i &lt;</span> <span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128);\">10000</span><span STYLE=\"font-size: 9pt;\">; i++</span><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);\">)</span></div><div STYLE=\"font-size: 9pt;\"><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);\">{</span></div><div STYLE=\"font-size: 9pt;\"><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);\">RandomGenerator(</span><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255);\">ref</span> <span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);\">ab);</span></div><div STYLE=\"font-size: 9pt;\"><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);\">hash.Add(ab);</span></div><div STYLE=\"font-size: 9pt;\"><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);\">Console.WriteLine(ab);</span></div><div STYLE=\"font-size: 9pt;\"><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);\">}</span></div><div STYLE=\"font-size: 9pt;\"><span STYLE=\"font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);\">Console.WriteLine(&quot;总数：&quot;+hash.Count);</span></div></div><div STYLE=\"margin-top: 5px; background-color: rgb(245, 245, 245); font-size: 9pt;\"><img src=\"../_resources/51e409b11aa51c150090697429a953ed.gif\"  hash=\"51e409b11aa51c150090697429a953ed\" style=\"border: none !important; background-color: rgb(245, 245, 245) !important; max-width: 900px; font-size: 9pt;\" type=\"image/gif\" alt=\"\" /></en-media></div></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">运行结果：</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><img src=\"../_resources/674e1e8f0f9146b06af3469eadcdb812.jpg\"  hash=\"674e1e8f0f9146b06af3469eadcdb812\" style=\"border: 0px; max-width: 900px; font-size: 9pt;\" type=\"image/jpeg\" alt=\"\" /></en-media></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">经测试可以验证，10000次随机将穷举所有&lt; 10000的数字不会发生重复。现实应用中，还要解决分布式情况下，对上次的值Xn依赖的争用问题。</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">最后，大家可能还是有疑问。这样的随机码冒似可以破解。这批随机码是有规率的对吗？</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">所以最后对每次批量生成的码，要再把它们的顺序打乱一下再存到池中。</span></div><div STYLE=\"margin: 10px auto; text-indent: 0px; font-size: 9pt;\"><span STYLE=\"text-indent: 0px; font-size: 9pt;\">最重要的是下批量生成的码将不会和前面的重复。</span></div></div><div><br/></div></div></en-note>      ",
      "content_path": null,
      "diff_base_variant_id": null,
      "metadata": {
        "checksum": "5f8fe19a5cf824e20b7c4c17ccbc013f3e7ceec41e09596a1a05dd022b54fb13",
        "path": "/Users/tang/workbench/article-classifier/backups/2023年6月/IT技术/线性同余产生不重复的随机数.html"
      }
    },
    {
      "id": "245991df-d4ca-403f-b4dc-14402be0ff4c",
      "note_id": "6b98617a-ed0e-4c3f-b02c-3e360caf7d70",
      "variant_type": "clean_text",
      "version": 1,
      "created_by": "evernote_ingest:v0",
      "created_at": "2025-11-09T20:05:15.360334Z",
      "content": "---\ntitle: 线性同余产生不重复的随机数\nupdated: 2017-11-24 16:49:35Z\ncreated: 2017-11-24 16:49:20Z\nsource: http://www.cnblogs.com/zrhai/p/4071023.html\nauthor: tangyongfeng@gmail.com\ntags:\n  - 算法\n---\n\n团购码，你知多少？——线性同余产生随机数\n在互联网时代，经常会有产生【随机数】的应用场景。\n比如说最常见的团购业务，用户购买一张团购券，然后客户的手机中会接收到一个随机的团购码。客户拿着这个团购码去门店验证消费。\n相面大家都对上面的这种方式比较熟悉。如果站上技术的角度，我们来分析一下这个【团购码】其实还是有很多细节在里面的。接下来我们来对这部分细节进行探讨。\n \n假设用点击领用团购码，产生一个10000 以内的随机数。该数字发到用户手机上，作为验证凭证。\n那么这个团购码需要满足下面的几个条件：\n1：每次都是随机产生，用户不能轻易猜测到下一个验证码。\n2：团购码的数值范围必需【00001，10000】。——实际中这个数字会比较大。\n3：用户领用的团购码是决对唯一的，即产生的每个数字，只会出现一次。不会存在多个用户领用同一个验证码的情况。\n上面条件的技术难点在于\n如何生成不重复的随机数\n？\n大家知道，一般我们用的编程语言所提供的随机数方法，都不能保证下一次的随机数和前面的不重复。即我们生成了100个随机数里面，就可能会有N个是重复。\n那么如何保证其不重复性? 很容易想到的方案是，每次生成一个新的随机数后，再去和前面的所有的随机数进行比较，如果重复则抛弃。\n但是这样做好么？\n假设要生成1000个随机数，每次都和前面的进行比较好像问题不大。要是要1亿的范围呢？\n我有个朋友正好在一家知明的团购公司工作，我向他了解下他们公司生成团购码的方法。\n总体思路是：\n1：生成一批待用的码放在码池中。用的是编程语言所提供的随机数方法。\n2：用户领用码后，生成一条领用记录，并且码池中除非该码。\n3：定期检查码池，生成新的码放入池中。\n同样面临重复码的问题。如果两个用户a,b 在不同时间段领到了相同的团购码。用户a 比用户 b 更先一步去门店消费，然后更新该团购码的状态。那么用户b的那个码也会更新，则用户b来消费的时候会发现该码已经被用了。\n他们如何解决这个问题，在步骤1 批量生成码的时想，先check码池的所有记录是否重复。当然最好再和用户领用记录check一下。\n这样会带来性能上的很大消耗。或许可以想一些办法可以减少这方面的损失，比如码池放更多的码，过期的领用的记录及时清理。\n更多的具体细节，不再去深入。\n \n上面的做法，多多少少不是很理想。没有在关键点上解决问题——\n用一种算法每次生成一个和前面不重复的随机数。\n \n基于上述类似场景，提供一个《线性同余产生随机数》算法，每次生成一个不重复的随机数。\n算法参考：\nhttp://www.asmedu.net/algorithm.jsp?index=46\n \n线性同余产生随机数算法解析：\nXn+1 = （ a * Xn + c ） mod  m ，n >= 0\n其中：  0 < m ;0 <= a<m ;  0 <=c<m \n开始指定一个X0( 0<=X0<m )，依赖上次的值Xn，每次得到一个数Xn+1。根据这个算法所求的随机数序列{X0,X1,...Xn}，称作\n线性同余序列\n。 \n同余序列总是进入一个循环，它最终必定在n个数之间无休止的重复循环。它的\n最大循环周期为m\n。 \n得到最大的周期m的条件如下： \n（1）c与m为互质数。 \n（2）对于整除m的每个素数p，b=a-1是p的倍数。 \n（3）如果m是4的倍数，则b也是4的倍数。 \n \n以取10000个 随机数为例，m = 10000;按最大的周期条件设定\nc = 3;\n a = 21; x0=4。\n代码如下：\n1\n\npublic\n\nstatic\n\nvoid\n\nRandomGenerator(\nref\n\nlong\n\npreviousVaule)\n2\n\n{\n3\n\n//\nXn+1 = （ aXn + c ） mod m ，n >= 0\n\n4\n\nlong\n\nm =\n\n10000L\n;\n5\n\nlong\n\nc =\n\n3L\n;\n6\n\nlong\n\na =\n\n21L\n;\n7\n8\n\npreviousVaule = (a * previousVaule + c) %\n\nm;\n9\n\n}\nlong\n\nab =\n\n4\n;\nHashSet\n<\nlong\n> hash =\n\nnew\n\nHashSet<\nlong\n>\n();\nfor\n\n(\nint\n\ni =\n\n0\n; i <\n\n10000\n; i++\n)\n{\nRandomGenerator(\nref\n\nab);\nhash.Add(ab);\nConsole.WriteLine(ab);\n}\nConsole.WriteLine(\"总数：\"+hash.Count);\n运行结果：\n经测试可以验证，10000次随机将穷举所有< 10000的数字不会发生重复。现实应用中，还要解决分布式情况下，对上次的值Xn依赖的争用问题。\n最后，大家可能还是有疑问。这样的随机码冒似可以破解。这批随机码是有规率的对吗？\n所以最后对每次批量生成的码，要再把它们的顺序打乱一下再存到池中。\n最重要的是下批量生成的码将不会和前面的重复。",
      "content_path": null,
      "diff_base_variant_id": null,
      "metadata": {
        "language": "zh-cn",
        "length": 2271,
        "rule_count": 1,
        "applied_rules": [
          {
            "rule_id": "whitespace",
            "description": "Normalize whitespace",
            "note": "collapsed whitespace"
          }
        ]
      }
    }
  ],
  "extractions": [],
  "journal": {
    "id": "1e67a0b6-aaa1-4679-b5fe-6cdbe20ca34f",
    "note_id": "6b98617a-ed0e-4c3f-b02c-3e360caf7d70",
    "stage": "ingest",
    "agent_id": "evernote_ingest:v0",
    "started_at": "2025-11-09T20:05:15.360339Z",
    "finished_at": "2025-11-09T20:05:15.360340Z",
    "status": "success",
    "input_ref": {
      "task_id": "ace77b07-1c05-42e8-8022-75c50dae8f7e",
      "source_path": "/Users/tang/workbench/article-classifier/backups/2023年6月/IT技术/线性同余产生不重复的随机数.html",
      "checksum": "5f8fe19a5cf824e20b7c4c17ccbc013f3e7ceec41e09596a1a05dd022b54fb13"
    },
    "output_ref": {
      "ingest_source": "bd378dfd-c57b-41bf-ab87-948232ba0962",
      "note": "6b98617a-ed0e-4c3f-b02c-3e360caf7d70",
      "variants": [
        "a927a5df-de74-443f-8c1e-af69dda3afb6",
        "245991df-d4ca-403f-b4dc-14402be0ff4c"
      ]
    },
    "error_detail": null
  }
}