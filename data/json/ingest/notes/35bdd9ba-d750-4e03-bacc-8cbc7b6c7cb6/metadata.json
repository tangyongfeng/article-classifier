{
  "ingest_source": {
    "id": "28989e07-01e3-45e0-8da2-babeb9491221",
    "source_type": "evernote_html",
    "source_path": "backups/2023年6月/个人的乱78糟/mysql 创建表的时候 COLLATE 干嘛的.html",
    "collected_at": "2025-11-10T15:43:33.522524Z",
    "external_id": null,
    "title_hint": null,
    "language_hint": "ca",
    "captured_at": null,
    "checksum": "6a2bdeb573f1544d8669abc7eda70d9910e031b1d64f9f780dd6690f3b12d9fa",
    "status": "pending",
    "notes": {
      "batch_id": "phase2-backfill-202306"
    }
  },
  "note": {
    "id": "35bdd9ba-d750-4e03-bacc-8cbc7b6c7cb6",
    "ingest_source_id": "28989e07-01e3-45e0-8da2-babeb9491221",
    "canonical_title": "mysql 创建表的时候 COLLATE 干嘛的",
    "language": "ca",
    "ingested_at": "2025-11-10T15:43:33.522528Z",
    "created_at": null,
    "status": "active",
    "importance": 0,
    "attributes": {
      "source_filename": "mysql 创建表的时候 COLLATE 干嘛的.html"
    }
  },
  "variants": [
    {
      "id": "cdcd7282-2b6c-45a6-8332-9e8eccce1396",
      "note_id": "35bdd9ba-d750-4e03-bacc-8cbc7b6c7cb6",
      "variant_type": "raw_html",
      "version": 1,
      "created_by": "evernote_ingest:v0",
      "created_at": "2025-11-10T15:43:33.522530Z",
      "content": "---\ntitle: mysql 创建表的时候 COLLATE 干嘛的\nupdated: 2021-05-20 11:46:17Z\ncreated: 2021-05-20 11:37:04Z\nauthor: tangyongfeng@gmail.com\n---\n\n\n<en-note><div><br/></div><div><h1><span STYLE=\"-en-paragraph:true;\">在 mysql 中执行</span><span STYLE=\"-en-paragraph:true;\">show create table &lt;tablename&gt;</span><span STYLE=\"-en-paragraph:true;\">指令，可以看到一张表的建表语句，example 如下：</span></h1><table STYLE=\"border-collapse: collapse; min-width: 100%;\"><colgroup><col STYLE=\"width: 650px;\"/></colgroup><tbody><tr><td STYLE=\"width: 650px; padding: 8px; border: 1px solid;\"><div><span STYLE=\"font-weight: normal;\">CREATE</span><span STYLE=\"font-weight: normal;\"> </span><span STYLE=\"font-weight: normal;\">TABLE</span><span STYLE=\"font-weight: normal;\"> table_name(</span></div><div><span STYLE=\"font-weight: normal;\"> &nbsp; &nbsp; column_name_1 data_type </span><span STYLE=\"font-weight: normal;\">default</span><span STYLE=\"font-weight: normal;\"> </span><span STYLE=\"font-weight: normal;\">value</span><span STYLE=\"font-weight: normal;\"> column_constraint,</span></div><div><span STYLE=\"font-weight: normal;\"> &nbsp; &nbsp; column_name_2 data_type </span><span STYLE=\"font-weight: normal;\">default</span><span STYLE=\"font-weight: normal;\"> </span><span STYLE=\"font-weight: normal;\">value</span><span STYLE=\"font-weight: normal;\"> column_constraint,</span></div><div><span STYLE=\"font-weight: normal;\"> &nbsp; &nbsp; ...,</span></div><div><span STYLE=\"font-weight: normal;\"> &nbsp; &nbsp; table_constraint</span></div><div><span STYLE=\"font-weight: normal;\">) &nbsp; </span><span STYLE=\"font-weight: normal;\">ENGINE</span><span STYLE=\"font-weight: normal;\">=</span><span STYLE=\"font-weight: normal;\">InnoDB</span></div><div><span STYLE=\"font-weight: normal;\"> &nbsp;&nbsp; </span><span STYLE=\"font-weight: normal;\">DEFAULT</span><span STYLE=\"font-weight: normal;\"> </span><span STYLE=\"font-weight: normal;\">CHARSET</span><span STYLE=\"font-weight: normal;\">=utf8mb4</span></div><div><span STYLE=\"font-weight: normal;\"> &nbsp;&nbsp; </span><span STYLE=\"font-weight: normal;\">COLLATE</span><span STYLE=\"font-weight: normal;\">=utf8_unicode_ci;</span></div></td></tr></tbody></table><div><span STYLE=\"-en-paragraph:true;\">复制代码大部分字段我们都能看懂，但是今天要讨论的是 </span><span STYLE=\"-en-paragraph:true;\">COLLATE</span><span STYLE=\"-en-paragraph:true;\"> 关键字。这个值后面对应的 </span><span STYLE=\"-en-paragraph:true;\">utf8_unicode_ci</span><span STYLE=\"-en-paragraph:true;\"> 是什么意思呢？面试的时候用这个题目考一考 DBA，应该可以难倒一大部分人。\n</span></div><h2><span STYLE=\"font-weight: bold;\">COLLATE 是用来做什么的？\n</span></h2><div><span STYLE=\"-en-paragraph:true;\">使用</span><span STYLE=\"-en-paragraph:true;\">phpmyadmin</span><span STYLE=\"-en-paragraph:true;\">的开发可能会非常眼熟，因为其中的中文表头已经给出了答案：\n</span></div><div><br/></div><div>所谓 utf8_unicode_ci，其实是用来排序的规则。对于 mysql 中那些字符类型的列，如 VARCHAR，CHAR，TEXT 类型的列，都需要有一个 COLLATE 类型来告知 mysql <span STYLE=\"font-weight: bold;\">如何对该列进行排序和比较</span>。</div><div><span STYLE=\"-en-paragraph:true;\">简而言之，</span><span STYLE=\"-en-paragraph:true;\">COLLATE</span><span STYLE=\"-en-paragraph:true;\"> 会影响到 </span><span STYLE=\"-en-paragraph:true;\">ORDER BY</span><span STYLE=\"-en-paragraph:true;\"> 语句的顺序，会影响到 </span><span STYLE=\"-en-paragraph:true;\">WHERE</span><span STYLE=\"-en-paragraph:true;\"> 条件中大于小于号筛选出来的结果，会影响</span><span STYLE=\"font-weight: bold;-en-paragraph:true;\">DISTINCT</span><span STYLE=\"-en-paragraph:true;\">、</span><span STYLE=\"font-weight: bold;-en-paragraph:true;\">GROUP BY</span><span STYLE=\"-en-paragraph:true;\">、</span><span STYLE=\"font-weight: bold;-en-paragraph:true;\">HAVING</span><span STYLE=\"-en-paragraph:true;\">语句的查询结果。另外，mysql 建索引的时候，如果索引列是字符类型，</span><span STYLE=\"font-weight: bold;-en-paragraph:true;\">也会影响索引创建</span><span STYLE=\"-en-paragraph:true;\">，只不过这种影响我们感知不到。</span><span STYLE=\"font-weight: bold;-en-paragraph:true;\">总之，凡是涉及到字符类型比较或排序的地方</span><span STYLE=\"-en-paragraph:true;\">，都会和 COLLATE 有关。\n</span></div><h2><span STYLE=\"font-weight: bold;\">各种 COLLATE 的区别\n</span></h2><div><span STYLE=\"-en-paragraph:true;\">COLLATE</span><span STYLE=\"-en-paragraph:true;\">通常是和数据编码（</span><span STYLE=\"-en-paragraph:true;\">CHARSET</span><span STYLE=\"-en-paragraph:true;\">）相关的，一般来说每种</span><span STYLE=\"-en-paragraph:true;\">CHARSET</span><span STYLE=\"-en-paragraph:true;\">都有多种它所支持的</span><span STYLE=\"-en-paragraph:true;\">COLLATE</span><span STYLE=\"-en-paragraph:true;\">，并且每种</span><span STYLE=\"-en-paragraph:true;\">CHARSET</span><span STYLE=\"-en-paragraph:true;\">都指定一种</span><span STYLE=\"-en-paragraph:true;\">COLLATE</span><span STYLE=\"-en-paragraph:true;\">为默认值。例如</span><span STYLE=\"-en-paragraph:true;\">Latin1</span><span STYLE=\"-en-paragraph:true;\">编码的默认</span><span STYLE=\"-en-paragraph:true;\">COLLATE</span><span STYLE=\"-en-paragraph:true;\">为</span><span STYLE=\"-en-paragraph:true;\">latin1_swedish_ci</span><span STYLE=\"-en-paragraph:true;\">，</span><span STYLE=\"-en-paragraph:true;\">GBK</span><span STYLE=\"-en-paragraph:true;\">编码的默认</span><span STYLE=\"-en-paragraph:true;\">COLLATE</span><span STYLE=\"-en-paragraph:true;\">为</span><span STYLE=\"-en-paragraph:true;\">gbk_chinese_ci</span><span STYLE=\"-en-paragraph:true;\">，</span><span STYLE=\"-en-paragraph:true;\">utf8mb4</span><span STYLE=\"-en-paragraph:true;\">编码的默认值为</span><span STYLE=\"-en-paragraph:true;\">utf8mb4_general_ci</span><span STYLE=\"-en-paragraph:true;\">。\n</span></div><div><span STYLE=\"-en-paragraph:true;\">这里顺便讲个题外话，</span><span STYLE=\"-en-paragraph:true;\">mysql</span><span STYLE=\"-en-paragraph:true;\">中有</span><span STYLE=\"-en-paragraph:true;\">utf8</span><span STYLE=\"-en-paragraph:true;\">和</span><span STYLE=\"-en-paragraph:true;\">utf8mb4</span><span STYLE=\"-en-paragraph:true;\">两种编码，在 mysql 中请大家忘记</span><span STYLE=\"font-weight: bold;-en-paragraph:true;\">utf8</span><span STYLE=\"-en-paragraph:true;\">，永远使用</span><span STYLE=\"font-weight: bold;-en-paragraph:true;\">utf8mb4</span><span STYLE=\"-en-paragraph:true;\">。这是 mysql 的一个遗留问题，mysql 中的 utf8 最多只能支持 3bytes 长度的字符编码，对于一些需要占据</span><span STYLE=\"font-weight: bold;-en-paragraph:true;\">4bytes</span><span STYLE=\"-en-paragraph:true;\">的文字，mysql 的 utf8 就不支持了，要使用 utf8mb4 才行。\n</span></div><div><span STYLE=\"-en-paragraph:true;\">很多</span><span STYLE=\"-en-paragraph:true;\">COLLATE</span><span STYLE=\"-en-paragraph:true;\">都带有</span><span STYLE=\"-en-paragraph:true;\">_ci</span><span STYLE=\"-en-paragraph:true;\">字样，这是</span><span STYLE=\"-en-paragraph:true;\">Case Insensitive</span><span STYLE=\"-en-paragraph:true;\">的缩写，</span><span STYLE=\"font-weight: bold;-en-paragraph:true;\">即大小写无关</span><span STYLE=\"-en-paragraph:true;\">，也就是说&rdquo;A&rdquo;和&rdquo;a&rdquo;在排序和比较的时候是一视同仁的。</span><span STYLE=\"-en-paragraph:true;\">selection * from table1 where field1=&quot;a&quot;</span><span STYLE=\"-en-paragraph:true;\">同样可以把</span><span STYLE=\"font-weight: bold;-en-paragraph:true;\">field1 为&rdquo;A&rdquo;</span><span STYLE=\"-en-paragraph:true;\">的值选出来。与此同时，对于那些</span><span STYLE=\"-en-paragraph:true;\">_cs</span><span STYLE=\"-en-paragraph:true;\">后缀的</span><span STYLE=\"-en-paragraph:true;\">COLLATE</span><span STYLE=\"-en-paragraph:true;\">，则是</span><span STYLE=\"-en-paragraph:true;\">Case Sensitive</span><span STYLE=\"-en-paragraph:true;\">，</span><span STYLE=\"font-weight: bold;-en-paragraph:true;\">即大小写敏感的</span><span STYLE=\"-en-paragraph:true;\">。\n</span></div><div><span STYLE=\"-en-paragraph:true;\">在 mysql 中使用</span><span STYLE=\"-en-paragraph:true;\">show collation</span><span STYLE=\"-en-paragraph:true;\">指令可以查看到 mysql 所支持的所有</span><span STYLE=\"-en-paragraph:true;\">COLLATE</span><span STYLE=\"-en-paragraph:true;\">。以 utf8mb4 为例，该编码所支持的所有</span><span STYLE=\"-en-paragraph:true;\">COLLATE</span><span STYLE=\"-en-paragraph:true;\">如下图所示。\n</span></div><div><br/></div><div><span STYLE=\"-en-paragraph:true;\">mysql 中和 utf8mb4 相关的所有 COLLATE\n</span></div><div><span STYLE=\"-en-paragraph:true;\">图中我们能看到很多国家的语言自己的排序规则。在国内比较常用的是</span><span STYLE=\"-en-paragraph:true;\">utf8mb4_general_ci</span><span STYLE=\"-en-paragraph:true;\">（默认）、</span><span STYLE=\"-en-paragraph:true;\">utf8mb4_unicode_ci</span><span STYLE=\"-en-paragraph:true;\">、</span><span STYLE=\"-en-paragraph:true;\">utf8mb4_bin</span><span STYLE=\"-en-paragraph:true;\">这三个。我们来探究一下这三个的区别：\n</span></div><div>首先utf8mb4_bin的比较方法其实就是<span STYLE=\"font-weight: bold;\">直接将所有字符看作二进制串，然后从最高位往最低位比对。所以很显然它是区分大小写的</span>。</div><div>而utf8mb4_unicode_ci和utf8mb4_general_ci对于中文和英文来说，其实是没有任何区别的。对于我们开发的国内使用的系统来说，随便选哪个都行。只是对于某些西方国家的字母来说，utf8mb4_unicode_ci会比utf8mb4_general_ci更符合他们的语言习惯一些.</div><div><span STYLE=\"-en-paragraph:true;\">general 是 mysql 一个比较老的标准了。例如，德语字母&ldquo;&szlig;&rdquo;，在</span><span STYLE=\"-en-paragraph:true;\">utf8mb4_unicode_ci</span><span STYLE=\"-en-paragraph:true;\">中是等价于&rdquo;ss&rdquo;两个字母的（这是符合德国人习惯的做法），而在</span><span STYLE=\"-en-paragraph:true;\">utf8mb4_general_ci</span><span STYLE=\"-en-paragraph:true;\">中，它却和字母&ldquo;s&rdquo;等价。不过，这两种编码的那些微小的区别，对于正常的开发来说，很难感知到。本身我们也很少直接用文字字段去排序，退一步说，即使这个字母排错了一两个，真的能给系统带来灾难性后果么？从网上找的各种帖子讨论来说，更多人推荐使用</span><span STYLE=\"-en-paragraph:true;\">utf8mb4_unicode_ci</span><span STYLE=\"-en-paragraph:true;\">，但是对于使用了默认值的系统，也并没有非常排斥，并不认为有什么大问题。\n</span></div><div><span STYLE=\"-en-paragraph:true;\">结论：推荐使用</span><span STYLE=\"-en-paragraph:true;\">utf8mb4_unicode_ci</span><span STYLE=\"-en-paragraph:true;\">，对于已经用了</span><span STYLE=\"-en-paragraph:true;\">utf8mb4_general_ci</span><span STYLE=\"-en-paragraph:true;\">的系统，也没有必要花时间改造。\n</span></div><div><span STYLE=\"-en-paragraph:true;\">另外需要注意的一点是，从</span><span STYLE=\"-en-paragraph:true;\">mysql 8.0</span><span STYLE=\"-en-paragraph:true;\">开始，mysql 默认的</span><span STYLE=\"-en-paragraph:true;\">CHARSET</span><span STYLE=\"-en-paragraph:true;\">已经不再是 Latin1 了，改为了</span><span STYLE=\"-en-paragraph:true;\">utf8mb4</span><a HREF=\"https://dev.mysql.com/doc/refman/8.0/en/charset-applications.html\" STYLE=\"-en-paragraph:true;\">参考链接 10.5 Configuring Application Character Set and Collation</a><span STYLE=\"-en-paragraph:true;\">，并且默认的</span><span STYLE=\"-en-paragraph:true;\">COLLATE</span><span STYLE=\"-en-paragraph:true;\">也改为了</span><span STYLE=\"-en-paragraph:true;\">utf8mb4_0900_ai_ci</span><span STYLE=\"-en-paragraph:true;\">。</span><span STYLE=\"-en-paragraph:true;\">utf8mb4_0900_ai_ci</span><span STYLE=\"-en-paragraph:true;\">大体上就是</span><span STYLE=\"-en-paragraph:true;\">unicode</span><span STYLE=\"-en-paragraph:true;\">的</span><span STYLE=\"font-weight: bold;-en-paragraph:true;\">进一步细分</span><span STYLE=\"-en-paragraph:true;\">，0900 指代 unicode 比较算法的编号（ Unicode Collation Algorithm version），ai 表示 accent insensitive（发音无关），例如 e, &egrave;, &eacute;, &ecirc; 和 &euml; 是一视同仁的。\n</span></div><div><a HREF=\"https://www.monolune.com/what-is-the-utf8mb4_0900_ai_ci-collation/\">What is the utf8mb4_0900_ai_ci Collation?</a></div><div><a HREF=\"https://dev.mysql.com/doc/refman/8.0/en/charset-collation-names.html\" STYLE=\"-en-paragraph:true;\">10.3.1 Collation Naming Conventions</a></div><h2><span STYLE=\"font-weight: bold;\">COLLATE 设置级别及其优先级\n</span></h2><div><span STYLE=\"-en-paragraph:true;\">设置</span><span STYLE=\"-en-paragraph:true;\">COLLATE</span><span STYLE=\"-en-paragraph:true;\">可以在</span><span STYLE=\"font-weight: bold;-en-paragraph:true;\">实例级别</span><span STYLE=\"-en-paragraph:true;\">、</span><span STYLE=\"font-weight: bold;-en-paragraph:true;\">库级别</span><span STYLE=\"-en-paragraph:true;\">、</span><span STYLE=\"font-weight: bold;-en-paragraph:true;\">表级别</span><span STYLE=\"-en-paragraph:true;\">、</span><span STYLE=\"font-weight: bold;-en-paragraph:true;\">列级别</span><span STYLE=\"-en-paragraph:true;\">、以及</span><span STYLE=\"font-weight: bold;-en-paragraph:true;\">SQL 指定</span><span STYLE=\"-en-paragraph:true;\">。\n</span></div><div><span STYLE=\"font-weight: bold;-en-paragraph:true;\">实例级别</span><span STYLE=\"-en-paragraph:true;\">的</span><span STYLE=\"-en-paragraph:true;\">COLLATE</span><span STYLE=\"-en-paragraph:true;\">设置就是 mysql 配置文件或启动指令中的</span><span STYLE=\"-en-paragraph:true;\">collation_connection</span><span STYLE=\"-en-paragraph:true;\">系统变量。\n</span></div><div><span STYLE=\"font-weight: bold;-en-paragraph:true;\">库级别</span><span STYLE=\"-en-paragraph:true;\">设置</span><span STYLE=\"-en-paragraph:true;\">COLLATE</span><span STYLE=\"-en-paragraph:true;\">的语句如下：\n</span></div><table STYLE=\"border-collapse: collapse; min-width: 100%;\"><colgroup><col STYLE=\"width: 973px;\"/></colgroup><tbody><tr><td STYLE=\"width: 973px; padding: 8px; border: 1px solid;\"><div><span STYLE=\"font-weight: normal;\">CREATE</span><span STYLE=\"font-weight: normal;\"> </span><span STYLE=\"font-weight: normal;\">DATABASE</span><span STYLE=\"font-weight: normal;\"> &lt;db_name&gt; </span><span STYLE=\"font-weight: normal;\">DEFAULT</span><span STYLE=\"font-weight: normal;\"> </span><span STYLE=\"font-weight: normal;\">CHARACTER</span><span STYLE=\"font-weight: normal;\"> </span><span STYLE=\"font-weight: normal;\">SET</span><span STYLE=\"font-weight: normal;\"> utf8mb4 </span><span STYLE=\"font-weight: normal;\">COLLATE</span><span STYLE=\"font-weight: normal;\"> utf8mb4_unicode_ci;</span></div></td></tr></tbody></table><div><span STYLE=\"-en-paragraph:true;\">如果</span><span STYLE=\"font-weight: bold;-en-paragraph:true;\">库级别</span><span STYLE=\"-en-paragraph:true;\">没有设置</span><span STYLE=\"-en-paragraph:true;\">CHARSET</span><span STYLE=\"-en-paragraph:true;\">和</span><span STYLE=\"-en-paragraph:true;\">COLLATE</span><span STYLE=\"-en-paragraph:true;\">，则</span><span STYLE=\"font-weight: bold;-en-paragraph:true;\">库级别</span><span STYLE=\"-en-paragraph:true;\">默认的</span><span STYLE=\"-en-paragraph:true;\">CHARSET</span><span STYLE=\"-en-paragraph:true;\">和</span><span STYLE=\"-en-paragraph:true;\">COLLATE</span><span STYLE=\"-en-paragraph:true;\">使用实例级别的设置。在 mysql8.0 以下版本中，你如果什么都不修改，默认的</span><span STYLE=\"-en-paragraph:true;\">CHARSET</span><span STYLE=\"-en-paragraph:true;\">是</span><span STYLE=\"-en-paragraph:true;\">Latin1</span><span STYLE=\"-en-paragraph:true;\">，默认的</span><span STYLE=\"-en-paragraph:true;\">COLLATE</span><span STYLE=\"-en-paragraph:true;\">是</span><span STYLE=\"-en-paragraph:true;\">latin1_swedish_ci</span><span STYLE=\"-en-paragraph:true;\">。从 mysql8.0 开始，默认的</span><span STYLE=\"-en-paragraph:true;\">CHARSET</span><span STYLE=\"-en-paragraph:true;\">已经改为了</span><span STYLE=\"-en-paragraph:true;\">utf8mb4</span><span STYLE=\"-en-paragraph:true;\">，默认的</span><span STYLE=\"-en-paragraph:true;\">COLLATE</span><span STYLE=\"-en-paragraph:true;\">改为了</span><span STYLE=\"-en-paragraph:true;\">utf8mb4_0900_ai_ci</span><span STYLE=\"-en-paragraph:true;\">。\n</span></div><div><span STYLE=\"font-weight: bold;-en-paragraph:true;\">表级别</span><span STYLE=\"-en-paragraph:true;\">的</span><span STYLE=\"-en-paragraph:true;\">COLLATE</span><span STYLE=\"-en-paragraph:true;\">设置，则是在</span><span STYLE=\"-en-paragraph:true;\">CREATE TABLE</span><span STYLE=\"-en-paragraph:true;\">的时候加上相关设置语句，例如：\n</span></div><table STYLE=\"border-collapse: collapse; min-width: 100%;\"><colgroup><col STYLE=\"width: 1036px;\"/></colgroup><tbody><tr><td STYLE=\"width: 1036px; padding: 8px; border: 1px solid;\"><div><span STYLE=\"font-weight: normal;\">CREATE</span><span STYLE=\"font-weight: normal;\"> </span><span STYLE=\"font-weight: normal;\">TABLE</span><span STYLE=\"font-weight: normal;\"> (</span></div><div><span STYLE=\"font-weight: normal;\">&hellip;&hellip;</span></div><div><span STYLE=\"font-weight: normal;\">) </span><span STYLE=\"font-weight: normal;\">ENGINE</span><span STYLE=\"font-weight: normal;\">=</span><span STYLE=\"font-weight: normal;\">InnoDB</span></div><div><span STYLE=\"font-weight: normal;\">DEFAULT</span><span STYLE=\"font-weight: normal;\"> </span><span STYLE=\"font-weight: normal;\">CHARSET</span><span STYLE=\"font-weight: normal;\">=utf8mb4</span></div><div><span STYLE=\"font-weight: normal;\">COLLATE</span><span STYLE=\"font-weight: normal;\">=utf8mb4_unicode_ci</span></div><div><span STYLE=\"font-weight: normal;\">COMMENT</span><span STYLE=\"font-weight: normal;\"> =</span><span STYLE=\"font-weight: normal;\">&apos;XX表&apos;</span><span STYLE=\"font-weight: normal;\">;</span></div></td></tr></tbody></table><div><span STYLE=\"-en-paragraph:true;\">复制代码如果表级别没有设置 CHARSET 和 COLLATE，则表级别会继承库级别的 CHARSET 与 COLLATE。\n</span></div><div><span STYLE=\"font-weight: bold;-en-paragraph:true;\">列级别</span><span STYLE=\"-en-paragraph:true;\">的设置，则也在在</span><span STYLE=\"-en-paragraph:true;\">CREATE TABLE</span><span STYLE=\"-en-paragraph:true;\">中声明列的时候指定，例如\n</span></div><table STYLE=\"border-collapse: collapse; min-width: 100%;\"><colgroup><col STYLE=\"width: 1024px;\"/></colgroup><tbody><tr><td STYLE=\"width: 1024px; padding: 8px; border: 1px solid;\"><div><span STYLE=\"font-weight: normal;\">CREATE</span><span STYLE=\"font-weight: normal;\"> </span><span STYLE=\"font-weight: normal;\">TABLE</span><span STYLE=\"font-weight: normal;\"> (</span></div><div><br/></div><div><span STYLE=\"font-weight: normal;\">`field1`</span><span STYLE=\"font-weight: normal;\"> </span><span STYLE=\"font-weight: normal;\">VARCHAR</span><span STYLE=\"font-weight: normal;\">（</span><span STYLE=\"font-weight: normal;\">64</span><span STYLE=\"font-weight: normal;\">） </span><span STYLE=\"font-weight: normal;\">CHARACTER</span><span STYLE=\"font-weight: normal;\"> </span><span STYLE=\"font-weight: normal;\">SET</span><span STYLE=\"font-weight: normal;\"> utf8mb4 </span><span STYLE=\"font-weight: normal;\">COLLATE</span><span STYLE=\"font-weight: normal;\"> utf8mb4_general_ci </span><span STYLE=\"font-weight: normal;\">NOT</span><span STYLE=\"font-weight: normal;\"> </span><span STYLE=\"font-weight: normal;\">NULL</span><span STYLE=\"font-weight: normal;\"> </span><span STYLE=\"font-weight: normal;\">DEFAULT</span><span STYLE=\"font-weight: normal;\"> </span><span STYLE=\"font-weight: normal;\">&apos;&apos;</span><span STYLE=\"font-weight: normal;\">,</span></div><div><span STYLE=\"font-weight: normal;\">&hellip;&hellip;</span></div><div><span STYLE=\"font-weight: normal;\">) &hellip;&hellip;</span></div></td></tr></tbody></table><div><span STYLE=\"-en-paragraph:true;\">复制代码如果列级别没有设置 CHARSET 和 COLATE，则列级别会继承表级别的 CHARSET 与 COLLATE。\n</span></div><div><span STYLE=\"-en-paragraph:true;\">最后，你也可以在</span><span STYLE=\"font-weight: bold;-en-paragraph:true;\">写 SQL 查询</span><span STYLE=\"-en-paragraph:true;\">的时候显示声明 COLLATE 来覆盖任何库表列的 COLLATE 设置，不太常用，了解即可：\n</span></div><table STYLE=\"border-collapse: collapse; min-width: 100%;\"><colgroup><col STYLE=\"width: 1028px;\"/></colgroup><tbody><tr><td STYLE=\"width: 1028px; padding: 8px; border: 1px solid;\"><div><span STYLE=\"font-weight: normal;\">SELECT</span><span STYLE=\"font-weight: normal;\"> </span><span STYLE=\"font-weight: normal;\">DISTINCT</span><span STYLE=\"font-weight: normal;\"> field1 </span><span STYLE=\"font-weight: normal;\">COLLATE</span><span STYLE=\"font-weight: normal;\"> utf8mb4_general_ci </span><span STYLE=\"font-weight: normal;\">FROM</span><span STYLE=\"font-weight: normal;\"> table1;</span></div><div><br/></div><div><span STYLE=\"font-weight: normal;\">SELECT</span><span STYLE=\"font-weight: normal;\"> field1, field2 </span><span STYLE=\"font-weight: normal;\">FROM</span><span STYLE=\"font-weight: normal;\"> table1 </span><span STYLE=\"font-weight: normal;\">ORDER</span><span STYLE=\"font-weight: normal;\"> </span><span STYLE=\"font-weight: normal;\">BY</span><span STYLE=\"font-weight: normal;\"> field1 </span><span STYLE=\"font-weight: normal;\">COLLATE</span><span STYLE=\"font-weight: normal;\"> utf8mb4_unicode_ci;</span></div></td></tr></tbody></table><div>如果全都显示设置了，那么<span STYLE=\"font-weight: bold;\">优先级顺序是 SQL 语句 &gt; 列级别设置 &gt; 表级别设置 &gt; 库级别设置 &gt; 实例级别设置</span>。也就是说列上所指定的 COLLATE 可以覆盖表上指定的 COLLATE，表上指定的 COLLATE 可以覆盖库级别的 COLLATE。如果没有指定，则继承下一级的设置。即列上面没有指定 COLLATE，则该列的 COLLATE 和表上设置的一样。</div><div><span STYLE=\"-en-paragraph:true;\">以上就是关于 mysql 的 COLLATE 相关知识。不过，在系统设计中，我们还是要尽量避免让系统严重依赖中文字段的排序结果，在 mysql 的查询中也应该尽量避免使用中文做查询条件。\n</span></div><h2><span STYLE=\"font-size: 21px;\"><br/></span></h2></div><div><br/></div></en-note>      ",
      "content_path": null,
      "diff_base_variant_id": null,
      "metadata": {
        "checksum": "6a2bdeb573f1544d8669abc7eda70d9910e031b1d64f9f780dd6690f3b12d9fa",
        "path": "backups/2023年6月/个人的乱78糟/mysql 创建表的时候 COLLATE 干嘛的.html"
      }
    },
    {
      "id": "7caeee20-288b-4317-8ee2-780fc99cf591",
      "note_id": "35bdd9ba-d750-4e03-bacc-8cbc7b6c7cb6",
      "variant_type": "clean_text",
      "version": 1,
      "created_by": "evernote_ingest:v0",
      "created_at": "2025-11-10T15:43:33.522533Z",
      "content": "---\ntitle: mysql 创建表的时候 COLLATE 干嘛的\nupdated: 2021-05-20 11:46:17Z\ncreated: 2021-05-20 11:37:04Z\nauthor: tangyongfeng@gmail.com\n---\n\n在 mysql 中执行\nshow create table <tablename>\n指令，可以看到一张表的建表语句，example 如下：\nCREATE\n\nTABLE\n table_name(\n     column_name_1 data_type\ndefault\n\nvalue\n column_constraint,\n     column_name_2 data_type\ndefault\n\nvalue\n column_constraint,\n     ...,\n     table_constraint\n)  \nENGINE\n=\nInnoDB\n   \nDEFAULT\n\nCHARSET\n=utf8mb4\n   \nCOLLATE\n=utf8_unicode_ci;\n复制代码大部分字段我们都能看懂，但是今天要讨论的是\nCOLLATE\n 关键字。这个值后面对应的\nutf8_unicode_ci\n 是什么意思呢？面试的时候用这个题目考一考 DBA，应该可以难倒一大部分人。\n\nCOLLATE 是用来做什么的？\n\n使用\nphpmyadmin\n的开发可能会非常眼熟，因为其中的中文表头已经给出了答案：\n\n所谓 utf8_unicode_ci，其实是用来排序的规则。对于 mysql 中那些字符类型的列，如 VARCHAR，CHAR，TEXT 类型的列，都需要有一个 COLLATE 类型来告知 mysql\n如何对该列进行排序和比较\n。\n简而言之，\nCOLLATE\n 会影响到\nORDER BY\n 语句的顺序，会影响到\nWHERE\n 条件中大于小于号筛选出来的结果，会影响\nDISTINCT\n、\nGROUP BY\n、\nHAVING\n语句的查询结果。另外，mysql 建索引的时候，如果索引列是字符类型，\n也会影响索引创建\n，只不过这种影响我们感知不到。\n总之，凡是涉及到字符类型比较或排序的地方\n，都会和 COLLATE 有关。\n\n各种 COLLATE 的区别\n\nCOLLATE\n通常是和数据编码（\nCHARSET\n）相关的，一般来说每种\nCHARSET\n都有多种它所支持的\nCOLLATE\n，并且每种\nCHARSET\n都指定一种\nCOLLATE\n为默认值。例如\nLatin1\n编码的默认\nCOLLATE\n为\nlatin1_swedish_ci\n，\nGBK\n编码的默认\nCOLLATE\n为\ngbk_chinese_ci\n，\nutf8mb4\n编码的默认值为\nutf8mb4_general_ci\n。\n\n这里顺便讲个题外话，\nmysql\n中有\nutf8\n和\nutf8mb4\n两种编码，在 mysql 中请大家忘记\nutf8\n，永远使用\nutf8mb4\n。这是 mysql 的一个遗留问题，mysql 中的 utf8 最多只能支持 3bytes 长度的字符编码，对于一些需要占据\n4bytes\n的文字，mysql 的 utf8 就不支持了，要使用 utf8mb4 才行。\n\n很多\nCOLLATE\n都带有\n_ci\n字样，这是\nCase Insensitive\n的缩写，\n即大小写无关\n，也就是说”A”和”a”在排序和比较的时候是一视同仁的。\nselection * from table1 where field1=\"a\"\n同样可以把\nfield1 为”A”\n的值选出来。与此同时，对于那些\n_cs\n后缀的\nCOLLATE\n，则是\nCase Sensitive\n，\n即大小写敏感的\n。\n\n在 mysql 中使用\nshow collation\n指令可以查看到 mysql 所支持的所有\nCOLLATE\n。以 utf8mb4 为例，该编码所支持的所有\nCOLLATE\n如下图所示。\n\nmysql 中和 utf8mb4 相关的所有 COLLATE\n\n图中我们能看到很多国家的语言自己的排序规则。在国内比较常用的是\nutf8mb4_general_ci\n（默认）、\nutf8mb4_unicode_ci\n、\nutf8mb4_bin\n这三个。我们来探究一下这三个的区别：\n\n首先utf8mb4_bin的比较方法其实就是\n直接将所有字符看作二进制串，然后从最高位往最低位比对。所以很显然它是区分大小写的\n。\n而utf8mb4_unicode_ci和utf8mb4_general_ci对于中文和英文来说，其实是没有任何区别的。对于我们开发的国内使用的系统来说，随便选哪个都行。只是对于某些西方国家的字母来说，utf8mb4_unicode_ci会比utf8mb4_general_ci更符合他们的语言习惯一些.\ngeneral 是 mysql 一个比较老的标准了。例如，德语字母“ß”，在\nutf8mb4_unicode_ci\n中是等价于”ss”两个字母的（这是符合德国人习惯的做法），而在\nutf8mb4_general_ci\n中，它却和字母“s”等价。不过，这两种编码的那些微小的区别，对于正常的开发来说，很难感知到。本身我们也很少直接用文字字段去排序，退一步说，即使这个字母排错了一两个，真的能给系统带来灾难性后果么？从网上找的各种帖子讨论来说，更多人推荐使用\nutf8mb4_unicode_ci\n，但是对于使用了默认值的系统，也并没有非常排斥，并不认为有什么大问题。\n\n结论：推荐使用\nutf8mb4_unicode_ci\n，对于已经用了\nutf8mb4_general_ci\n的系统，也没有必要花时间改造。\n\n另外需要注意的一点是，从\nmysql 8.0\n开始，mysql 默认的\nCHARSET\n已经不再是 Latin1 了，改为了\nutf8mb4\n参考链接 10.5 Configuring Application Character Set and Collation\n，并且默认的\nCOLLATE\n也改为了\nutf8mb4_0900_ai_ci\n。\nutf8mb4_0900_ai_ci\n大体上就是\nunicode\n的\n进一步细分\n，0900 指代 unicode 比较算法的编号（ Unicode Collation Algorithm version），ai 表示 accent insensitive（发音无关），例如 e, è, é, ê 和 ë 是一视同仁的。\n\nWhat is the utf8mb4_0900_ai_ci Collation?\n10.3.1 Collation Naming Conventions\nCOLLATE 设置级别及其优先级\n\n设置\nCOLLATE\n可以在\n实例级别\n、\n库级别\n、\n表级别\n、\n列级别\n、以及\nSQL 指定\n。\n\n实例级别\n的\nCOLLATE\n设置就是 mysql 配置文件或启动指令中的\ncollation_connection\n系统变量。\n\n库级别\n设置\nCOLLATE\n的语句如下：\n\nCREATE\n\nDATABASE\n <db_name>\nDEFAULT\n\nCHARACTER\n\nSET\n utf8mb4\nCOLLATE\n utf8mb4_unicode_ci;\n如果\n库级别\n没有设置\nCHARSET\n和\nCOLLATE\n，则\n库级别\n默认的\nCHARSET\n和\nCOLLATE\n使用实例级别的设置。在 mysql8.0 以下版本中，你如果什么都不修改，默认的\nCHARSET\n是\nLatin1\n，默认的\nCOLLATE\n是\nlatin1_swedish_ci\n。从 mysql8.0 开始，默认的\nCHARSET\n已经改为了\nutf8mb4\n，默认的\nCOLLATE\n改为了\nutf8mb4_0900_ai_ci\n。\n\n表级别\n的\nCOLLATE\n设置，则是在\nCREATE TABLE\n的时候加上相关设置语句，例如：\n\nCREATE\n\nTABLE\n (\n……\n)\nENGINE\n=\nInnoDB\nDEFAULT\n\nCHARSET\n=utf8mb4\nCOLLATE\n=utf8mb4_unicode_ci\nCOMMENT\n =\n'XX表'\n;\n复制代码如果表级别没有设置 CHARSET 和 COLLATE，则表级别会继承库级别的 CHARSET 与 COLLATE。\n\n列级别\n的设置，则也在在\nCREATE TABLE\n中声明列的时候指定，例如\n\nCREATE\n\nTABLE\n (\n`field1`\n\nVARCHAR\n（\n64\n）\nCHARACTER\n\nSET\n utf8mb4\nCOLLATE\n utf8mb4_general_ci\nNOT\n\nNULL\n\nDEFAULT\n\n''\n,\n……\n) ……\n复制代码如果列级别没有设置 CHARSET 和 COLATE，则列级别会继承表级别的 CHARSET 与 COLLATE。\n\n最后，你也可以在\n写 SQL 查询\n的时候显示声明 COLLATE 来覆盖任何库表列的 COLLATE 设置，不太常用，了解即可：\n\nSELECT\n\nDISTINCT\n field1\nCOLLATE\n utf8mb4_general_ci\nFROM\n table1;\nSELECT\n field1, field2\nFROM\n table1\nORDER\n\nBY\n field1\nCOLLATE\n utf8mb4_unicode_ci;\n如果全都显示设置了，那么\n优先级顺序是 SQL 语句 > 列级别设置 > 表级别设置 > 库级别设置 > 实例级别设置\n。也就是说列上所指定的 COLLATE 可以覆盖表上指定的 COLLATE，表上指定的 COLLATE 可以覆盖库级别的 COLLATE。如果没有指定，则继承下一级的设置。即列上面没有指定 COLLATE，则该列的 COLLATE 和表上设置的一样。\n以上就是关于 mysql 的 COLLATE 相关知识。不过，在系统设计中，我们还是要尽量避免让系统严重依赖中文字段的排序结果，在 mysql 的查询中也应该尽量避免使用中文做查询条件。",
      "content_path": null,
      "diff_base_variant_id": null,
      "metadata": {
        "language": "ca",
        "length": 4229,
        "rule_count": 1,
        "applied_rules": [
          {
            "rule_id": "whitespace",
            "description": "Normalize whitespace",
            "note": "collapsed whitespace"
          }
        ]
      }
    }
  ],
  "extractions": [],
  "journal": {
    "id": "013b6bdb-20ac-4c2e-87dd-21a1d3daf41a",
    "note_id": "35bdd9ba-d750-4e03-bacc-8cbc7b6c7cb6",
    "stage": "ingest",
    "agent_id": "evernote_ingest:v0",
    "started_at": "2025-11-10T15:43:33.522538Z",
    "finished_at": "2025-11-10T15:43:33.522538Z",
    "status": "success",
    "input_ref": {
      "task_id": "ded0c311-72a0-4817-a2dc-66022b4fc652",
      "source_path": "backups/2023年6月/个人的乱78糟/mysql 创建表的时候 COLLATE 干嘛的.html",
      "checksum": "6a2bdeb573f1544d8669abc7eda70d9910e031b1d64f9f780dd6690f3b12d9fa"
    },
    "output_ref": {
      "ingest_source": "28989e07-01e3-45e0-8da2-babeb9491221",
      "note": "35bdd9ba-d750-4e03-bacc-8cbc7b6c7cb6",
      "variants": [
        "cdcd7282-2b6c-45a6-8332-9e8eccce1396",
        "7caeee20-288b-4317-8ee2-780fc99cf591"
      ]
    },
    "error_detail": null
  }
}