---
title: DLIB增加CUDA支持
updated: 2017-11-24 08:04:18Z
created: 2017-11-23 09:00:06Z
author: tangyongfeng
---

Ubuntu 16.04开启dlib对于AVX或者CUDA的支持

最近在使用

openface
来测试人脸识别，实际过程中发现识别速度非常缓慢，平均每帧的识别速度达到了秒级水平，这个是不可接受的。跟踪代码性能，发现是

dlib
部分非常缓慢。

根据

dlib
的文档，默认使用

Shell

$ sudo pip install dlib

1

$ sudo pip install dlib

安装的

dlib
库，由于对具体硬件的要求（

CPU
需要支持

AVX
指令集），是没有开启

AVX
指令加速的，另外由于显卡的要求，也是默认不开启

CUDA
的支持。

如果想要开启这部分加速，需要手工编译安装才可以，具体操作如下：

Shell

$ cd ~
$ mkdir dlib
$ sudo pip download dlib
$ tar -zxvf tar -zxvf dlib-*.tar.gz
$ cd dlib*

$ sudo apt-get -y install libopenblas-dev

$ sudo pip uninstall dlib

$ sudo python setup.py install --yes USE_AVX_INSTRUCTIONS

1
2
3
4
5
6
7
8
9
10
11
12
13
14

$ cd ~
$ mkdir dlib
$ sudo pip download dlib
$ tar -zxvf tar -zxvf dlib-*.tar.gz
$ cd dlib*
 
$ sudo apt-get -y install libopenblas-dev
 
$ sudo pip uninstall dlib
 
$ sudo python setup.py install --yes USE_AVX_INSTRUCTIONS

上面的命令是使用

AVX
指令加速功能的，如果机器上安装了

CUDA
，则需要正确安装

cuDNN 5.0
以上的版本，否在编译的时候会报告

Shell

-- Checking if you have the right version of cuDNN installed.
-- *** Found cuDNN, but it looks like the wrong version so dlib will not use it. ***
-- *** cuDNN V5.0 OR GREATER NOT FOUND.  DLIB WILL NOT USE CUDA. ***
-- *** If you have cuDNN then set CMAKE_PREFIX_PATH to include cuDNN's folder.

1
2
3
4

-- Checking if you have the right version of cuDNN installed.
-- *** Found cuDNN, but it looks like the wrong version so dlib will not use it. ***
-- *** cuDNN V5.0 OR GREATER NOT FOUND.  DLIB WILL NOT USE CUDA. ***
-- *** If you have cuDNN then set CMAKE_PREFIX_PATH to include cuDNN's folder.

对于使用

Shell

$ sudo apt install nvidia-cuda-toolkit

1

$ sudo apt install nvidia-cuda-toolkit

安装的

CUDA-7.5
来说,可以从这里下载
cuDNN v6.0 (April 27, 2017), for CUDA 7.5
，下载完成后，整个目录中的

include
目录中的文件解压缩到

/usr/local/include/
目录下，

lib64
目录中的内容整个解压缩到

/usr/lib/
目录下,并且在

/usr/local/lib/
目录下建立

libcudnn.so
的软链接

Shell

$ sudo ln -s /usr/lib/libcudnn.so /usr/local/lib/libcudnn.so

1

$ sudo ln -s /usr/lib/libcudnn.so /usr/local/lib/libcudnn.so

都配置正确后，使用如下编译命令安装：

Shell

$ sudo python setup.py install --yes DLIB_USE_CUDA

1

$ sudo python setup.py install --yes DLIB_USE_CUDA
CUDA_TOOLKIT_ROOT_DIR CUDA_NVCC_EXECUTABLE CUDA_INCLUDE_DIRS CUDA_CUDART_LIBRARY