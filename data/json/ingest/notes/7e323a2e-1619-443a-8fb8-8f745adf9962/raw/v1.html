---
title: openwrt 无线结构 - 华六的博客 - CSDN博客
updated: 2018-11-02 08:58:07Z
created: 2018-11-02 08:58:07Z
source: https://blog.csdn.net/zimiao815/article/details/55511338
---


<en-note>
  <div>
<div STYLE="font-size: 16px; display: inline-block;  min-width: 100%;"><div STYLE="background-color:transparent;font:inherit;vertical-align:baseline;"><div STYLE="font-family:&quot;PT Serif&quot;;font-size:16px;line-height:1.5em;color:rgb(31, 9, 9);text-align:left;background-color:transparent;font:inherit;vertical-align:baseline;"><div STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;"><div STYLE="width:36em;z-index:200;padding-left:2em;padding-right:2em;margin-left:auto;margin-right:auto;position:relative;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;"><div STYLE="position:relative;margin-left:-25px;margin-right:25px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;"><div STYLE="padding-top:4.5em;padding-bottom:9em;position:relative;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;"><div STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"><div STYLE="margin-bottom:0px;position:relative;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;"><div STYLE="margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;"><div STYLE="margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;"><h1 STYLE="font-family:&quot;PT Serif&quot;;text-align:left;padding:0px;margin:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:35px;line-height:35px;margin-bottom:20px;">openwrt 无线结构</h1><div STYLE="margin-bottom:0px;position:relative;margin:0px;height:1em;line-height:1;text-align:center;padding:0px;border:0px;font:inherit;vertical-align:baseline;padding-top:1.5em;padding-bottom:1.5em;"><div STYLE="background:-webkit-linear-gradient(0deg, rgb(243, 242, 238) 1%, rgb(31, 9, 9) 50%, rgb(243, 242, 238) 99%);margin-bottom:0px;position:absolute;left:-4em;top:50%;z-index:10;width:100%;padding-left:4em;padding-right:4em;height:0.1em;margin:0px;opacity:0.5;padding:0px;border:0px;font:inherit;vertical-align:baseline;"><span STYLE="font:inherit;background:-webkit-linear-gradient(0deg, rgb(243, 242, 238) 1%, rgb(31, 9, 9) 50%, rgb(243, 242, 238) 99%);position:absolute;left:-4em;top:50%;z-index:10;width:100%;padding-left:4em;padding-right:4em;height:0.1em;margin:0px;opacity:0.5;"></span></div></div></div>
&Tab;&Tab;&Tab;<div STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">
&Tab;&Tab;&Tab;&Tab;<div STYLE="margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;">
&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;2017年02月17日 15:49:34
&Tab;&Tab;&Tab;&Tab;&Tab;<a HREF="https://me.csdn.net/zimiao815" TARGET="_blank" STYLE="color:rgb(6, 85, 136);margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;">子妙815</a>
&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;阅读数：1175
&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;</div>
&Tab;&Tab;&Tab;&Tab;
&Tab;&Tab;&Tab;</div>
&Tab;&Tab;
&Tab;
&Tab;<div STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;display:block;">
&Tab;&Tab;<div STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">
&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;            
&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;<div STYLE="margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;">
                
<h2 STYLE="font-family:&quot;PT Serif&quot;;text-align:left;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;">转载有道：http://blog.csdn.net/myarrow/article/details/9274443#<br/>
</h2>
<h2 STYLE="font-family:&quot;PT Serif&quot;;text-align:left;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;">1. &nbsp;无线网络驱动(ath9k_htc)</h2>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">&nbsp; &nbsp; &nbsp;ath9k_htc是一个基于USB接口的SoftMAC无线网络适配器。为了其驱动能正常工作，首先必须调用usb_register来注册驱动定义的usb_driver，以借助USB Core的力量来处理与USB协议相关的事件。其代码如下：</p>
<div STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">

<ol STYLE="margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:decimal outside none;list-style-type:decimal;">
<li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
staticstruct&nbsp;usb_driver&nbsp;ath9k_hif_usb_driver&nbsp;=&nbsp;{&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.name&nbsp;=&nbsp;KBUILD_MODNAME,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.probe&nbsp;=&nbsp;ath9k_hif_usb_probe,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.disconnect&nbsp;=&nbsp;ath9k_hif_usb_disconnect,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
#ifdef&nbsp;CONFIG_PM</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.suspend&nbsp;=&nbsp;ath9k_hif_usb_suspend,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.resume&nbsp;=&nbsp;ath9k_hif_usb_resume,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.reset_resume&nbsp;=&nbsp;ath9k_hif_usb_resume,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
#endif</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.id_table&nbsp;=&nbsp;ath9k_hif_usb_ids,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.soft_unbind&nbsp;=&nbsp;1,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
};&nbsp;&nbsp;</li></ol>
</div>
<h2 STYLE="font-family:&quot;PT Serif&quot;;text-align:left;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;">2. 关键数据结构</h2>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">1)&nbsp;struct ieee80211_hw: 它包含802.11 PHY的<strong STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;">配置</strong>和<strong STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;">硬件</strong>信息。</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"></p><div STYLE="display:block;text-align:center;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1em;margin-top:1em;"><img src="../_resources/SouthEast-1"  type="image/png" hash="4fd9e06eaac96ec057013674a53b59c5" width="472" height="469" style="display:block;max-width:100%;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;" alt="SouthEast" /></en-media></div><p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"></p>
<h3 STYLE="font-family:&quot;PT Serif&quot;;text-align:left;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;">2.1 各层间关键数据接口</h3>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"></p><div STYLE="display:block;text-align:center;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1em;margin-top:1em;"><img src="../_resources/SouthEast"  type="image/png" hash="0059a7398707f6826daa279c66a58fc9" width="466" height="650" style="display:block;max-width:100%;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;" alt="SouthEast" /></en-media></div><p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"></p>
<h2 STYLE="font-family:&quot;PT Serif&quot;;text-align:left;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;">3. USB无线适配器枚举过程&nbsp;</h2>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">&nbsp; &nbsp; &nbsp;当此基于USB接口的无线网络适配器被枚举时，ath9k_hif_usb_probe将被调用。其调用流程如下图所示：</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"></p><div STYLE="display:block;text-align:center;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1em;margin-top:1em;"><img src="../_resources/SouthEast-7"  type="image/png" hash="e69200e2370ce1e12234dbc75391cb12" width="557" height="527" style="display:block;max-width:100%;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;" alt="SouthEast" /></en-media></div><p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"></p>
<h3 STYLE="font-family:&quot;PT Serif&quot;;text-align:left;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;">3.1 struct ieee80211_ops 实例 ath9k_htc_ops(驱动实现)</h3>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">&nbsp; &nbsp; &nbsp; &nbsp;ath9k_htc_ops: mac80211通过这些回调函数回调driver的处理函数。ath9k_htc为了接受mac80211的管理，它必须首先向mac80211注册，以申明自己的存在，从而可以接受mac80211的调用。</p>
<div STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">

<ol STYLE="margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:decimal outside none;list-style-type:decimal;">
<li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
struct&nbsp;ieee80211_ops&nbsp;ath9k_htc_ops&nbsp;=&nbsp;{&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.tx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ath9k_htc_tx,&nbsp;&nbsp;//&nbsp;发送mac80211要求发送的帧</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ath9k_htc_start,&nbsp;//&nbsp;第一个被attach到此硬件的net_device被enable之前被调用,之后，可以接收帧数据</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.stop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ath9k_htc_stop,&nbsp;&nbsp;//&nbsp;最后一个被attach到此硬件的net_device被disable之后被调用,之后，不可以接收帧数据</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.add_interface&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ath9k_htc_add_interface,&nbsp;//&nbsp;当一个被attach到此硬件的net_device被enable时被调用</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.remove_interface&nbsp;&nbsp;&nbsp;=&nbsp;ath9k_htc_remove_interface,&nbsp;//&nbsp;通知driver一个接口将要going&nbsp;down</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.config&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ath9k_htc_config,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;mac802.11调用它修改硬件配置</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.configure_filter&nbsp;&nbsp;&nbsp;=&nbsp;ath9k_htc_configure_filter,&nbsp;//&nbsp;配置设备的接收过滤器</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.sta_add&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ath9k_htc_sta_add,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.sta_remove&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ath9k_htc_sta_remove,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.conf_tx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ath9k_htc_conf_tx,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.bss_info_changed&nbsp;&nbsp;&nbsp;=&nbsp;ath9k_htc_bss_info_changed,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.set_key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ath9k_htc_set_key,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.get_tsf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ath9k_htc_get_tsf,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.set_tsf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ath9k_htc_set_tsf,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.reset_tsf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ath9k_htc_reset_tsf,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.ampdu_action&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ath9k_htc_ampdu_action,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.sw_scan_start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ath9k_htc_sw_scan_start,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.sw_scan_complete&nbsp;&nbsp;&nbsp;=&nbsp;ath9k_htc_sw_scan_complete,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.set_rts_threshold&nbsp;&nbsp;=&nbsp;ath9k_htc_set_rts_threshold,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.rfkill_poll&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ath9k_htc_rfkill_poll_state,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.set_coverage_class&nbsp;=&nbsp;ath9k_htc_set_coverage_class,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.set_bitrate_mask&nbsp;&nbsp;&nbsp;=&nbsp;ath9k_htc_set_bitrate_mask,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
};&nbsp;&nbsp;</li></ol>
</div>
<h3 STYLE="font-family:&quot;PT Serif&quot;;text-align:left;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;">3.2&nbsp;struct cfg80211_ops 实例 mac80211_config_ops(mac80211实现)&nbsp;&nbsp;</h3>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">&nbsp; &nbsp;cfg80211_ops定义了无线配置的操作，在它的增加虚拟接口(ieee80211_add_iface)中，它将创建并注册net_device。在mac80211中，其定义如下所示：</p>
<div STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">

<ol STYLE="margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:decimal outside none;list-style-type:decimal;">
<li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
struct&nbsp;cfg80211_ops&nbsp;mac80211_config_ops&nbsp;=&nbsp;{&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.add_virtual_intf&nbsp;=&nbsp;ieee80211_add_iface,&nbsp;//使用给定的名字创建一个&quot;虚拟接口&quot;,在wiphy的命名空间中创建net_device并返回</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.del_virtual_intf&nbsp;=&nbsp;ieee80211_del_iface,&nbsp;//删除由ifindex指定的&quot;虚拟接口&quot;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.change_virtual_intf&nbsp;=&nbsp;ieee80211_change_iface,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.add_key&nbsp;=&nbsp;ieee80211_add_key,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.del_key&nbsp;=&nbsp;ieee80211_del_key,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.get_key&nbsp;=&nbsp;ieee80211_get_key,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.set_default_key&nbsp;=&nbsp;ieee80211_config_default_key,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.set_default_mgmt_key&nbsp;=&nbsp;ieee80211_config_default_mgmt_key,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.add_beacon&nbsp;=&nbsp;ieee80211_add_beacon,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.set_beacon&nbsp;=&nbsp;ieee80211_set_beacon,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.del_beacon&nbsp;=&nbsp;ieee80211_del_beacon,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.add_station&nbsp;=&nbsp;ieee80211_add_station,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.del_station&nbsp;=&nbsp;ieee80211_del_station,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.change_station&nbsp;=&nbsp;ieee80211_change_station,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.get_station&nbsp;=&nbsp;ieee80211_get_station,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.dump_station&nbsp;=&nbsp;ieee80211_dump_station,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.dump_survey&nbsp;=&nbsp;ieee80211_dump_survey,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
#ifdef&nbsp;CONFIG_MAC80211_MESH</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.add_mpath&nbsp;=&nbsp;ieee80211_add_mpath,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.del_mpath&nbsp;=&nbsp;ieee80211_del_mpath,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.change_mpath&nbsp;=&nbsp;ieee80211_change_mpath,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.get_mpath&nbsp;=&nbsp;ieee80211_get_mpath,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.dump_mpath&nbsp;=&nbsp;ieee80211_dump_mpath,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.update_mesh_config&nbsp;=&nbsp;ieee80211_update_mesh_config,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.get_mesh_config&nbsp;=&nbsp;ieee80211_get_mesh_config,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.join_mesh&nbsp;=&nbsp;ieee80211_join_mesh,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.leave_mesh&nbsp;=&nbsp;ieee80211_leave_mesh,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
#endif</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.change_bss&nbsp;=&nbsp;ieee80211_change_bss,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.set_txq_params&nbsp;=&nbsp;ieee80211_set_txq_params,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.set_channel&nbsp;=&nbsp;ieee80211_set_channel,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.suspend&nbsp;=&nbsp;ieee80211_suspend,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.resume&nbsp;=&nbsp;ieee80211_resume,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.scan&nbsp;=&nbsp;ieee80211_scan,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.sched_scan_start&nbsp;=&nbsp;ieee80211_sched_scan_start,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.sched_scan_stop&nbsp;=&nbsp;ieee80211_sched_scan_stop,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.auth&nbsp;=&nbsp;ieee80211_auth,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.assoc&nbsp;=&nbsp;ieee80211_assoc,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.deauth&nbsp;=&nbsp;ieee80211_deauth,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.disassoc&nbsp;=&nbsp;ieee80211_disassoc,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.join_ibss&nbsp;=&nbsp;ieee80211_join_ibss,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.leave_ibss&nbsp;=&nbsp;ieee80211_leave_ibss,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.set_wiphy_params&nbsp;=&nbsp;ieee80211_set_wiphy_params,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.set_tx_power&nbsp;=&nbsp;ieee80211_set_tx_power,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.get_tx_power&nbsp;=&nbsp;ieee80211_get_tx_power,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.set_wds_peer&nbsp;=&nbsp;ieee80211_set_wds_peer,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.rfkill_poll&nbsp;=&nbsp;ieee80211_rfkill_poll,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;CFG80211_TESTMODE_CMD(ieee80211_testmode_cmd)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.set_power_mgmt&nbsp;=&nbsp;ieee80211_set_power_mgmt,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.set_bitrate_mask&nbsp;=&nbsp;ieee80211_set_bitrate_mask,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.remain_on_channel&nbsp;=&nbsp;ieee80211_remain_on_channel,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.cancel_remain_on_channel&nbsp;=&nbsp;ieee80211_cancel_remain_on_channel,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.mgmt_tx&nbsp;=&nbsp;ieee80211_mgmt_tx,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.mgmt_tx_cancel_wait&nbsp;=&nbsp;ieee80211_mgmt_tx_cancel_wait,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.set_cqm_rssi_config&nbsp;=&nbsp;ieee80211_set_cqm_rssi_config,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.mgmt_frame_register&nbsp;=&nbsp;ieee80211_mgmt_frame_register,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.set_antenna&nbsp;=&nbsp;ieee80211_set_antenna,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.get_antenna&nbsp;=&nbsp;ieee80211_get_antenna,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.set_ringparam&nbsp;=&nbsp;ieee80211_set_ringparam,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.get_ringparam&nbsp;=&nbsp;ieee80211_get_ringparam,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
}&nbsp;&nbsp;</li></ol>
</div>
<h3 STYLE="font-family:&quot;PT Serif&quot;;text-align:left;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;">3.3&nbsp;struct iw_handler_def &nbsp;实例 cfg80211_wext_handler(wireless实现)</h3>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">&nbsp; &nbsp; &nbsp; cfg80211_wext_handler实现了wext要求的ioctl操作，将通过net_device-&gt;wireless_handlers-&gt;standard[ioctl cmd- SIOCIWFIRST]来进行调用。在net/wireless/wext-compat.c中的定义如下所示：</p>
<div STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">

<ol STYLE="margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:decimal outside none;list-style-type:decimal;">
<li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
staticconst&nbsp;iw_handler&nbsp;cfg80211_handlers[]&nbsp;=&nbsp;{&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCGIWNAME)]&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_giwname,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCSIWFREQ)]&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_siwfreq,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCGIWFREQ)]&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_giwfreq,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCSIWMODE)]&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_siwmode,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCGIWMODE)]&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_giwmode,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCGIWRANGE)]&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_giwrange,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCSIWAP)]&nbsp;&nbsp;&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_siwap,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCGIWAP)]&nbsp;&nbsp;&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_giwap,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCSIWMLME)]&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_siwmlme,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCSIWSCAN)]&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_siwscan,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCGIWSCAN)]&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_giwscan,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCSIWESSID)]&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_siwessid,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCGIWESSID)]&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_giwessid,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCSIWRATE)]&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_siwrate,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCGIWRATE)]&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_giwrate,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCSIWRTS)]&nbsp;&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_siwrts,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCGIWRTS)]&nbsp;&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_giwrts,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCSIWFRAG)]&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_siwfrag,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCGIWFRAG)]&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_giwfrag,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCSIWTXPOW)]&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_siwtxpower,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCGIWTXPOW)]&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_giwtxpower,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCSIWRETRY)]&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_siwretry,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCGIWRETRY)]&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_giwretry,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCSIWENCODE)]&nbsp;&nbsp;&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_siwencode,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCGIWENCODE)]&nbsp;&nbsp;&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_giwencode,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCSIWPOWER)]&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_siwpower,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCGIWPOWER)]&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_giwpower,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCSIWGENIE)]&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_siwgenie,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCSIWAUTH)]&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_siwauth,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCGIWAUTH)]&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_giwauth,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCSIWENCODEEXT)]=&nbsp;(iw_handler)&nbsp;cfg80211_wext_siwencodeext,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCSIWPMKSA)]&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(iw_handler)&nbsp;cfg80211_wext_siwpmksa,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;[IW_IOCTL_IDX(SIOCSIWPRIV)]&nbsp;=&nbsp;(iw_handler)cfg80211_wext_setpriv&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
};&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
conststruct&nbsp;iw_handler_def&nbsp;cfg80211_wext_handler&nbsp;=&nbsp;{&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.num_standard&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ARRAY_SIZE(cfg80211_handlers),&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.standard&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;cfg80211_handlers,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.get_wireless_stats&nbsp;=&nbsp;cfg80211_wireless_stats,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
}&nbsp;&nbsp;</li></ol>
</div>
<h2 STYLE="font-family:&quot;PT Serif&quot;;text-align:left;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;">4. 创建并注册net_device</h2>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;当执行mac80211_config_ops-&gt;&nbsp;ieee80211_add_iface时，它将创建net_device和对应的ieee80211_sub_if_data, 然后主要做了以下几件事：</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">&nbsp; &nbsp; &nbsp; &nbsp; 1) 把net_device对应的名字增加到/sys/class/net/目录下 &nbsp;&nbsp;</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">&nbsp; &nbsp; &nbsp; &nbsp; 2) 把新创建的net_device插入到init_net-&gt;dev_base_head中</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">&nbsp; &nbsp; &nbsp; &nbsp; 3) 通知上层协议，有一个新的net_device出现了，大家可以使用它了</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">&nbsp; &nbsp; &nbsp; &nbsp; 4) 把新创建的ieee80211_sub_if_data增加到ieee80211_local的interfaces列表中</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">&nbsp; &nbsp; &nbsp; &nbsp; 其流程如下图所示：</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"></p><div STYLE="display:block;text-align:center;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1em;margin-top:1em;"><img src="../_resources/SouthEast-2"  type="image/png" hash="86dcfbdceb141bc36816e81c7b4de625" width="532" height="542" style="display:block;max-width:100%;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;" alt="SouthEast" /></en-media></div><p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"></p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">&nbsp; &nbsp; &nbsp; &nbsp; mac80211中定义的net_device_ops ieee80211_dataif_ops，以下这些方法，都有一个struct net_device参数。其具体定义如下：</p>
<div STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">

<ol STYLE="margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:decimal outside none;list-style-type:decimal;">
<li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
staticconststruct&nbsp;net_device_ops&nbsp;ieee80211_dataif_ops&nbsp;=&nbsp;{&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.ndo_open&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ieee80211_open,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;net_device变换到&nbsp;UP&nbsp;时被调用</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.ndo_stop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ieee80211_stop,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;net_device变换到&nbsp;Down&nbsp;时被调用</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.ndo_uninit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ieee80211_teardown_sdata,&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;取消注册或注册失败时调用</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.ndo_start_xmit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ieee80211_subif_start_xmit,&nbsp;&nbsp;//&nbsp;需要发送包时被调用</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.ndo_set_multicast_list&nbsp;=&nbsp;ieee80211_set_multicast_list,//&nbsp;多播地址列表变化时被调用</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.ndo_change_mtu&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ieee80211_change_mtu,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;当用户想改变一个设备的MTU时被调用</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.ndo_set_mac_address&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ieee80211_change_mac,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;mac地址需要改变时被调用</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.ndo_select_queue&nbsp;&nbsp;&nbsp;=&nbsp;ieee80211_netdev_select_queue,&nbsp;//当net_device支持多个发送队列时，用来决定使用哪个队列</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
};&nbsp;&nbsp;</li></ol>
</div>
mac80211中初始化net_device-&gt;netdev_ops:
<div STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">

<ol STYLE="margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:decimal outside none;list-style-type:decimal;">
<li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
staticvoid&nbsp;ieee80211_if_setup(struct&nbsp;net_device&nbsp;*dev)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
{&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;ether_setup(dev);&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;priv_flags&nbsp;&amp;=&nbsp;~IFF_TX_SKB_SHARING;&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;netdev_ops&nbsp;=&nbsp;&amp;ieee80211_dataif_ops;&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;destructor&nbsp;=&nbsp;free_netdev;&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
}&nbsp;&nbsp;</li></ol>
</div>
<h2 STYLE="font-family:&quot;PT Serif&quot;;text-align:left;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;">5. 数据接收(Data RX)流程</h2>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">&nbsp; &nbsp;数据接收流程如下图所示：</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"></p><div STYLE="display:block;text-align:center;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1em;margin-top:1em;"><img src="../_resources/SouthEast-5"  type="image/png" hash="c6735034bd2b37c52a32f74b60ca3f18" width="423" height="699" style="display:block;max-width:100%;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;" alt="SouthEast" /></en-media></div><p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"></p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">IP层与TCP/UDP层接口定义如下：</p>
<div STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">

<ol STYLE="margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:decimal outside none;list-style-type:decimal;">
<li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
staticconststruct&nbsp;net_protocol&nbsp;tcp_protocol&nbsp;=&nbsp;{&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.handler&nbsp;=&nbsp;&nbsp;tcp_v4_rcv,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.err_handler&nbsp;=&nbsp;&nbsp;tcp_v4_err,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.gso_send_check&nbsp;=&nbsp;tcp_v4_gso_send_check,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.gso_segment&nbsp;=&nbsp;&nbsp;tcp_tso_segment,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.gro_receive&nbsp;=&nbsp;&nbsp;tcp4_gro_receive,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.gro_complete&nbsp;=&nbsp;tcp4_gro_complete,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.no_policy&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;1,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.netns_ok&nbsp;=&nbsp;1,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
};&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
staticconststruct&nbsp;net_protocol&nbsp;udp_protocol&nbsp;=&nbsp;{&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.handler&nbsp;=&nbsp;&nbsp;udp_rcv,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.err_handler&nbsp;=&nbsp;&nbsp;udp_err,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.gso_send_check&nbsp;=&nbsp;udp4_ufo_send_check,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.gso_segment&nbsp;=&nbsp;udp4_ufo_fragment,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.no_policy&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;1,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.netns_ok&nbsp;=&nbsp;1,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
};&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
staticconststruct&nbsp;net_protocol&nbsp;icmp_protocol&nbsp;=&nbsp;{&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.handler&nbsp;=&nbsp;&nbsp;icmp_rcv,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.err_handler&nbsp;=&nbsp;&nbsp;ping_err,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.no_policy&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;1,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.netns_ok&nbsp;=&nbsp;1,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
};&nbsp;&nbsp;</li></ol>
</div>
IP层与net/core层接口定义如下：
<div STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">

<ol STYLE="margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:decimal outside none;list-style-type:decimal;">
<li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
staticstruct&nbsp;packet_type&nbsp;ip_packet_type&nbsp;__read_mostly&nbsp;=&nbsp;{&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.type&nbsp;=&nbsp;cpu_to_be16(ETH_P_IP),&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.func&nbsp;=&nbsp;ip_rcv,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.gso_send_check&nbsp;=&nbsp;inet_gso_send_check,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.gso_segment&nbsp;=&nbsp;inet_gso_segment,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.gro_receive&nbsp;=&nbsp;inet_gro_receive,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;.gro_complete&nbsp;=&nbsp;inet_gro_complete,&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
};&nbsp;&nbsp;</li></ol>
</div>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"></p><div STYLE="display:block;text-align:center;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1em;margin-top:1em;"><img src="../_resources/SouthEast-3"  type="image/png" hash="b8a30921db1a0b9864ccbe3bab0529a0" width="512" height="812" style="display:block;max-width:100%;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;" alt="SouthEast" /></en-media></div><p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"></p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">接收下半部stack如下所示：</p>
<div STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">

<ol STYLE="margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:decimal outside none;list-style-type:decimal;">
<li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
[&nbsp;&nbsp;336.646628]&nbsp;[&lt;c07d8b24&gt;]&nbsp;(tcp_rcv_established+0x648/0x9b0)&nbsp;from&nbsp;[&lt;c07e04cc&gt;]&nbsp;(tcp_v4_do_rcv+0x74/0x2a8)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
[&nbsp;&nbsp;336.646661]&nbsp;[&lt;c07e04cc&gt;]&nbsp;(tcp_v4_do_rcv+0x74/0x2a8)&nbsp;from&nbsp;[&lt;c07e0c40&gt;]&nbsp;(tcp_v4_rcv+0x540/0x908)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
[&nbsp;&nbsp;336.646678]&nbsp;[&lt;c07e0c40&gt;]&nbsp;(tcp_v4_rcv+0x540/0x908)&nbsp;from&nbsp;[&lt;c07c23d4&gt;]&nbsp;(ip_local_deliver_finish+0x158/0x318)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
[&nbsp;&nbsp;336.646694]&nbsp;[&lt;c07c23d4&gt;]&nbsp;(ip_local_deliver_finish+0x158/0x318)&nbsp;from&nbsp;[&lt;c07c1e44&gt;]&nbsp;(ip_rcv_finish+0x420/0x440)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
[&nbsp;&nbsp;336.646715]&nbsp;[&lt;c07c1e44&gt;]&nbsp;(ip_rcv_finish+0x420/0x440)&nbsp;from&nbsp;[&lt;c0772dcc&gt;]&nbsp;(__netif_receive_skb+0x4d0/0x534)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
[&nbsp;&nbsp;336.646730]&nbsp;[&lt;c0772dcc&gt;]&nbsp;(__netif_receive_skb+0x4d0/0x534)&nbsp;from&nbsp;[&lt;c0774434&gt;]&nbsp;(netif_receive_skb+0x9c/0xb4)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
[&nbsp;&nbsp;336.646752]&nbsp;[&lt;c0774434&gt;]&nbsp;(netif_receive_skb+0x9c/0xb4)&nbsp;from&nbsp;[&lt;c08b8e6c&gt;]&nbsp;(ieee80211_deliver_skb+0x134/0x164)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
[&nbsp;&nbsp;336.646769]&nbsp;[&lt;c08b8e6c&gt;]&nbsp;(ieee80211_deliver_skb+0x134/0x164)&nbsp;from&nbsp;[&lt;c08b9ed8&gt;]&nbsp;(ieee80211_rx_handlers+0x103c/0x1978)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
[&nbsp;&nbsp;336.646785]&nbsp;[&lt;c08b9ed8&gt;]&nbsp;(ieee80211_rx_handlers+0x103c/0x1978)&nbsp;from&nbsp;[&lt;c08baf10&gt;]&nbsp;(ieee80211_prepare_and_rx_handle+0x6fc/0x788)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
[&nbsp;&nbsp;336.646802]&nbsp;[&lt;c08baf10&gt;]&nbsp;(ieee80211_prepare_and_rx_handle+0x6fc/0x788)&nbsp;from&nbsp;[&lt;c08bb920&gt;]&nbsp;(ieee80211_rx+0x908/0x988)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
[&nbsp;&nbsp;336.646819]&nbsp;[&lt;c08bb920&gt;]&nbsp;(ieee80211_rx+0x908/0x988)&nbsp;from&nbsp;[&lt;c068a578&gt;]&nbsp;(ath9k_rx_tasklet+0x4e4/0x54c)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
[&nbsp;&nbsp;336.646835]&nbsp;[&lt;c068a578&gt;]&nbsp;(ath9k_rx_tasklet+0x4e4/0x54c)&nbsp;from&nbsp;[&lt;c0467d98&gt;]&nbsp;(tasklet_action+0xa8/0x14c)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
[&nbsp;&nbsp;336.646850]&nbsp;[&lt;c0467d98&gt;]&nbsp;(tasklet_action+0xa8/0x14c)&nbsp;from&nbsp;[&lt;c0468144&gt;]&nbsp;(__do_softirq+0x88/0x158)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
[&nbsp;&nbsp;336.646863]&nbsp;[&lt;c0468144&gt;]&nbsp;(__do_softirq+0x88/0x158)&nbsp;from&nbsp;[&lt;c0468414&gt;]&nbsp;(irq_exit+0x48/0xac)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
[&nbsp;&nbsp;336.646882]&nbsp;[&lt;c0468414&gt;]&nbsp;(irq_exit+0x48/0xac)&nbsp;from&nbsp;[&lt;c04313c0&gt;]&nbsp;(do_local_timer+0x50/0x80)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
[&nbsp;&nbsp;336.646898]&nbsp;[&lt;c04313c0&gt;]&nbsp;(do_local_timer+0x50/0x80)&nbsp;from&nbsp;[&lt;c0436708&gt;]&nbsp;(__irq_svc+0x48/0xe0)&nbsp;&nbsp;</li></ol>
</div>
<h2 STYLE="font-family:&quot;PT Serif&quot;;text-align:left;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;">6. 数据发送(Data TX)流珵</h2>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">&nbsp; &nbsp;数据发送流程如下图所示：</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"></p><div STYLE="display:block;text-align:center;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1em;margin-top:1em;"><img src="../_resources/SouthEast-6"  type="image/png" hash="cf8d2588e0c3b6337f8fd908ecc43825" width="384" height="632" style="display:block;max-width:100%;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;" alt="SouthEast" /></en-media></div><p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"></p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"></p><div STYLE="display:block;text-align:center;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1em;margin-top:1em;"><img src="../_resources/SouthEast-4"  type="image/png" hash="bb5d5500b401ccad646a63ccfb5f49cc" width="467" height="767" style="display:block;max-width:100%;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;" alt="SouthEast" /></en-media></div><p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"></p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">上半部分涉及到的相关代码如下所示（以上流程主要通过dump_stack获取）：</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">&nbsp; &nbsp; &nbsp;net/socket.c<br/>
&nbsp; &nbsp; &nbsp;net/ipv4/af_net.c<br/>
&nbsp; &nbsp; &nbsp;net/ipv4/tcp.c<br/>
&nbsp; &nbsp; &nbsp;net/ipv4/tcp_output.c<br/>
&nbsp; &nbsp; &nbsp;net/ipv4/ip_output.c<br/>
&nbsp; &nbsp; &nbsp;net/core/neighbour.c<br/>
&nbsp; &nbsp; &nbsp;net/core/dev.c</p>
<h2 STYLE="font-family:&quot;PT Serif&quot;;text-align:left;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;">7. INET初始化</h2>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">&nbsp; &nbsp; INET为<a HREF="http://lib.csdn.net/base/linux" TITLE="Linux知识库" TARGET="_blank" STYLE="color:rgb(6, 85, 136);margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;">Linux</a>&nbsp;OS实现了TCP/IP协议集，它使用BSD
 Socket接口作为与User通讯的方式。其初始化代码如下所示：</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">&nbsp; &nbsp; 代码位于：net/ipv4/af_inet.c。</p>
<div STYLE="margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;">

<ol STYLE="margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:decimal outside none;list-style-type:decimal;">
<li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
staticint&nbsp;__init&nbsp;inet_init(void)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
{&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;sk_buff&nbsp;*dummy_skb;&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;inet_protosw&nbsp;*q;&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;list_head&nbsp;*r;&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;rc&nbsp;=&nbsp;-EINVAL;&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;BUILD_BUG_ON(sizeof(struct&nbsp;inet_skb_parm)&nbsp;&gt;&nbsp;sizeof(dummy_skb-&gt;cb));&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;sysctl_local_reserved_ports&nbsp;=&nbsp;kzalloc(65536&nbsp;/&nbsp;8,&nbsp;GFP_KERNEL);&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!sysctl_local_reserved_ports)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;out;&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;rc&nbsp;=&nbsp;proto_register(&amp;tcp_prot,&nbsp;1);&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rc)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;out_free_reserved_ports;&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;rc&nbsp;=&nbsp;proto_register(&amp;udp_prot,&nbsp;1);&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rc)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;out_unregister_tcp_proto;&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;rc&nbsp;=&nbsp;proto_register(&amp;raw_prot,&nbsp;1);&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rc)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;out_unregister_udp_proto;&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;rc&nbsp;=&nbsp;proto_register(&amp;ping_prot,&nbsp;1);&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rc)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;out_unregister_raw_proto;&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;Tell&nbsp;SOCKET&nbsp;that&nbsp;we&nbsp;are&nbsp;alive...&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;(void)sock_register(&amp;inet_family_ops);&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
#ifdef&nbsp;CONFIG_SYSCTL</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;ip_static_sysctl_init();&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
#endif</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;Add&nbsp;all&nbsp;the&nbsp;base&nbsp;protocols.&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(inet_add_protocol(&amp;icmp_protocol,&nbsp;IPPROTO_ICMP)&nbsp;&lt;&nbsp;0)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printk(KERN_CRIT&nbsp;&quot;inet_init:&nbsp;Cannot&nbsp;add&nbsp;ICMP&nbsp;protocol\n&quot;);&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(inet_add_protocol(&amp;udp_protocol,&nbsp;IPPROTO_UDP)&nbsp;&lt;&nbsp;0)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printk(KERN_CRIT&nbsp;&quot;inet_init:&nbsp;Cannot&nbsp;add&nbsp;UDP&nbsp;protocol\n&quot;);&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(inet_add_protocol(&amp;tcp_protocol,&nbsp;IPPROTO_TCP)&nbsp;&lt;&nbsp;0)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printk(KERN_CRIT&nbsp;&quot;inet_init:&nbsp;Cannot&nbsp;add&nbsp;TCP&nbsp;protocol\n&quot;);&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
#ifdef&nbsp;CONFIG_IP_MULTICAST</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(inet_add_protocol(&amp;igmp_protocol,&nbsp;IPPROTO_IGMP)&nbsp;&lt;&nbsp;0)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printk(KERN_CRIT&nbsp;&quot;inet_init:&nbsp;Cannot&nbsp;add&nbsp;IGMP&nbsp;protocol\n&quot;);&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
#endif</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Register&nbsp;the&nbsp;socket-side&nbsp;information&nbsp;for&nbsp;inet_create.&nbsp;*/</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(r&nbsp;=&nbsp;&amp;inetsw[0];&nbsp;r&nbsp;&lt;&nbsp;&amp;inetsw[SOCK_MAX];&nbsp;++r)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INIT_LIST_HEAD(r);&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(q&nbsp;=&nbsp;inetsw_array;&nbsp;q&nbsp;&lt;&nbsp;&amp;inetsw_array[INETSW_ARRAY_LEN];&nbsp;++q)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inet_register_protosw(q);&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;Set&nbsp;the&nbsp;ARP&nbsp;module&nbsp;up&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;arp_init();&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;Set&nbsp;the&nbsp;IP&nbsp;module&nbsp;up&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;ip_init();&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;tcp_v4_init();&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Setup&nbsp;TCP&nbsp;slab&nbsp;cache&nbsp;for&nbsp;open&nbsp;requests.&nbsp;*/</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;tcp_init();&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Setup&nbsp;UDP&nbsp;memory&nbsp;threshold&nbsp;*/</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;udp_init();&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Add&nbsp;UDP-Lite&nbsp;(RFC&nbsp;3828)&nbsp;*/</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;udplite4_register();&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;ping_init();&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;Set&nbsp;the&nbsp;ICMP&nbsp;layer&nbsp;up&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(icmp_init()&nbsp;&lt;&nbsp;0)&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;panic(&quot;Failed&nbsp;to&nbsp;create&nbsp;the&nbsp;ICMP&nbsp;control&nbsp;socket.\n&quot;);&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;Initialise&nbsp;the&nbsp;multicast&nbsp;router&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
#if&nbsp;defined(CONFIG_IP_MROUTE)</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ip_mr_init())&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printk(KERN_CRIT&nbsp;&quot;inet_init:&nbsp;Cannot&nbsp;init&nbsp;ipv4&nbsp;mroute\n&quot;);&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
#endif</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;Initialise&nbsp;per-cpu&nbsp;ipv4&nbsp;mibs&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(init_ipv4_mibs())&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printk(KERN_CRIT&nbsp;&quot;inet_init:&nbsp;Cannot&nbsp;init&nbsp;ipv4&nbsp;mibs\n&quot;);&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;ipv4_proc_init();&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;ipfrag_init();&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;dev_add_pack(&amp;ip_packet_type);&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;rc&nbsp;=&nbsp;0;&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
out:&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;rc;&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
out_unregister_raw_proto:&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;proto_unregister(&amp;raw_prot);&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
out_unregister_udp_proto:&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;proto_unregister(&amp;udp_prot);&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
out_unregister_tcp_proto:&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;proto_unregister(&amp;tcp_prot);&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
out_free_reserved_ports:&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;kfree(sysctl_local_reserved_ports);&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;out;&nbsp;&nbsp;</li><li STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;">
} &nbsp;</li></ol>
</div>
            </div>
                </div>
&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;<div STYLE="margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;">
&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;<a TARGET="_blank" STYLE="color:rgb(6, 85, 136);margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;">阅读更多</a>
&Tab;&Tab;&Tab;&Tab;&Tab;</div>
&Tab;&Tab;&Tab;&Tab;&Tab;
&Tab;&Tab;&Tab;&Tab;&Tab;</div>
&Tab;
</div></div></div><div STYLE="position:absolute;top:-1000px;left:-1000px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">Measure</div><div STYLE="margin-bottom:0px;position:absolute;top:-1000px;left:-1000px;line-height:1;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;">Measure</div></div></div></div></div></div></div></div>
</div>
</en-note>      