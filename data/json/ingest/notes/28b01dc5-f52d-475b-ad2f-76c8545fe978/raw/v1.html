---
title: 开发OpenWrt路由器上LuCI的模块-lwchsz-ChinaUnix博客
updated: 2015-12-16 00:24:26Z
created: 2015-12-16 00:24:26Z
source: >-
  http://m.blog.chinaunix.net/uid-26675482-id-4634156.html#0-tsina-1-85203-397232819ff9a47a7b7e80a40613cfe1
---



<en-note>
<div STYLE="padding: 0px; font-size: 16px; line-height: 1.25em; min-width: 320px; font-family: 'microsoft yahei', Verdana, Arial, Helvetica, sans-serif; color: rgb(0, 0, 0); -webkit-text-size-adjust: none;">
<div STYLE="background-color: rgb(215, 229, 240); height: 40px; overflow: hidden; width: 100%; position: relative;">
&Tab;<a STYLE="color: rgb(0, 0, 0); text-decoration: none;" HREF="http://m.blog.chinaunix.net/"><img src="../_resources/1e05fc686279d14635cbe24880f120e9.png"  style="border: 0px;" alt="" height="40" hash="1e05fc686279d14635cbe24880f120e9" type="image/png" /></en-media> </a>
&Tab;<a STYLE="color: rgb(0, 0, 0); text-decoration: none; display: block; position: absolute; right: 0px; top: 0px; background-image: url(http://m.blog.chinaunix.net/themes/default/images/fenlei.png); width: 45px; height: 40px; background-size: 45px 40px; background-repeat: no-repeat no-repeat;"> </a>
</div>


<div STYLE="padding: 15px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(204, 204, 204);">
  <h1 STYLE="margin: 0px; padding: 0px 0px 5px; font-size: 20px; display: block;">开发OpenWrt路由器上LuCI的模块</h1>
  <p STYLE="margin: 0px; padding: 0px; font-size: 12px; line-height: 18px; color: rgb(102, 102, 102);"><span STYLE="float: right;">2160阅读　0评论</span>2014-11-19　<a STYLE="color: rgb(54, 126, 185); text-decoration: none;" HREF="http://m.blog.chinaunix.net/uid/26675482.html">lwchsz</a><br STYLE=""/>
    分类：<a STYLE="color: rgb(54, 126, 185); text-decoration: none;" HREF="http://m.blog.chinaunix.net/embed.html">嵌入式</a></p>
</div>
<div STYLE="border-top-width: 1px; border-top-style: solid; border-top-color: rgb(255, 255, 255); padding: 5px 15px 15px; word-wrap: break-word; word-break: break-all;">
 原文地址：http://www.tuicool.com/articles/zaUNfy
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;<strong STYLE="">【文章索引】</strong>
</p>
<ol STYLE="margin: 0px 0px 0.75em 25px; padding: 0px; list-style: none; line-height: 28.799999237060547px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;<li STYLE="margin: 0px; padding: 0px; line-height: 1.8;">
&Tab;&Tab;<a STYLE="color: rgb(148, 148, 148); text-decoration: none; -webkit-transition: 0.25s; transition: 0.25s; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(148, 148, 148); font-style: italic; font-weight: bold;" REL="nofollow" HREF="http://www.cnblogs.com/mayswind/p/#para1">LuCI配置界面开发的框架</a>
&Tab;</li>
&Tab;<li STYLE="margin: 0px; padding: 0px; line-height: 1.8;">
&Tab;&Tab;<a STYLE="color: rgb(148, 148, 148); text-decoration: none; -webkit-transition: 0.25s; transition: 0.25s; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(148, 148, 148); font-style: italic; font-weight: bold;" REL="nofollow" HREF="http://www.cnblogs.com/mayswind/p/#para2">用Lua和UCI接口开发LuCI配置模块</a>
&Tab;</li>
&Tab;<li STYLE="margin: 0px; padding: 0px; line-height: 1.8;">
&Tab;&Tab;<a STYLE="color: rgb(148, 148, 148); text-decoration: none; -webkit-transition: 0.25s; transition: 0.25s; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(148, 148, 148); font-style: italic; font-weight: bold;" REL="nofollow" HREF="http://www.cnblogs.com/mayswind/p/#para3">在Bash文件中调用UCI接口&nbsp;<br STYLE=""/>
</a>
&Tab;</li>
&Tab;<li STYLE="margin: 0px; padding: 0px; line-height: 1.8;">
&Tab;&Tab;<a STYLE="color: rgb(148, 148, 148); text-decoration: none; -webkit-transition: 0.25s; transition: 0.25s; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(148, 148, 148); font-style: italic; font-weight: bold;" REL="nofollow" HREF="http://www.cnblogs.com/mayswind/p/#para4">编译开发的程序</a>
&Tab;</li>
</ol>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;<strong STYLE="">【一、LuCI配置界面开发的框架】</strong>
</p>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;LuCI是OpenWrt上的Web管理界面，LuCI采用了MVC三层架构，同时其使用Lua脚本开发，所以开发LuCI的配置界面不需要编辑任何的Html代码，除非想自己单独去创建网页（View层），否则我们基本上只需要修改Model层就可以了。官方也有一个如何去创建模块的说明文档，虽然写的比较晦涩：<a STYLE="color: rgb(148, 148, 148); text-decoration: none; -webkit-transition: 0.25s; transition: 0.25s; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(148, 148, 148); font-style: italic; font-weight: bold;" REL="nofollow" TARGET="_blank" HREF="http://luci.subsignal.org/trac/wiki/Documentation/ModulesHowTo">http://luci.subsignal.org/trac/wiki/Documentation/ModulesHowTo</a>
</p>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;要为LuCI增加一个新模块，首先需要创建两个文件，一个位于Controller（/usr/lib/lua/luci/controller/）下，定义模块的入口；另一个位于Model（/usr/lib/lua/luci/model/cbi/）下，为配置模块实际的代码。
</p>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;首先我们定义模块的入口，在/usr/lib/lua/luci/controller/下创建一个lua文件，类似如下：
</p>
<div STYLE="line-height: 28.799999237060547px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
<pre STYLE="padding: 0.5em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 1em; line-height: 1.5em; word-break: break-all; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: rgb(248, 248, 255);"><span STYLE="color: rgb(255, 0, 255);">module</span>(<span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">luci.controller.控制器名</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span>, <span STYLE="color: rgb(255, 0, 255);">package.seeall</span><span STYLE="color: rgb(0, 0, 0);">) </span><span STYLE="color: rgb(0, 0, 255);"><span STYLE=""><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">function</span></span></span><span STYLE=""><span STYLE="color: rgb(0, 0, 0);"> <span STYLE="color: rgb(153, 0, 0);">index</span><span STYLE="">()</span> <span STYLE="color: rgb(153, 0, 0);">entry</span><span STYLE="">(路径</span></span><span STYLE="">, 调用目标, _<span STYLE="">(<span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;显示名称</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span><span STYLE="color: rgb(0, 0, 0);">)</span></span><span STYLE="color: rgb(0, 0, 0);">, 显示顺序)</span></span><span STYLE="color: rgb(0, 0, 0);"> </span><span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(153, 0, 0);">end</span></span></span><span STYLE="color: rgb(0, 0, 255);"></span></pre>
</div>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;第一行说明了程序和模块的名称，比如在controller/目录创建一个mymodule.lua，那么就可以写成&ldquo;luci.controller.mymodule&rdquo;，如果你的程序比较多，可能分为好几个模块，那么可以在controller下再常见一个子目录，比如controller/myapp/，那么就可以写成&ldquo;luci.controller.myapp.mymodule&rdquo;。
</p>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;接下来的entry表示添加一个新的模块入口，官方给出了entry的定义，其中后两项都是可以为空的：
</p>
<div STYLE="line-height: 28.799999237060547px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
<pre STYLE="padding: 0.5em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 1em; line-height: 1.5em; word-break: break-all; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: rgb(248, 248, 255);">entry(path, target, title=<span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">nil</span></span>, order=<span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">nil</span></span>)</pre>
</div>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;第一项是访问的路径，不过路径是按字符串数组给定的，比如路径按如下方式写&ldquo;{&quot;click&quot;, &quot;here&quot;, &quot;now&quot;}&rdquo;，那么就可以在浏览器里访问&ldquo;http://192.168.1.1/cgi-bin/luci/click/here/now&rdquo;来访问这个脚本。而通常我们希望为管理员菜单添加脚本，那么我们需要按如下方式编写&ldquo;{&quot;admin&quot;, &quot;一级菜单名&quot;, &quot;菜单项名&quot;}&rdquo;，系统会自动在对应的菜单中生成菜单项。比如想在&ldquo;网络&rdquo;菜单下创建一个菜单项，那么一级菜单名可以写为&ldquo;network&rdquo;。
</p>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;第二项为调用目标，调用目标分为三种，分别是执行指定方法（Action）、访问指定页面（Views）以及调用CBI Module。
</p>
<ul STYLE="margin: 0px 0px 0.75em 25px; padding: 0px; list-style: none; line-height: 28.799999237060547px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;<li STYLE="margin: 0px; padding: 0px; line-height: 1.8; list-style-type: disc;">
&Tab;&Tab;第一种可以直接调用指定的函数，比如点击菜单项就直接重启路由器等等，比如写为&ldquo;call(&quot;function_name&quot;)&rdquo;，然后在lua文件下编写名为function_name的函数就可以调用了。
&Tab;</li>
&Tab;<li STYLE="margin: 0px; padding: 0px; line-height: 1.8; list-style-type: disc;">
&Tab;&Tab;第二种可以访问指定的页面，比如写为&ldquo;template(&quot;myapp/mymodule&quot;)&rdquo;就可以调用/usr/lib/lua/luci/view/myapp/mymodule.htm文件了。
&Tab;</li>
&Tab;<li STYLE="margin: 0px; padding: 0px; line-height: 1.8; list-style-type: disc;">
&Tab;&Tab;而如果要编写配置页面，那么使用第三种方法无非是最方便的，比如写为&ldquo;cbi(&quot;myapp/mymodule&quot;)&rdquo;就可以调用/usr/lib/lua/luci/model/cbi/myapp/mymodule.lua文件了。
&Tab;</li>
</ul>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;而title和order无非是针对管理员菜单来的，可以参考其他的lua文件来决定编写的内容。
</p>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;这里我们创建/usr/lib/lua/luci/controller/njitclient.lua文件，定义我们的入口，代码如下：
</p>
<div STYLE="line-height: 28.799999237060547px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
<pre STYLE="padding: 0.5em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 1em; line-height: 1.5em; word-break: break-all; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: rgb(248, 248, 255);"><span STYLE="color: rgb(255, 0, 255);">module</span>(<span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">luci.controller.njitclient</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span>, <span STYLE="color: rgb(255, 0, 255);">package.seeall</span><span STYLE="color: rgb(0, 0, 0);">) </span><span STYLE="color: rgb(0, 0, 255);"><span STYLE=""><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">function</span></span></span><span STYLE=""><span STYLE="color: rgb(0, 0, 0);"> <span STYLE="color: rgb(153, 0, 0);">index</span><span STYLE="">()</span> <span STYLE="color: rgb(153, 0, 0);">entry</span><span STYLE="">({</span></span><span STYLE=""><span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">admin</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span>, <span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">network</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span>, <span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">njitclient</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span>}, cbi<span STYLE="">(<span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">njitclient</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span>)</span>, _<span STYLE="">(<span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">NJIT Client</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span>)</span>, <span STYLE="color: rgb(128, 0, 128);"><span STYLE="color: rgb(0, 153, 153);">100</span></span><span STYLE="color: rgb(0, 0, 0);">)</span></span><span STYLE="color: rgb(0, 0, 0);"> </span><span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(153, 0, 0);">end</span></span></span><span STYLE="color: rgb(0, 0, 255);"></span></pre>
</div>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;<strong STYLE="">【二、&nbsp;<strong STYLE=""><strong STYLE="">用Lua和UCI接口开发LuCI配置模块</strong>&nbsp;</strong>】</strong>
</p>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;我们要做的实际上就是希望能将用户名、密码等信息存储在路由器文件中，同时路由器开机时能根据设定的配置自动运行njit-client，同时我们还希望能动态的禁用和启用njit-client等等。所以最方便的方式就是使用CBI Module，上一节我们也添加了这个调用，那么接下来我们就要根据上边写的路径来创建/usr/lib/lua/luci/model/cbi/njitclient.lua文件。
</p>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;开发LuCI的配置模块有很多种方式，比较基本的可以用SimpleForm，就跟开发普通的Web应用类似，当然最方便的还是使用UCI（Unified Configuration Interface，统一配置接口）的方式，因为使用UCI接口可以使得在LuCI中可以无需考虑配置文件如何存储和读取（这种方式也会自动创建&ldquo;保存&amp;应用&rdquo;、&ldquo;保存&rdquo;以及&ldquo;复位&rdquo;三个按钮），同时在Bash文件中也可以非常方便的存储和读取。
</p>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;对于使用UCI的方式，我们首先需要创建对应的配置文件（如果配置文件不存在的话，访问配置页面将会报错），格式即为linux配置文件的格式，文件需要存储在/etc/config，比如文件路径为&ldquo;/etc/config/njitclient&rdquo;，内容如下：
</p>
<div STYLE="line-height: 28.799999237060547px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
<pre STYLE="padding: 0.5em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 1em; line-height: 1.5em; word-break: break-all; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: rgb(248, 248, 255);"><span STYLE="color: rgb(0, 0, 0);">config login
    option username </span><span STYLE="color: rgb(128, 0, 0);">&apos;&apos;</span><span STYLE="color: rgb(0, 0, 0);"> option password </span><span STYLE="color: rgb(128, 0, 0);">&apos;&apos;</span><span STYLE="color: rgb(0, 0, 0);"> option ifname </span><span STYLE="color: rgb(128, 0, 0);">&apos;</span><span STYLE="color: rgb(128, 0, 0);">eth0</span><span STYLE="color: rgb(128, 0, 0);">&apos;</span><span STYLE="color: rgb(0, 0, 0);"> option domain </span><span STYLE="color: rgb(128, 0, 0);">&apos;&apos;</span></pre>
</div>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;然后我们要在CBI Module的lua文件中首先需要映射与存储文件的关系，比如：
</p>
<div STYLE="line-height: 28.799999237060547px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
<pre STYLE="padding: 0.5em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 1em; line-height: 1.5em; word-break: break-all; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: rgb(248, 248, 255);"><span STYLE="">m = <span STYLE="">Map(<span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;配置文件文件名</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span>, <span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;配置页面标题</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span>, <span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;配置页面说明</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span>)</span></span></pre>
</div>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;第一个参数即为配置文件存储的文件名，不包含路径，比如按上述创建的话，应该写为&ldquo;njitclient&rdquo;，而第二与第三个参数则是用在来页面上显示的，比如如下所示的图：
</p>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;<img src="../_resources/c02b3cc57d0cf112b596c99e8d300089.png"  style="border: 0px none; display: block; width: 100%; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto;" alt="" hash="c02b3cc57d0cf112b596c99e8d300089" type="image/png" /></en-media>
</p>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;接下来需要创建与配置文件中对应的Section，Section分为两种，NamedSection和TypedSection，前者根据配置文件中的Section名，而后者根据配置文件中的Section类型，这里我们使用后者，代码如下。同时我们设定不允许增加或删除Section（&ldquo;.addremove = false&rdquo;），以及不显示Section的名称（&ldquo;.anonymous = true&rdquo;）。
</p>
<div STYLE="line-height: 28.799999237060547px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
<pre STYLE="padding: 0.5em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 1em; line-height: 1.5em; word-break: break-all; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: rgb(248, 248, 255);">s = m:section(TypedSection, <span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">login</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span>, <span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;&quot;</span></span><span STYLE="color: rgb(0, 0, 0);">)
s.addremove </span>= <span STYLE="color: rgb(0, 0, 255);">false</span><span STYLE="color: rgb(0, 0, 0);"> s.anonymous </span>= <span STYLE="color: rgb(0, 0, 255);">true</span></pre>
</div>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;接下来我们需要创建Section中不同内容的交互（创建Option），常见的比如有Value（文本框）、ListValue（下拉框）、Flag（选择框）等等，详细的可以参考官方的文档：&nbsp;<a STYLE="color: rgb(148, 148, 148); text-decoration: none; -webkit-transition: 0.25s; transition: 0.25s; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(148, 148, 148); font-style: italic; font-weight: bold;" REL="nofollow" TARGET="_blank" HREF="http://luci.subsignal.org/trac/wiki/Documentation/CBI">http://luci.subsignal.org/trac/wiki/Documentation/CBI</a>
</p>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;创建Option的过程非常简单，而且创建后系统会无需考虑读取以及写入配置文件的问题，系统都会自动处理。但是根据上述的要求，我们在应用配置以后可能希望启用、禁用或重新启动njit-client，所以我们还需要在页面最后判断用户是否点击了&ldquo;应用&rdquo;按钮，这里与编写asp网页等都是相同的，我们可以通过如下的代码判断是否点击了&ldquo;应用&rdquo;按钮：
</p>
<div STYLE="line-height: 28.799999237060547px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
<pre STYLE="padding: 0.5em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 1em; line-height: 1.5em; word-break: break-all; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: rgb(248, 248, 255);"><span STYLE="color: rgb(0, 0, 255);">local</span> apply = luci.http.formvalue(<span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">cbi.apply</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span><span STYLE="color: rgb(0, 0, 0);">) </span><span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">if</span></span> apply <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">then</span></span> <span STYLE="color: rgb(0, 128, 0);">--[[</span><span STYLE="color: rgb(0, 128, 0);"> 需要处理的代码 </span><span STYLE="color: rgb(0, 128, 0);">]]-- </span><span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">end</span></span></pre>
</div>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;由于剩余的代码都非常简单，所以所以这部分的全部代码见下：
</p>
<div STYLE="line-height: 28.799999237060547px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
<pre STYLE="padding: 0.5em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 1em; line-height: 1.5em; word-break: break-all; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: rgb(248, 248, 255);"><span STYLE="color: rgb(0, 128, 128);"> <span STYLE="color: rgb(0, 153, 153);">1</span></span> <span STYLE="color: rgb(255, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">require</span></span>(<span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">luci.sys</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span><span STYLE="color: rgb(0, 0, 0);">) </span><span STYLE="color: rgb(0, 128, 128);"> <span STYLE="color: rgb(0, 153, 153);">2</span></span> <span STYLE="color: rgb(0, 128, 128);"> <span STYLE="color: rgb(0, 153, 153);">3</span></span> m = <span STYLE="">Map</span>(<span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">njitclient</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span>, translate(<span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">NJIT Client</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span>), translate(<span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">Configure NJIT 802.11x client.</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span><span STYLE="color: rgb(0, 0, 0);">)) </span><span STYLE="color: rgb(0, 128, 128);"> <span STYLE="color: rgb(0, 153, 153);">4</span></span> <span STYLE="color: rgb(0, 128, 128);"> <span STYLE="color: rgb(0, 153, 153);">5</span></span> s = <span STYLE="color: rgb(153, 0, 115);">m:</span>section(<span STYLE="">TypedSection</span>, <span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">login</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span>, <span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;&quot;</span></span><span STYLE="color: rgb(0, 0, 0);">) </span><span STYLE="color: rgb(0, 128, 128);"> <span STYLE="color: rgb(0, 153, 153);">6</span></span> s.addremove = <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">false</span></span> <span STYLE="color: rgb(0, 128, 128);"> <span STYLE="color: rgb(0, 153, 153);">7</span></span> s.anonymous = <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">true</span></span> <span STYLE="color: rgb(0, 128, 128);"> <span STYLE="color: rgb(0, 153, 153);">8</span></span> <span STYLE="color: rgb(0, 128, 128);"> <span STYLE="color: rgb(0, 153, 153);">9</span></span> enable = <span STYLE="color: rgb(153, 0, 115);">s:</span>option(<span STYLE="">Flag</span>, <span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">enable</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span>, translate(<span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">Enable</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span><span STYLE="color: rgb(0, 0, 0);">)) </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">10</span></span> name = <span STYLE="color: rgb(153, 0, 115);">s:</span>option(<span STYLE="">Value</span>, <span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">username</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span>, translate(<span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">Username</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span><span STYLE="color: rgb(0, 0, 0);">)) </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">11</span></span> pass = <span STYLE="color: rgb(153, 0, 115);">s:</span>option(<span STYLE="">Value</span>, <span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">password</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span>, translate(<span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">Password</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span><span STYLE="color: rgb(0, 0, 0);">)) </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">12</span></span> pass.password = <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">true</span></span> <span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">13</span></span> domain = <span STYLE="color: rgb(153, 0, 115);">s:</span>option(<span STYLE="">Value</span>, <span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">domain</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span>, translate(<span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">Domain</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span><span STYLE="color: rgb(0, 0, 0);">)) </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">14</span></span> <span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">15</span></span> ifname = <span STYLE="color: rgb(153, 0, 115);">s:</span>option(<span STYLE="">ListValue</span>, <span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">ifname</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span>, translate(<span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">Interfaces</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span><span STYLE="color: rgb(0, 0, 0);">)) </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">16</span></span> <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">for</span></span> k, v <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">in</span></span> <span STYLE="color: rgb(255, 0, 255);">ipairs</span>(luci.sys.net.devices()) <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">do</span></span> <span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">17</span></span> <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">if</span></span> v ~= <span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">lo</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span> <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">then</span></span> <span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">18</span></span> <span STYLE="color: rgb(0, 0, 0);"> <span STYLE="color: rgb(153, 0, 115);">ifname:</span>value(v) </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">19</span></span> <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">end</span></span> <span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">20</span></span> <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">end</span></span> <span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">21</span></span> <span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">22</span></span> <span STYLE="color: rgb(0, 0, 255);">local</span> apply = luci.http.formvalue(<span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">cbi.apply</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span><span STYLE="color: rgb(0, 0, 0);">) </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">23</span></span> <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">if</span></span> apply <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">then</span></span> <span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">24</span></span> <span STYLE="color: rgb(255, 0, 255);">io.popen</span>(<span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">/etc/init.d/njitclient restart</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span><span STYLE="color: rgb(0, 0, 0);">) </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">25</span></span> <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">end</span></span> <span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">26</span></span> <span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">27</span></span> <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">return</span></span> m</pre>
</div>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;其中Luci全部类库的函数定义和使用说明可以参考如下地址：<a STYLE="color: rgb(148, 148, 148); text-decoration: none; -webkit-transition: 0.25s; transition: 0.25s; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(148, 148, 148); font-style: italic; font-weight: bold;" REL="nofollow" TARGET="_blank" HREF="http://luci.subsignal.org/api/luci/index.html">http://luci.subsignal.org/api/luci/index.html</a>
</p>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;<strong STYLE="">【三、在Bash文件中调用UCI接口】</strong>
</p>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;上边我们已经完成了LuCI配置界面的开发，在配置界面中我们已经能读取并保存配置文件了。接下来我们要编写/etc/init.d/njitclient脚本，使程序最终能运行起来。关于UCI接口在脚本文件中的官方说明可以参考：<a STYLE="color: rgb(148, 148, 148); text-decoration: none; -webkit-transition: 0.25s; transition: 0.25s; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(148, 148, 148); font-style: italic; font-weight: bold;" REL="nofollow" TARGET="_blank" HREF="http://wiki.openwrt.org/doc/devel/config-.ing">http://wiki.openwrt.org/doc/devel/config-scripting</a>
</p>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;要使用UCI调用脚本，首先第一步需要读取配置文件，命令为&ldquo;config_load 配置文件名&rdquo;，比如我们可以这样读入刚才的配置文件：
</p>
<div STYLE="line-height: 28.799999237060547px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
<pre STYLE="padding: 0.5em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 1em; line-height: 1.5em; word-break: break-all; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: rgb(248, 248, 255);">config_<span STYLE=""><span STYLE="font-weight: bold;">load</span> njitclient</span></pre>
</div>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;接下来要遍历配置文件中的Section，可以使用&ldquo;config_foreach 遍历函数名&nbsp;Section类型&rdquo;，例如我们可以这样：
</p>
<div STYLE="line-height: 28.799999237060547px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
<pre STYLE="padding: 0.5em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 1em; line-height: 1.5em; word-break: break-all; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: rgb(248, 248, 255);">config_foreach run_njit <span STYLE="color: rgb(0, 0, 255);">login</span></pre>
</div>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;然后我们去编写名为&ldquo;run_njit&rdquo;的函数，在这个函数中，我们可以使用&ldquo;config_get 变量名 Section名 Section参数名&rdquo;获取变量的值，或者使用&ldquo;config_get_bool 变量名 Section名 Section参数名&rdquo;获取布尔型的值。所以全部的代码见下：
</p>
<div STYLE="line-height: 28.799999237060547px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
<pre STYLE="padding: 0.5em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 1em; line-height: 1.5em; word-break: break-all; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: rgb(248, 248, 255);"><span STYLE="color: rgb(0, 128, 128);"> 1</span> <span STYLE="color: rgb(153, 153, 153); font-weight: bold;">#!/bin/<span STYLE="color: rgb(0, 0, 255);">sh</span></span><span STYLE="color: rgb(0, 0, 255);"></span> /etc/<span STYLE="color: rgb(0, 0, 0);">rc.common </span><span STYLE="color: rgb(0, 128, 128);"> 2</span> START=<span STYLE="color: rgb(128, 0, 128);">50</span> <span STYLE="color: rgb(0, 128, 128);"> 3</span> <span STYLE="color: rgb(0, 128, 128);"> 4</span> <span STYLE="color: rgb(0, 0, 0);">run_njit() </span><span STYLE="color: rgb(0, 128, 128);"> 5</span> <span STYLE="color: rgb(0, 0, 0);">{ </span><span STYLE="color: rgb(0, 128, 128);"> 6</span> <span STYLE="color: rgb(0, 0, 0);"> local enable </span><span STYLE="color: rgb(0, 128, 128);"> 7</span> config_get_bool enable <span STYLE="color: rgb(0, 128, 128);">$<span STYLE="color: rgb(128, 0, 128);">1</span></span><span STYLE="color: rgb(128, 0, 128);"></span><span STYLE="color: rgb(0, 0, 0);"> enable </span><span STYLE="color: rgb(0, 128, 128);"> 8</span> <span STYLE="color: rgb(0, 128, 128);"> 9</span> <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">if</span></span> <span STYLE="">[ <span STYLE="color: rgb(0, 128, 128);">$enable</span> ]</span>; <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">then</span></span> <span STYLE="color: rgb(0, 128, 128);">10</span> <span STYLE="color: rgb(0, 0, 0);"> local username </span><span STYLE="color: rgb(0, 128, 128);">11</span> <span STYLE="color: rgb(0, 0, 0);"> local password </span><span STYLE="color: rgb(0, 128, 128);">12</span> <span STYLE="color: rgb(0, 0, 0);"> local domain </span><span STYLE="color: rgb(0, 128, 128);">13</span> <span STYLE="color: rgb(0, 0, 0);"> local ifname </span><span STYLE="color: rgb(0, 128, 128);">14</span> <span STYLE="color: rgb(0, 128, 128);">15</span> config_get username <span STYLE="color: rgb(0, 128, 128);">$<span STYLE="color: rgb(128, 0, 128);">1</span></span><span STYLE="color: rgb(128, 0, 128);"></span><span STYLE="color: rgb(0, 0, 0);"> username </span><span STYLE="color: rgb(0, 128, 128);">16</span> config_get password <span STYLE="color: rgb(0, 128, 128);">$<span STYLE="color: rgb(128, 0, 128);">1</span></span><span STYLE="color: rgb(128, 0, 128);"></span><span STYLE="color: rgb(0, 0, 0);"> password </span><span STYLE="color: rgb(0, 128, 128);">17</span> config_get domain <span STYLE="color: rgb(0, 128, 128);">$<span STYLE="color: rgb(128, 0, 128);">1</span></span><span STYLE="color: rgb(128, 0, 128);"></span><span STYLE="color: rgb(0, 0, 0);"> domain </span><span STYLE="color: rgb(0, 128, 128);">18</span> config_get ifname <span STYLE="color: rgb(0, 128, 128);">$<span STYLE="color: rgb(128, 0, 128);">1</span></span><span STYLE="color: rgb(128, 0, 128);"></span><span STYLE="color: rgb(0, 0, 0);"> ifname </span><span STYLE="color: rgb(0, 128, 128);">19</span> <span STYLE="color: rgb(0, 128, 128);">20</span> <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">if</span></span> <span STYLE="">[ <span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(0, 128, 128);">$domain</span></span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span> != <span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;&quot;</span></span> ]</span>; <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">then</span></span> <span STYLE="color: rgb(0, 128, 128);">21</span> njit-client <span STYLE="color: rgb(0, 128, 128);">$username</span>@<span STYLE="color: rgb(0, 128, 128);">$domain</span> <span STYLE="color: rgb(0, 128, 128);">$password</span> <span STYLE="color: rgb(0, 128, 128);">$ifname</span> &amp; <span STYLE="color: rgb(0, 128, 128);">22</span> <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">else</span></span> <span STYLE="color: rgb(0, 128, 128);">23</span> njit-client <span STYLE="color: rgb(0, 128, 128);">$username</span> <span STYLE="color: rgb(0, 128, 128);">$password</span> <span STYLE="color: rgb(0, 128, 128);">$ifname</span> &amp; <span STYLE="color: rgb(0, 128, 128);">24</span> <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">fi</span></span> <span STYLE="color: rgb(0, 128, 128);">25</span> <span STYLE="color: rgb(0, 128, 128);">26</span> <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">echo</span></span> <span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">NJIT Client has started.</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span> <span STYLE="color: rgb(0, 128, 128);">27</span> <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">fi</span></span> <span STYLE="color: rgb(0, 128, 128);">28</span> <span STYLE="color: rgb(0, 0, 0);">} </span><span STYLE="color: rgb(0, 128, 128);">29</span> <span STYLE="color: rgb(0, 128, 128);">30</span> <span STYLE="color: rgb(0, 0, 0);">start() </span><span STYLE="color: rgb(0, 128, 128);">31</span> <span STYLE="color: rgb(0, 0, 0);">{ </span><span STYLE="color: rgb(0, 128, 128);">32</span> <span STYLE="color: rgb(0, 0, 0);"> config_load njitclient </span><span STYLE="color: rgb(0, 128, 128);">33</span> config_foreach run_njit <span STYLE="color: rgb(0, 0, 255);">login</span> <span STYLE="color: rgb(0, 128, 128);">34</span> <span STYLE="color: rgb(0, 0, 0);">} </span><span STYLE="color: rgb(0, 128, 128);">35</span> <span STYLE="color: rgb(0, 128, 128);">36</span> <span STYLE="color: rgb(0, 0, 0);">stop() </span><span STYLE="color: rgb(0, 128, 128);">37</span> <span STYLE="color: rgb(0, 0, 0);">{ </span><span STYLE="color: rgb(0, 128, 128);">38</span> <span STYLE="color: rgb(0, 0, 255);">killall</span> njit-<span STYLE="color: rgb(0, 0, 0);">client </span><span STYLE="color: rgb(0, 128, 128);">39</span> <span STYLE="color: rgb(0, 0, 255);">killall</span><span STYLE="color: rgb(0, 0, 0);"> udhcpc </span><span STYLE="color: rgb(0, 128, 128);">40</span> <span STYLE="color: rgb(0, 128, 128);">41</span> <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">echo</span></span> <span STYLE="color: rgb(128, 0, 0);"><span STYLE="color: rgb(221, 17, 68);">&quot;</span></span><span STYLE="color: rgb(221, 17, 68);"><span STYLE="color: rgb(128, 0, 0);">NJIT Client has stoped.</span><span STYLE="color: rgb(128, 0, 0);">&quot;</span></span><span STYLE="color: rgb(128, 0, 0);"></span> <span STYLE="color: rgb(0, 128, 128);">42</span> }</pre>
</div>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;<strong STYLE="">【四、&nbsp;<strong STYLE="">编译开发的程序</strong>&nbsp;】</strong>
</p>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;如果按上述内容创建好上述4个文件，那么配置页面和程序就能在OpenWrt上运行起来了。但是如果要想把自己写的程序打包，还需要创建OpenWrt的Makefile来使用OpenWrt的SDK进行编译。
</p>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;关于LuCI上配置Makefile的官方说明可以见这个地址：<a STYLE="color: rgb(148, 148, 148); text-decoration: none; -webkit-transition: 0.25s; transition: 0.25s; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(148, 148, 148); font-style: italic; font-weight: bold;" REL="nofollow" TARGET="_blank" HREF="http://luci.subsignal.org/trac/wiki/Documentation/Modules">http://luci.subsignal.org/trac/wiki/Documentation/Modules</a>
</p>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;无非就是定义包的名称（PKG_NAME）、版本和生成次数（PKG_VERSION、PKG_RELEASE）、在menuconfig中的分类说明等（define Package/luci-app-njitclient）以及安装时进行的操作（define Package/luci-app-njitclient/install）等等。其中安装的文件分为三种，分别是配置文件、可执行文件以及其他数据文件，其中配置可执行文件时，会自动加入执行权限的，所以不需要额外进行处理。Makefile全部的代码见下：
</p>
<div STYLE="line-height: 28.799999237060547px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
<pre STYLE="padding: 0.5em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 1em; line-height: 1.5em; word-break: break-all; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: rgb(248, 248, 255);"><span STYLE="color: rgb(0, 128, 128);"> <span STYLE="color: rgb(0, 153, 153);">1</span></span> <span STYLE="font-weight: bold;">include</span> <span STYLE="color: rgb(0, 128, 128);">$(</span><span STYLE="">TOPDIR</span>)/<span STYLE="color: rgb(0, 0, 0);">rules.mk </span><span STYLE="color: rgb(0, 128, 128);"> <span STYLE="color: rgb(0, 153, 153);">2</span></span> <span STYLE="color: rgb(0, 128, 128);"> <span STYLE="color: rgb(0, 153, 153);">3</span></span> <span STYLE="">PKG_NAME</span><span STYLE="color: rgb(153, 0, 115);">:</span>=luci-app-<span STYLE="color: rgb(0, 0, 0);">njitclient </span><span STYLE="color: rgb(0, 128, 128);"> <span STYLE="color: rgb(0, 153, 153);">4</span></span> <span STYLE="">PKG_VERSION</span>=<span STYLE="color: rgb(128, 0, 128);"><span STYLE="color: rgb(0, 153, 153);">1.0</span></span> <span STYLE="color: rgb(0, 128, 128);"> <span STYLE="color: rgb(0, 153, 153);">5</span></span> <span STYLE="">PKG_RELEASE</span><span STYLE="color: rgb(153, 0, 115);">:</span>=<span STYLE="color: rgb(128, 0, 128);"><span STYLE="color: rgb(0, 153, 153);">1</span></span> <span STYLE="color: rgb(0, 128, 128);"> <span STYLE="color: rgb(0, 153, 153);">6</span></span> <span STYLE="color: rgb(0, 128, 128);"> <span STYLE="color: rgb(0, 153, 153);">7</span></span> <span STYLE="">PKG_BUILD_DIR</span><span STYLE="color: rgb(153, 0, 115);">:</span>=<span STYLE="color: rgb(0, 128, 128);">$(</span><span STYLE="">BUILD_DIR</span>)/<span STYLE="color: rgb(0, 0, 0);"><span STYLE="color: rgb(0, 128, 128);">$(</span><span STYLE="">PKG_NAME</span>) </span><span STYLE="color: rgb(0, 128, 128);"> <span STYLE="color: rgb(0, 153, 153);">8</span></span> <span STYLE="color: rgb(0, 128, 128);"> <span STYLE="color: rgb(0, 153, 153);">9</span></span> <span STYLE="font-weight: bold;">include</span> <span STYLE="color: rgb(0, 128, 128);">$(</span><span STYLE="">INCLUDE_DIR</span>)/<span STYLE="color: rgb(0, 0, 0);">package.mk </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">10</span></span> <span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">11</span></span> define <span STYLE="">Package</span>/luci-app-<span STYLE="color: rgb(0, 0, 0);">njitclient </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">12</span></span> <span STYLE="">SECTION</span><span STYLE="color: rgb(153, 0, 115);">:</span>=<span STYLE="color: rgb(0, 0, 0);">luci </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">13</span></span> <span STYLE="">CATEGORY</span><span STYLE="color: rgb(153, 0, 115);">:</span>=<span STYLE="color: rgb(0, 0, 0);"><span STYLE="">LuCI</span> </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">14</span></span> <span STYLE="">SUBMENU</span><span STYLE="color: rgb(153, 0, 115);">:</span>=<span STYLE="color: rgb(128, 0, 128);"><span STYLE="color: rgb(0, 153, 153);">3</span></span><span STYLE="color: rgb(0, 0, 0);">. <span STYLE="">Applications</span> </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">15</span></span> <span STYLE="">TITLE</span><span STYLE="color: rgb(153, 0, 115);">:</span>=<span STYLE="">NJIT</span> <span STYLE="color: rgb(128, 0, 128);"><span STYLE="color: rgb(0, 153, 153);">802</span></span><span STYLE="color: rgb(0, 153, 153);">.1</span>X <span STYLE="">Client</span> <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">for</span></span><span STYLE="color: rgb(0, 0, 0);"> <span STYLE="">LuCI</span> </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">16</span></span> <span STYLE="">PKGARCH</span><span STYLE="color: rgb(153, 0, 115);">:</span>=<span STYLE="color: rgb(0, 0, 0);">all </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">17</span></span> <span STYLE="color: rgb(0, 0, 0);">endef </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">18</span></span> <span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">19</span></span> define <span STYLE="">Package</span>/luci-app-njitclient/<span STYLE="color: rgb(0, 0, 0);">description </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">20</span></span> <span STYLE="">This</span> package contains <span STYLE="">LuCI</span> configuration pages <span STYLE="color: rgb(0, 0, 255);"><span STYLE="color: rgb(51, 51, 51); font-weight: bold;">for</span></span><span STYLE="color: rgb(0, 0, 0);"> njit8021xclient. </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">21</span></span> <span STYLE="color: rgb(0, 0, 0);">endef </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">22</span></span> <span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">23</span></span> define <span STYLE="">Build</span>/<span STYLE="color: rgb(0, 0, 0);"><span STYLE="">Prepare</span> </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">24</span></span> <span STYLE="color: rgb(0, 0, 0);">endef </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">25</span></span> <span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">26</span></span> define <span STYLE="">Build</span>/<span STYLE="color: rgb(0, 0, 0);"><span STYLE="">Configure</span> </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">27</span></span> <span STYLE="color: rgb(0, 0, 0);">endef </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">28</span></span> <span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">29</span></span> define <span STYLE="">Build</span>/<span STYLE="color: rgb(0, 0, 0);"><span STYLE="">Compile</span> </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">30</span></span> <span STYLE="color: rgb(0, 0, 0);">endef </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">31</span></span> <span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">32</span></span> define <span STYLE="">Package</span>/luci-app-njitclient/<span STYLE="color: rgb(0, 0, 255);">install</span> <span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">33</span></span> <span STYLE="color: rgb(0, 128, 128);">$(</span><span STYLE="">INSTALL_DIR</span>) <span STYLE="color: rgb(0, 128, 128);">$(</span><span STYLE="color: rgb(128, 0, 128);"><span STYLE="color: rgb(0, 153, 153);">1</span></span>)/etc/<span STYLE="color: rgb(0, 0, 0);">config </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">34</span></span> <span STYLE="color: rgb(0, 128, 128);">$(</span><span STYLE="">INSTALL_DIR</span>) <span STYLE="color: rgb(0, 128, 128);">$(</span><span STYLE="color: rgb(128, 0, 128);"><span STYLE="color: rgb(0, 153, 153);">1</span></span>)/etc/<span STYLE="color: rgb(0, 0, 0);">init.d </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">35</span></span> <span STYLE="color: rgb(0, 128, 128);">$(</span><span STYLE="">INSTALL_DIR</span>) <span STYLE="color: rgb(0, 128, 128);">$(</span><span STYLE="color: rgb(128, 0, 128);"><span STYLE="color: rgb(0, 153, 153);">1</span></span>)/usr/lib/lua/luci/model/<span STYLE="color: rgb(0, 0, 0);">cbi </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">36</span></span> <span STYLE="color: rgb(0, 128, 128);">$(</span><span STYLE="">INSTALL_DIR</span>) <span STYLE="color: rgb(0, 128, 128);">$(</span><span STYLE="color: rgb(128, 0, 128);"><span STYLE="color: rgb(0, 153, 153);">1</span></span>)/usr/lib/lua/luci/<span STYLE="color: rgb(0, 0, 0);">controller </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">37</span></span> <span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">38</span></span> <span STYLE="color: rgb(0, 128, 128);">$(</span><span STYLE="">INSTALL_CONF</span>) .<span STYLE="color: rgb(0, 153, 38);">/files/root</span><span STYLE="color: rgb(0, 153, 38);">/etc/config</span><span STYLE="color: rgb(0, 153, 38);">/njitclient $(<span STYLE="color: rgb(128, 0, 128);">1</span>)/etc</span><span STYLE="color: rgb(0, 153, 38);">/config/<span STYLE="color: rgb(0, 0, 0);">njitclient</span></span><span STYLE="color: rgb(0, 0, 0);"> </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">39</span></span> <span STYLE="color: rgb(0, 128, 128);">$(</span><span STYLE="">INSTALL_BIN</span>) .<span STYLE="color: rgb(0, 153, 38);">/files/root</span><span STYLE="color: rgb(0, 153, 38);">/etc/init</span>.d/njitclient <span STYLE="color: rgb(0, 128, 128);">$(</span><span STYLE="color: rgb(128, 0, 128);"><span STYLE="color: rgb(0, 153, 153);">1</span></span>)/etc/init.d/<span STYLE="color: rgb(0, 0, 0);">njitclient </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">40</span></span> <span STYLE="color: rgb(0, 128, 128);">$(</span><span STYLE="">INSTALL_DATA</span>) .<span STYLE="color: rgb(0, 153, 38);">/files/root</span><span STYLE="color: rgb(0, 153, 38);">/usr/lib</span><span STYLE="color: rgb(0, 153, 38);">/lua/luci</span><span STYLE="color: rgb(0, 153, 38);">/model/cbi</span><span STYLE="color: rgb(0, 153, 38);">/njitclient.lua $(<span STYLE="color: rgb(128, 0, 128);">1</span>)/usr</span><span STYLE="color: rgb(0, 153, 38);">/lib/lua</span><span STYLE="color: rgb(0, 153, 38);">/luci/model</span><span STYLE="color: rgb(0, 153, 38);">/cbi/<span STYLE="color: rgb(0, 0, 0);">njitclient</span></span><span STYLE="color: rgb(0, 0, 0);">.lua </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">41</span></span> <span STYLE="color: rgb(0, 128, 128);">$(</span><span STYLE="">INSTALL_DATA</span>) .<span STYLE="color: rgb(0, 153, 38);">/files/root</span><span STYLE="color: rgb(0, 153, 38);">/usr/lib</span><span STYLE="color: rgb(0, 153, 38);">/lua/luci</span><span STYLE="color: rgb(0, 153, 38);">/controller/njitclient</span>.lua <span STYLE="color: rgb(0, 128, 128);">$(</span><span STYLE="color: rgb(128, 0, 128);"><span STYLE="color: rgb(0, 153, 153);">1</span></span>)/usr/lib/lua/luci/controller/<span STYLE="color: rgb(0, 0, 0);">njitclient.lua </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">42</span></span> <span STYLE="color: rgb(0, 0, 0);">endef </span><span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">43</span></span> <span STYLE="color: rgb(0, 128, 128);"><span STYLE="color: rgb(0, 153, 153);">44</span></span> <span STYLE="color: rgb(0, 128, 128);">$(</span>eval <span STYLE="color: rgb(0, 128, 128);">$(</span>call <span STYLE="">BuildPackage</span>,luci-app-njitclient))</pre>
</div>
<p STYLE="margin: 0px 0px 0.75em; padding: 10px 0px 0px; line-height: 28.799999237060547px; font-size: 16px; word-wrap: break-word; word-break: break-all; text-indent: 1em; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">
&Tab;接下来在编译目录下的package目录下创建一个文件夹，如njitclient，然后将所有的文件按目录复制到该目录下即可。之后配置好OpenWrt的交叉编译环境后就可以使用OpenWrt SDK进行编译了，由于这类文章较多，故不再赘述，可以参考相关链接3及之后的文章。
</p>
<br STYLE=""/>
<br STYLE=""/>
<br STYLE=""/>
</div>
<div STYLE="padding: 12px 15px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(204, 204, 204); border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204); line-height: 1.5; font-size: 14px;">上一篇：<a STYLE="color: rgb(54, 126, 185); text-decoration: none;" HREF="http://m.blog.chinaunix.net/uid-26675482-id-4633889.html">UCI API的使用--OpenWRT </a><br STYLE=""/>
  下一篇：<a STYLE="color: rgb(54, 126, 185); text-decoration: none;" HREF="http://m.blog.chinaunix.net/uid-26675482-id-4634216.html">openwrt - 入門( opkg, uci, luci )</a></div>
<div STYLE="background-color: rgb(55, 55, 55); width: 100%; padding: 10px 0px; line-height: 1.4; text-align: center; color: rgb(102, 102, 102); font-size: 12px;">
<a STYLE="color: rgb(102, 102, 102); text-decoration: none;" HREF="http://blog.itpub.net/">ITPUB博客</a> | <a STYLE="color: rgb(102, 102, 102); text-decoration: none;" HREF="http://www.itpub.net/">ITPUB论坛</a> | <a STYLE="color: rgb(102, 102, 102); text-decoration: none;" HREF="http://bbs.chinaunix.net/">chinaunix论坛</a><br STYLE=""/>

 北京皓辰网域网络信息技术有限公司. 版权所有
</div>
&Tab;&Tab;



</div>
</en-note>      