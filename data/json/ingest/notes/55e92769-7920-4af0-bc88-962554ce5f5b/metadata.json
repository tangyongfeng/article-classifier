{
  "ingest_source": {
    "id": "2d975cc4-b50f-4b50-8ac5-e2467a24fad3",
    "source_type": "evernote_html",
    "source_path": "backups/2023年6月/IT技术/OsmocomBB 源代码分析（1） _ 学步园.html",
    "collected_at": "2025-11-10T15:43:31.062095Z",
    "external_id": null,
    "title_hint": null,
    "language_hint": "en",
    "captured_at": null,
    "checksum": "494aaf138d4ef692632e03c5be1eddf25d74adb0423afa4fdacff30decb5368c",
    "status": "pending",
    "notes": {
      "batch_id": "phase2-backfill-202306"
    }
  },
  "note": {
    "id": "55e92769-7920-4af0-bc88-962554ce5f5b",
    "ingest_source_id": "2d975cc4-b50f-4b50-8ac5-e2467a24fad3",
    "canonical_title": "OsmocomBB 源代码分析（1） _ 学步园",
    "language": "en",
    "ingested_at": "2025-11-10T15:43:31.062102Z",
    "created_at": null,
    "status": "active",
    "importance": 0,
    "attributes": {
      "source_filename": "OsmocomBB 源代码分析（1） _ 学步园.html"
    }
  },
  "variants": [
    {
      "id": "91621295-af99-4b75-971f-c8a91433e359",
      "note_id": "55e92769-7920-4af0-bc88-962554ce5f5b",
      "variant_type": "raw_html",
      "version": 1,
      "created_by": "evernote_ingest:v0",
      "created_at": "2025-11-10T15:43:31.062106Z",
      "content": "---\ntitle: OsmocomBB 源代码分析（1） | 学步园\nupdated: 2016-04-03 12:29:09Z\ncreated: 2016-04-03 12:29:09Z\nsource: http://www.xuebuyuan.com/671923.html\n---\n\n\n\n<en-note><div STYLE=\"position:relative;\"><div STYLE=\"margin-top:10px;padding-top:15px;padding-bottom:10px;border-top-width:1px;border-top-style:solid;border-top-color:rgb(204, 204, 204);font-size:13px;background-color:rgb(255, 255, 255);position:relative;width:700px;\">\n&Tab;&Tab;&Tab;<div STYLE=\"font-size:13px;position:absolute;right:10px;top:10px;width:85px;\">\n&Tab;&Tab;&Tab;&Tab;\n&Tab;&Tab;&Tab;</div>\n&Tab;&Tab;&Tab;<div STYLE=\"padding-top:10px;font-size:13px;\">\n&Tab;&Tab;&Tab;&Tab;\n&Tab;&Tab;&Tab;&Tab;<div STYLE=\"font-size:13px;\"></div>\n&Tab;&Tab;&Tab;&Tab;\n&Tab;&Tab;&Tab;&Tab;<h2 STYLE=\"font-size:15px;margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:0px;\">OsmocomBB 源代码分析（1）</h2>\n&Tab;&Tab;&Tab;&Tab;<div STYLE=\"border-top-color:rgb(115, 115, 115);border-bottom-color:rgb(115, 115, 115);font-size:13px;color:rgb(115, 115, 115);\">\n&Tab;&Tab;&Tab;&Tab;&Tab;<span STYLE=\"border-top-color:rgb(115, 115, 115);border-bottom-color:rgb(115, 115, 115);font-size:13px;\">2013年09月05日</span>\n&Tab;&Tab;&Tab;&Tab;&Tab;<span STYLE=\"border-top-color:rgb(115, 115, 115);border-bottom-color:rgb(115, 115, 115);font-size:13px;\"> &frasl; 综合</span>\n&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&frasl; 共 3625字&Tab;&Tab;&Tab;&Tab;&Tab;&frasl; 字号 <span STYLE=\"border-top-color:rgb(115, 115, 115);border-bottom-color:rgb(115, 115, 115);font-size:13px;\"><a HREF=\"#\" STYLE=\"color:rgb(115, 115, 115);text-decoration-color:rgb(115, 115, 115);text-decoration-line:none;\">小</a> <a HREF=\"#\" STYLE=\"color:rgb(115, 115, 115);text-decoration-color:rgb(115, 115, 115);text-decoration-line:none;\">中</a> <a HREF=\"#\" STYLE=\"color:rgb(115, 115, 115);text-decoration-color:rgb(115, 115, 115);text-decoration-line:none;\">大</a></span>\n&Tab;&Tab;&Tab;&Tab;&Tab;<span STYLE=\"border-top-color:rgb(115, 115, 115);border-bottom-color:rgb(115, 115, 115);font-size:13px;\"> &frasl; <span STYLE=\"border-top-color:rgb(115, 115, 115);border-bottom-color:rgb(115, 115, 115);font-size:13px;\">评论关闭</span></span>\n&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;<span STYLE=\"border-top-color:rgb(115, 115, 115);border-bottom-color:rgb(115, 115, 115);font-size:13px;background-image:url(&quot;http://cdn.xuebuyuan.com/wp-content/themes/HotNewspro/images/login.png&quot;);background-repeat:no-repeat;background-position:0px -82px;\"></span>\n&Tab;&Tab;&Tab;&Tab;</div>\n&Tab;&Tab;&Tab;</div>\n&Tab;&Tab;&Tab;\n&Tab;&Tab;&Tab;<div STYLE=\"margin-top:5px;margin-bottom:5px;font-size:13px;width:700px;overflow-x:hidden;overflow-y:hidden;\">\n&Tab;&Tab;&Tab;&Tab;<div STYLE=\"font-size:13px;line-height:24.05px;\">\n&Tab;&Tab;&Tab;&Tab;&Tab;<div STYLE=\"-moz-binding:url(&quot;about:abp-elemhidehit?406105831881#dummy&quot;);margin-bottom:5px;font-size:13px;float:right;\">\n&Tab;\n<div STYLE=\"font-size:13px;\"></div>\n</div>&Tab;&Tab;&Tab;&Tab;&Tab;<div STYLE=\"font-size:13px;\">\n<h1 STYLE=\"font-size:18px;margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:0px;line-height:33.3px;\"><span STYLE=\"font-family:&quot;Bitstream Vera Sans Mono&quot;;\"><span STYLE=\"font-size:19px;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div></div>\n Section 1:上路（ready to go）</span></span></h1>\n<h2 STYLE=\"font-size:16px;margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:0px;line-height:29.6px;\"><span STYLE=\"font-size:24px;font-family:&quot;Bitstream Vera Sans Mono&quot;;line-height:29px;\"><span STYLE=\"font-size:19px;\"><span STYLE=\"font-size:19px;\">0.OsmocomBB简介</span></span></span></h2>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"><span STYLE=\"font-family:&quot;Bitstream Vera Sans Mono&quot;;\"><span STYLE=\"font-size:19px;\"></span></span></p>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\"><div></div></span><p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"></p>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\">&nbsp; &nbsp; &nbsp; &nbsp;OsmocomBB是GSM协议栈(Protocols stack)的开源实现，全称是Open source mobile communication Baseband.目的是要实现手机端从物理层(layer1)到layer3的三层实现。但是目前来看，真正的物理层(physical layer)并没有真正的开源实现，暂时也没看到实施计划。只有物理层控制。因为真正的物理层是运行在baseband processor的DSP core上,涉及到许多信号处理<span STYLE=\"font-size:13px;\"><a TITLE=\"算法\" TARGET=\"_blank\" HREF=\"http://www.xuebuyuan.com/category/%E7%AE%97%E6%B3%95\" STYLE=\"color:rgb(1, 150, 227);text-decoration-color:rgb(1, 150, 227);text-decoration-line:none;\">算法</a></span>的实现，而且还要牵扯很多硬件RF的东西。</span><p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"></p>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\">&nbsp; &nbsp; &nbsp; &nbsp;OsmocomBB项目始于2010年，到目前，还没有实时操作系统支持，没有GPRS的实现，以及移动管理(Mobility Management)的实现，所以还需很多志愿者的加入。</span></div>\n</div>\n</div>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\"><div></div></span></div>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"></p>\n<h2 STYLE=\"font-size:16px;margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:0px;line-height:29.6px;\"><span STYLE=\"font-family:&quot;Bitstream Vera Sans Mono&quot;;\"><span STYLE=\"font-size:19px;\"></span></span><p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;\"></p>\n<div><span>1.OsmocomBB准备</span></div>\n</h2>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"><span STYLE=\"font-family:&quot;Bitstream Vera Sans Mono&quot;;\"><span STYLE=\"font-size:19px;\"></span></span></p>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\">&nbsp; 硬件：</span></div>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\">&nbsp; &nbsp; &nbsp; a.OsmocomBB支持的手机列表.</span></div>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\">&nbsp; &nbsp; &nbsp; b.PC机</span></div>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\">&nbsp; &nbsp; &nbsp; C.和手机相配的串口线</span></div>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\">以我个人为例，我从旧货市场上面买了Moto C118，然后从网站上买的T191串口线，当然如果买那种RS232转USB的转换线的话，不要买便宜的，便宜的cable通常不能用于OsmocomBB.</span></div>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\"><div></div></span></div>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\">&nbsp; 软件：</span></div>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\">&nbsp; &nbsp; &nbsp; a.Linux操作系统(Ubuntu)</span></div>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\">&nbsp; &nbsp; &nbsp; b.arm-elf编译器</span></div>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\"><div></div></span></div>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\">&nbsp; 确保能够编译<span STYLE=\"font-size:13px;\"><a TITLE=\"代码\" TARGET=\"_blank\" HREF=\"http://www.xuebuyuan.com/\" STYLE=\"color:rgb(1, 150, 227);text-decoration-color:rgb(1, 150, 227);text-decoration-line:none;\">代码</a></span>之前，我们需要安装一些软件包，在ubuntu or Debian中运行以下命令:</span></div>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\">&nbsp;&nbsp;<span STYLE=\"font-size:13px;font-family:monospace;white-space:pre;\">sudo aptitude install libtool shtool autoconf git-core pkg-config make gcc</span>&nbsp;&nbsp;</span></div>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\"><div></div></span></div>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"></p>\n<h2 STYLE=\"font-size:16px;margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:0px;line-height:29.6px;\"><span STYLE=\"font-family:&quot;Bitstream Vera Sans Mono&quot;;\"><span STYLE=\"font-size:19px;\"></span></span><p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;\"></p>\n<div><span>2.获取代码</span></div>\n</h2>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"><span STYLE=\"font-family:&quot;Bitstream Vera Sans Mono&quot;;\"><span STYLE=\"font-size:19px;\"></span></span></p>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\"></span><p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"></p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">用git来获取代码，在一个目录下，执行以下命令：</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp; $ git clone git://git.osmocom.org/osmocom-bb.git</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;&nbsp;$ cd osmocom-bb</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp; $ git pull --rebase&nbsp; &nbsp;</p>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"></p></div>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\"><div></div></span></div>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"></p>\n<h2 STYLE=\"font-size:16px;margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:0px;line-height:29.6px;\"><span STYLE=\"font-family:&quot;Bitstream Vera Sans Mono&quot;;\"><span STYLE=\"font-size:19px;\"></span></span><p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;\"></p>\n<div><span>3.设置编译器</span><div></div>\n&nbsp; </div>\n</h2>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\"></span><p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"></p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">如果要编译 Motorora C118,需要ARM7的elf编译器，下面是下载地址：</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;&nbsp;<a HREF=\"http://www.gnuarm.com/bu-2.15_gcc-3.4.3-c-c++-java_nl-1.12.0_gi-6.1.tar.bz2\" STYLE=\"color:rgb(1, 150, 227);text-decoration-color:rgb(1, 150, 227);text-decoration-line:none;\">http://www.gnuarm.com/bu-2.15_gcc-3.4.3-c-c++-java_nl-1.12.0_gi-6.1.tar.bz2</a></p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">下载后在一个目录解压缩，比如解压缩的路径是 /opt/gnuarm-3.4.3, 那就在ubuntu的home路径下的.bashrc的最后面加上：</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp; export PATH=$PATH:/opt/gnuarm-3.4.3/bin</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">这样就把交叉编译器的路径加到了系统环境变量中了，我们可以在shell中调用编译工具链。</p>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"></p></div>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\"><div></div></span></div>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"></p>\n<h2 STYLE=\"font-size:16px;margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:0px;line-height:29.6px;\"><span STYLE=\"font-family:&quot;Bitstream Vera Sans Mono&quot;;\"><span STYLE=\"font-size:19px;\"></span></span><p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;\"></p>\n<div><span>4.编译，运行，测试<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;\"></p>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;\"></p></span></div>\n</h2>\n<h3 STYLE=\"font-size:14px;margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:0px;line-height:25.9px;\"><span STYLE=\"font-family:&quot;Bitstream Vera Sans Mono&quot;;\"><span STYLE=\"font-size:19px;\"></span></span><p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:14px;\"></p>\n<div STYLE=\"font-size:14px;\"><span STYLE=\"font-size:13px;\">&nbsp; 4.1 编译</span></div>\n</h3>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"><span STYLE=\"font-family:&quot;Bitstream Vera Sans Mono&quot;;\"><span STYLE=\"font-size:19px;\"></span></span></p>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\">&nbsp; </span><p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"></p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">Osmocom-bb的主分支(main branch)不支持对SIM卡的读写相关操作，如果要对真实的SIM卡与网络进行试验，必须转 到另外一个分支上&nbsp;去，即sylvain/testing， 我们可以运行以下命令转到这个分支上:</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">$ cd osmocom-bb</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">$ git checkout -b testing remotes/origin/sylvain/testing</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">下一步就是将 $osmocom-bb/src/target/firmwire/下的Makefile中的&nbsp;CONFIG_TX_ENABLE宏打开：</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"># Uncomment this line if you want to enable Tx (Transmit) Support.</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">-#CFLAGS +=-DCONFIG_TX_ENABLE</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">+CFLAGS +=-DCONFIG_TX_ENABLE</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">然后你就可以运行$osmocom-bb/src/目录下的makefile来编译出可以进行实网测试的binary.</p>\n</div>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"><span STYLE=\"font-family:&quot;Bitstream Vera Sans Mono&quot;;\"><span STYLE=\"font-size:19px;\"></span></span></p>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;font-family:monospace;white-space:pre;\"><div></div></span></div>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;font-family:monospace;white-space:pre;\">&nbsp;&nbsp;<span STYLE=\"font-size:13px;font-weight:700;\">4.2 运行</span><p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"></p>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"></p></span></div>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">现在可以通过命令在测试机上运行layer1，以及短按手机上得电源按钮来将layer1的binary加载到手机的RAM中:</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">$&nbsp;cd src/host/osmocon/</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">$ ./osmocon -p /dev/ttyUSB0 -m c123xor ../../target/firmware/board/compal_e88/layer1.compalram.bin</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">现在运行Desktop端的mobile<span STYLE=\"font-size:13px;\"><a TITLE=\"程序\" TARGET=\"_blank\" HREF=\"http://www.xuebuyuan.com/\" STYLE=\"color:rgb(1, 150, 227);text-decoration-color:rgb(1, 150, 227);text-decoration-line:none;\">程序</a></span>，负责layer2,layer3的功能实现，开启新的终端，运行命令如下：</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">$&nbsp;cd src/host/layer23/src/mobile</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">$ ./mobile -i 127.0.0.1</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">还可以用著名的wireshark 1.4来抓取GSM的信令消息，开启新的终端，运行的命令如下：</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">$&nbsp;nc -u -l 4729&gt;/dev/null &amp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">$ sudo wireshark -k -i lo -f &apos;port 4729&apos;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">在开启telnet服务进行手机控制之前，先要建立配置文件/etc/osmocom/osmocom.cfg，用touch命令来建立：</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">$ sudo mkdir /etc/osmocom/</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">$ sudo touch /etc/osmocom/osmocom.cfg</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;&nbsp;运行命令：</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">$ telnet localhost 4247</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">如果telnet连接成功，则有以下输出：</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">Trying 127.0.0.1...Connected to localhost.</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">Escape character is&apos;^]&apos;.</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">Welcome to the OpenBSC Control interface</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">OsmocomBB&gt;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">这是mobile程序建立的telnet服务，等待客户端去连接，OsmocomBB目前用这个用户接口来控制手机各种功能。</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">在此输入命令：</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">OsmocomBB&gt;enable&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">OsmocomBB# sim reader 1</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">运行此命令后，如果观察Wireshark的log输出，我们应该可以看到Location Update 的信令流程。</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">然后还可以通过命令查看SIM卡信息：</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">OsmocomBB# show subscriber</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">如果要打电话，运行以下命令：</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">OsmocomBB# call 1 112</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">在运行过程中，wireshark, layer1, mobile三个程序都有相应输出，分别是GSM信令，layer1的代码流程，mobile的layer2,layer3的流程。</p>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"><span STYLE=\"font-family:&quot;Bitstream Vera Sans Mono&quot;;\"><span STYLE=\"font-size:19px;\"><div></div></span></span></p>\n<p ALIGN=\"justify\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"><span STYLE=\"font-family:&quot;Bitstream Vera Sans Mono&quot;;\"><span STYLE=\"font-size:19px;\"><span STYLE=\"font-family:&quot;Bitstream Vera Sans Mono&quot;;\"><span STYLE=\"font-size:19px;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div></div>\n Section 2:</span><span STYLE=\"font-size:19px;\">Overview on OsmocomBB software stack</span></span></span></span></p>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"><span STYLE=\"font-family:&quot;Bitstream Vera Sans Mono&quot;;\"><span STYLE=\"font-size:19px;\"><span STYLE=\"font-family:&quot;Bitstream Vera Sans Mono&quot;;\"><span STYLE=\"font-size:19px;\"></span></span></span></span></p>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"><span STYLE=\"font-size:13px;\"><span STYLE=\"font-size:19px;\"><span STYLE=\"font-size:19px;\"><span STYLE=\"font-size:19px;\"></span></span></span></span></p>\n<div STYLE=\"font-size:7px;\"><span STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\">这一节简要描述下通用手机无线通信模块的结构和OsmocomBB软件结构。</span></span></div>\n<div STYLE=\"font-size:7px;\"><span STYLE=\"font-size:13px;\"><div></div></span></div>\n<div STYLE=\"font-size:7px;font-weight:700;\"><span>1. RF singal chain</span></div>\n<div STYLE=\"font-size:7px;\"><span STYLE=\"font-size:13px;\"><div></div></span></div>\n<div STYLE=\"font-size:7px;\"><span STYLE=\"font-size:13px;\">首先从信号的接收模块开始，这块都是硬件实现，看下图：</span></div>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"></p>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"><img src=\"../_resources/c797a080334a580846b98e6414f895d9.png\"  height=\"145\" width=\"644\" alt=\"\" hash=\"c797a080334a580846b98e6414f895d9\" type=\"image/png\" style=\"border-top-color:rgb(0, 0, 0);border-bottom-color:rgb(0, 0, 0);font-size:13px;\" /></en-media></p>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"></p>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">空中的GSM得RF信号通过天线（Antenna）接收到，送到RF混频器（Mixer）,混频器将信号降频（down-conversion）到模拟的baseband的I/Q信号,这个过程是一些数学运算，我会在以后的读书笔记中叙述这个过程。模拟I/Q信号接着被送到ABB进行AD转换，转化成数字I/Q信号，I/Q数字信号继续被送到数字基带处理器（Digital Baseband Processor）的串口（baseband serial port）上。上图的Calypso指的是TI推出的GSM基带处理芯片，Mixer也叫RF<div></div>\n transciver, 是一个专门的芯片，在OsmocomBB推荐的手机方案中用的芯片是TI TRF6151C，ABB（Analog Baseband Processor）也是单独芯片，TI&nbsp;TWL3025BZGMR。不过现在集成化程度比以前有提高，很多芯片商都把RF transciver和ABB集成到一块芯片上，比如Infineon PMB6272, RDA 6220。</p>\n<div STYLE=\"margin-block-start:;margin-block-end:;margin-inline-start:;margin-inline-end:;width:660px;color:rgb(78, 99, 132);line-height:23px;margin-top:5px;margin-bottom:5px;padding-top:10px;padding-bottom:10px;clear:both;border-top-width:1px;border-bottom-width:1px;border-top-style:solid;border-bottom-style:solid;border-top-color:rgb(204, 204, 204);border-bottom-color:rgb(204, 204, 204);\"><p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;border-top-color:rgb(78, 99, 132);border-bottom-color:rgb(78, 99, 132);font-size:13px;\"><span STYLE=\"border-top-color:rgb(78, 99, 132);border-bottom-color:rgb(78, 99, 132);font-size:13px;\"><span STYLE=\"border-top-color:rgb(78, 99, 132);border-bottom-color:rgb(78, 99, 132);font-size:13px;white-space:pre;\"></span></span></p></div>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"><span STYLE=\"font-size:13px;\"><span><span STYLE=\"font-family:monospace;\"><div></div></span></span></span></p>\n<h2 STYLE=\"font-size:16px;margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:0px;line-height:29.6px;\"><span><span STYLE=\"font-size:13px;font-weight:700;\"><span STYLE=\"font-size:13px;font-family:monospace;\"><span STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;white-space:pre;\"></span></span></span></span></span><span STYLE=\"font-family:&quot;Bitstream Vera Sans Mono&quot;;font-weight:700;\"><span STYLE=\"white-space:pre;\">2.Inside<div></div>\n the digital baseband processor</span></span><div></div></h2>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"><span STYLE=\"font-size:13px;font-family:Microsoft YaHei;\"></span></p>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;font-family:monospace;white-space:pre;\">请看框图：<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"></p>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"><img src=\"../_resources/9b1d7cc386f2fd8a9964a4ddf8c2eb78.png\"  height=\"123\" width=\"593\" alt=\"\" hash=\"9b1d7cc386f2fd8a9964a4ddf8c2eb78\" type=\"image/png\" style=\"border-top-color:rgb(0, 0, 0);border-bottom-color:rgb(0, 0, 0);font-size:13px;\" /></en-media><div></div></p></span></div>\n<div STYLE=\"font-size:13px;\">\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"></p>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"></p>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">在数字基带处理器中，一般有两个CPU core。Calypso方案是个ARM7的core，用来运行协议栈软件，一般是一个小巧的实时操作系统（realtime OS）与协议栈应用的组合。另外一个CPU是 DSP core，Calypso方案使用的是TI的dsp core，带有硬件运算单元，用来处理数字信号，比如FFT变换，滤波，以及信道编解码。两个CPU core通过共享内存（shared memory）来通信。</p>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">比如上图中，数字基带采样信号通过基带串口（BSP）传入DSP，在dsp中这些信号被处理，被解调（demodulation）,去交织（deinterleaved）,解码等。然后通过sharememory传送给ARM core。在ARM core上，Osmocom-BB的layer1程序处理来自DSP的MAC数据块，然后通过L1CTL模块向串口发送。\n</p><p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"></p>\n<div STYLE=\"font-size:13px;\">\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;white-space:pre;\"><span STYLE=\"font-weight:700;\"><span><span STYLE=\"white-space:pre;\">3.On the host PC</span></span></span></span></span><div></div><span STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;white-space:pre;\"></span></span></div>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"><span STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;white-space:pre;\"><div></div></span></span></p></div>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-size:13px;font-family:monospace;\"><span STYLE=\"font-size:13px;white-space:pre;\">框图如下：</span></span></div>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"><span STYLE=\"font-size:13px;font-family:monospace;white-space:pre;\"><img src=\"../_resources/5aa066b19cb7dfe36d3fa8da5339d76d.png\"  height=\"246\" width=\"585\" alt=\"\" hash=\"5aa066b19cb7dfe36d3fa8da5339d76d\" type=\"image/png\" style=\"border-top-color:rgb(0, 0, 0);border-bottom-color:rgb(0, 0, 0);font-size:13px;\" /></en-media></span></p>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\"></p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">在PC端，程序osmocon通过串口接收到L1CTL消息，然后将其通过unix socket发送到layer23程序（比如mobile程序）。</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">&nbsp;</p>\n<p ALIGN=\"left\" STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">参考资料：</p>\n<div STYLE=\"font-size:13px;\"><span STYLE=\"font-family:monospace;\"><span STYLE=\"white-space:pre;\"><span STYLE=\"font-family:Microsoft YaHei;\"><div></div>\n1.<a HREF=\"http://bb.osmocom.org/trac/\" STYLE=\"color:rgb(1, 150, 227);text-decoration-color:rgb(1, 150, 227);text-decoration-line:none;\">http://bb.osmocom.org</a></span><div></div></span></span></div>\n</div>\n<p STYLE=\"margin-block-start:;margin-block-end:;margin-top:0px;margin-bottom:10px;font-size:13px;\">\n</p>\n</div>\n\n<div STYLE=\"font-size:0px;height:0px;line-height:0px;clear:both;\"></div>&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;</div>\n&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;&Tab;</div>\n&Tab;&Tab;&Tab;<div STYLE=\"border-top-width:1px;border-bottom-width:1px;border-top-style:solid;border-bottom-style:solid;border-top-color:rgb(204, 204, 204);border-bottom-color:rgb(204, 204, 204);font-size:13px;float:right;width:28px;\">\n&Tab;&Tab;&Tab;&Tab;<a HREF=\"#\" STYLE=\"color:rgb(0, 0, 0);text-decoration-color:rgb(0, 0, 0);text-decoration-line:none;\">返回</a>\n&Tab;&Tab;&Tab;</div>\n&Tab;&Tab;&Tab;<div STYLE=\"font-size:13px;clear:both;\"></div>\n&Tab;&Tab;&Tab;\n&Tab;&Tab;&Tab;<i STYLE=\"position:absolute;width:5px;height:5px;font-size:0px;background-image:url(&quot;http://cdn.xuebuyuan.com/wp-content/themes/HotNewspro/images/yuan.gif&quot;);background-repeat:no-repeat;left:-1px;top:-1px;display:block;\"></i>\n&Tab;&Tab;&Tab;<i STYLE=\"position:absolute;width:5px;height:5px;font-size:0px;background-image:url(&quot;http://cdn.xuebuyuan.com/wp-content/themes/HotNewspro/images/yuan.gif&quot;);background-position:100% 0%;background-repeat:no-repeat;right:-1px;top:-1px;display:block;\"></i>\n&Tab;&Tab;</div></div></en-note>      ",
      "content_path": null,
      "diff_base_variant_id": null,
      "metadata": {
        "checksum": "494aaf138d4ef692632e03c5be1eddf25d74adb0423afa4fdacff30decb5368c",
        "path": "backups/2023年6月/IT技术/OsmocomBB 源代码分析（1） _ 学步园.html"
      }
    },
    {
      "id": "493fa1c3-8efd-4b21-9d2e-f422de25bae4",
      "note_id": "55e92769-7920-4af0-bc88-962554ce5f5b",
      "variant_type": "clean_text",
      "version": 1,
      "created_by": "evernote_ingest:v0",
      "created_at": "2025-11-10T15:43:31.062109Z",
      "content": "---\ntitle: OsmocomBB 源代码分析（1） | 学步园\nupdated: 2016-04-03 12:29:09Z\ncreated: 2016-04-03 12:29:09Z\nsource: http://www.xuebuyuan.com/671923.html\n---\n\nOsmocomBB 源代码分析（1）\n\n2013年09月05日\n\n ⁄ 综合\n\n ⁄ 共 3625字 ⁄ 字号\n小\n\n中\n\n大\n\n ⁄\n评论关闭\n\n Section 1:上路（ready to go）\n\n0.OsmocomBB简介\n\n       OsmocomBB是GSM协议栈(Protocols stack)的开源实现，全称是Open source mobile communication Baseband.目的是要实现手机端从物理层(layer1)到layer3的三层实现。但是目前来看，真正的物理层(physical layer)并没有真正的开源实现，暂时也没看到实施计划。只有物理层控制。因为真正的物理层是运行在baseband processor的DSP core上,涉及到许多信号处理\n算法\n的实现，而且还要牵扯很多硬件RF的东西。\n\n       OsmocomBB项目始于2010年，到目前，还没有实时操作系统支持，没有GPRS的实现，以及移动管理(Mobility Management)的实现，所以还需很多志愿者的加入。\n\n1.OsmocomBB准备\n\n  硬件：\n\n      a.OsmocomBB支持的手机列表.\n\n      b.PC机\n\n      C.和手机相配的串口线\n\n以我个人为例，我从旧货市场上面买了Moto C118，然后从网站上买的T191串口线，当然如果买那种RS232转USB的转换线的话，不要买便宜的，便宜的cable通常不能用于OsmocomBB.\n\n  软件：\n\n      a.Linux操作系统(Ubuntu)\n\n      b.arm-elf编译器\n\n  确保能够编译\n代码\n之前，我们需要安装一些软件包，在ubuntu or Debian中运行以下命令:\n\nsudo aptitude install libtool shtool autoconf git-core pkg-config make gcc\n  \n2.获取代码\n\n用git来获取代码，在一个目录下，执行以下命令：\n\n  $ git clone git://git.osmocom.org/osmocom-bb.git\n\n  $ cd osmocom-bb\n\n  $ git pull --rebase   \n\n3.设置编译器\n\n如果要编译 Motorora C118,需要ARM7的elf编译器，下面是下载地址：\n\nhttp://www.gnuarm.com/bu-2.15_gcc-3.4.3-c-c++-java_nl-1.12.0_gi-6.1.tar.bz2\n\n下载后在一个目录解压缩，比如解压缩的路径是 /opt/gnuarm-3.4.3, 那就在ubuntu的home路径下的.bashrc的最后面加上：\n\n  export PATH=$PATH:/opt/gnuarm-3.4.3/bin\n\n这样就把交叉编译器的路径加到了系统环境变量中了，我们可以在shell中调用编译工具链。\n\n4.编译，运行，测试\n\n  4.1 编译\n\nOsmocom-bb的主分支(main branch)不支持对SIM卡的读写相关操作，如果要对真实的SIM卡与网络进行试验，必须转 到另外一个分支上 去，即sylvain/testing， 我们可以运行以下命令转到这个分支上:\n\n$ cd osmocom-bb\n\n$ git checkout -b testing remotes/origin/sylvain/testing\n\n下一步就是将 $osmocom-bb/src/target/firmwire/下的Makefile中的 CONFIG_TX_ENABLE宏打开：\n\n# Uncomment this line if you want to enable Tx (Transmit) Support.\n\n-#CFLAGS +=-DCONFIG_TX_ENABLE\n\n+CFLAGS +=-DCONFIG_TX_ENABLE\n\n然后你就可以运行$osmocom-bb/src/目录下的makefile来编译出可以进行实网测试的binary.\n\n4.2 运行\n\n现在可以通过命令在测试机上运行layer1，以及短按手机上得电源按钮来将layer1的binary加载到手机的RAM中:\n\n$ cd src/host/osmocon/\n\n$ ./osmocon -p /dev/ttyUSB0 -m c123xor ../../target/firmware/board/compal_e88/layer1.compalram.bin\n\n现在运行Desktop端的mobile\n程序\n，负责layer2,layer3的功能实现，开启新的终端，运行命令如下：\n\n$ cd src/host/layer23/src/mobile\n\n$ ./mobile -i 127.0.0.1\n\n还可以用著名的wireshark 1.4来抓取GSM的信令消息，开启新的终端，运行的命令如下：\n\n$ nc -u -l 4729>/dev/null &\n\n$ sudo wireshark -k -i lo -f 'port 4729'\n\n在开启telnet服务进行手机控制之前，先要建立配置文件/etc/osmocom/osmocom.cfg，用touch命令来建立：\n\n$ sudo mkdir /etc/osmocom/\n\n$ sudo touch /etc/osmocom/osmocom.cfg\n\n  运行命令：\n\n$ telnet localhost 4247\n\n如果telnet连接成功，则有以下输出：\n\nTrying 127.0.0.1...Connected to localhost.\n\nEscape character is'^]'.\n\nWelcome to the OpenBSC Control interface\n\nOsmocomBB>\n\n这是mobile程序建立的telnet服务，等待客户端去连接，OsmocomBB目前用这个用户接口来控制手机各种功能。\n\n在此输入命令：\n\nOsmocomBB>enable \n\nOsmocomBB# sim reader 1\n\n运行此命令后，如果观察Wireshark的log输出，我们应该可以看到Location Update 的信令流程。\n\n然后还可以通过命令查看SIM卡信息：\n\nOsmocomBB# show subscriber\n\n如果要打电话，运行以下命令：\n\nOsmocomBB# call 1 112\n\n在运行过程中，wireshark, layer1, mobile三个程序都有相应输出，分别是GSM信令，layer1的代码流程，mobile的layer2,layer3的流程。\n\n Section 2:\nOverview on OsmocomBB software stack\n\n这一节简要描述下通用手机无线通信模块的结构和OsmocomBB软件结构。\n\n1. RF singal chain\n\n首先从信号的接收模块开始，这块都是硬件实现，看下图：\n\n空中的GSM得RF信号通过天线（Antenna）接收到，送到RF混频器（Mixer）,混频器将信号降频（down-conversion）到模拟的baseband的I/Q信号,这个过程是一些数学运算，我会在以后的读书笔记中叙述这个过程。模拟I/Q信号接着被送到ABB进行AD转换，转化成数字I/Q信号，I/Q数字信号继续被送到数字基带处理器（Digital Baseband Processor）的串口（baseband serial port）上。上图的Calypso指的是TI推出的GSM基带处理芯片，Mixer也叫RF\n\n transciver, 是一个专门的芯片，在OsmocomBB推荐的手机方案中用的芯片是TI TRF6151C，ABB（Analog Baseband Processor）也是单独芯片，TI TWL3025BZGMR。不过现在集成化程度比以前有提高，很多芯片商都把RF transciver和ABB集成到一块芯片上，比如Infineon PMB6272, RDA 6220。\n\n2.Inside\n\n the digital baseband processor\n\n请看框图：\n\n在数字基带处理器中，一般有两个CPU core。Calypso方案是个ARM7的core，用来运行协议栈软件，一般是一个小巧的实时操作系统（realtime OS）与协议栈应用的组合。另外一个CPU是 DSP core，Calypso方案使用的是TI的dsp core，带有硬件运算单元，用来处理数字信号，比如FFT变换，滤波，以及信道编解码。两个CPU core通过共享内存（shared memory）来通信。\n\n比如上图中，数字基带采样信号通过基带串口（BSP）传入DSP，在dsp中这些信号被处理，被解调（demodulation）,去交织（deinterleaved）,解码等。然后通过sharememory传送给ARM core。在ARM core上，Osmocom-BB的layer1程序处理来自DSP的MAC数据块，然后通过L1CTL模块向串口发送。\n\n3.On the host PC\n\n框图如下：\n\n在PC端，程序osmocon通过串口接收到L1CTL消息，然后将其通过unix socket发送到layer23程序（比如mobile程序）。\n\n参考资料：\n\n1.\nhttp://bb.osmocom.org\n\n返回",
      "content_path": null,
      "diff_base_variant_id": null,
      "metadata": {
        "language": "en",
        "length": 4139,
        "rule_count": 2,
        "applied_rules": [
          {
            "rule_id": "dedupe_lines",
            "description": "Collapse adjacent duplicate lines",
            "note": "collapsed duplicate adjacent lines"
          },
          {
            "rule_id": "whitespace",
            "description": "Normalize whitespace",
            "note": "collapsed whitespace"
          }
        ]
      }
    }
  ],
  "extractions": [
    {
      "id": "2720c6bd-5c79-487c-a698-d5bc96f8d053",
      "note_id": "55e92769-7920-4af0-bc88-962554ce5f5b",
      "extractor": "llm_enhance:v0#qwen3:30b",
      "payload": {
        "summary": "OsmocomBB是GSM协议栈开源实现，分析其源代码结构、编译流程及GSM网络协议栈实现，包含硬件准备、软件环境配置及通信测试方法。",
        "keywords": [
          "GSM协议栈",
          "开源实现",
          "源代码分析",
          "通信协议",
          "手机协议栈"
        ],
        "action_items": [
          "无"
        ],
        "source": "qwen3:30b",
        "category_path": [
          "Education"
        ],
        "new_category_suggestion": [
          "Education",
          "Technology",
          "Open Source Projects"
        ]
      },
      "version": 1,
      "created_at": "2025-11-11T20:59:41.708832Z",
      "created_by": "llm_enhance:v0",
      "quality_score": 0.255
    }
  ],
  "journal": {
    "id": "2cede9db-dc73-4776-9dc4-17f288b82f35",
    "note_id": "55e92769-7920-4af0-bc88-962554ce5f5b",
    "stage": "ingest",
    "agent_id": "evernote_ingest:v0",
    "started_at": "2025-11-10T15:43:31.062115Z",
    "finished_at": "2025-11-10T15:43:31.062116Z",
    "status": "success",
    "input_ref": {
      "task_id": "677986ac-3215-436c-b28d-045560926e4b",
      "source_path": "backups/2023年6月/IT技术/OsmocomBB 源代码分析（1） _ 学步园.html",
      "checksum": "494aaf138d4ef692632e03c5be1eddf25d74adb0423afa4fdacff30decb5368c"
    },
    "output_ref": {
      "ingest_source": "2d975cc4-b50f-4b50-8ac5-e2467a24fad3",
      "note": "55e92769-7920-4af0-bc88-962554ce5f5b",
      "variants": [
        "91621295-af99-4b75-971f-c8a91433e359",
        "493fa1c3-8efd-4b21-9d2e-f422de25bae4"
      ]
    },
    "error_detail": null
  },
  "llm": {
    "status": "success",
    "model": "qwen3:30b",
    "updated_at": "2025-11-11T20:59:41.708582Z",
    "latency_seconds": 31.17866904195398,
    "attempts": 1,
    "summary": {
      "summary": "OsmocomBB是GSM协议栈开源实现，分析其源代码结构、编译流程及GSM网络协议栈实现，包含硬件准备、软件环境配置及通信测试方法。",
      "keywords": [
        "GSM协议栈",
        "开源实现",
        "源代码分析",
        "通信协议",
        "手机协议栈"
      ],
      "action_items": [
        "无"
      ],
      "source": "qwen3:30b",
      "category_path": [
        "Education"
      ],
      "new_category_suggestion": [
        "Education",
        "Technology",
        "Open Source Projects"
      ]
    },
    "quality": {
      "score": 0.255,
      "metrics": {
        "input_chars": 4139.0,
        "input_lines": 106.0,
        "summary_chars": 67.0,
        "summary_coverage_ratio": 0.016,
        "keyword_hit_rate": 0.6,
        "action_item_count": 1.0,
        "unique_summary_sentences": 1.0,
        "estimated_read_seconds": 248.3
      }
    }
  }
}