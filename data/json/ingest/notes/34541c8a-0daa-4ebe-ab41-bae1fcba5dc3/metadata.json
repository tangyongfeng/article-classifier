{
  "ingest_source": {
    "id": "84e5b077-f1b7-440b-9a2f-b10b888a8e31",
    "source_type": "evernote_html",
    "source_path": "backups/2023年6月/IT技术/FreeBsd也可以部署KVM.html",
    "collected_at": "2025-11-10T15:43:30.766748Z",
    "external_id": null,
    "title_hint": null,
    "language_hint": "no",
    "captured_at": null,
    "checksum": "29cdc6db8e466b1f7c79844a7b86e747733e8fe6d1215faa89924a70aaaac226",
    "status": "pending",
    "notes": {
      "batch_id": "phase2-backfill-202306"
    }
  },
  "note": {
    "id": "34541c8a-0daa-4ebe-ab41-bae1fcba5dc3",
    "ingest_source_id": "84e5b077-f1b7-440b-9a2f-b10b888a8e31",
    "canonical_title": "FreeBsd也可以部署KVM",
    "language": "no",
    "ingested_at": "2025-11-10T15:43:30.766751Z",
    "created_at": null,
    "status": "active",
    "importance": 0,
    "attributes": {
      "source_filename": "FreeBsd也可以部署KVM.html"
    }
  },
  "variants": [
    {
      "id": "e2d7a5aa-9af1-4009-a84b-a3979dca5216",
      "note_id": "34541c8a-0daa-4ebe-ab41-bae1fcba5dc3",
      "variant_type": "raw_html",
      "version": 1,
      "created_by": "evernote_ingest:v0",
      "created_at": "2025-11-10T15:43:30.766754Z",
      "content": "---\ntitle: FreeBsd也可以部署KVM\nupdated: 2019-02-18 07:46:29Z\ncreated: 2019-02-18 07:46:29Z\nsource: https://zhuanlan.zhihu.com/p/38089691\n---\n\n\n<en-note>\n  <div>\n<div><br/></div><div STYLE=\"font-size: 16px; display:block; min-width: 100%; \"> <div STYLE=\"background-color:transparent;font:inherit;vertical-align:baseline;\"><div STYLE=\"background-color:transparent;font:inherit;vertical-align:baseline;font-family:&quot;PT Serif&quot;;font-size:16px;line-height:1.5em;color:rgb(31, 9, 9);text-align:left;\"><div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\"><div STYLE=\"z-index:200;padding-left:2em;padding-right:2em;margin-left:auto;margin-right:auto;position:relative;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;width:36em;\"><div STYLE=\"position:relative;margin-left:-25px;margin-right:25px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\"><div STYLE=\"position:relative;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;padding-top:4.5em;padding-bottom:9em;\"><div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><div STYLE=\"margin-bottom:0px;position:relative;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\"><div STYLE=\"margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\"><div STYLE=\"margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\"><h1 STYLE=\"padding:0px;margin:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:35px;line-height:35px;margin-bottom:20px;font-family:&quot;PT Serif&quot;;text-align:left;\">FreeBsd也可以部署KVM</h1><div STYLE=\"margin-bottom:0px;position:relative;margin:0px;height:1em;line-height:1;text-align:center;padding:0px;border:0px;font:inherit;vertical-align:baseline;padding-top:1.5em;padding-bottom:1.5em;\"><div STYLE=\"margin-bottom:0px;position:absolute;left:-4em;top:50%;z-index:10;width:100%;padding-left:4em;padding-right:4em;height:0.1em;margin:0px;opacity:0.5;padding:0px;border:0px;font:inherit;vertical-align:baseline;background:-webkit-linear-gradient(0deg, rgb(243, 242, 238) 1%, rgb(31, 9, 9) 50%, rgb(243, 242, 238) 99%);\"><span STYLE=\"font:inherit;position:absolute;left:-4em;top:50%;z-index:10;width:100%;padding-left:4em;padding-right:4em;height:0.1em;margin:0px;opacity:0.5;background:-webkit-linear-gradient(0deg, rgb(243, 242, 238) 1%, rgb(31, 9, 9) 50%, rgb(243, 242, 238) 99%);\"></span></div></div></div><div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><div STYLE=\"margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\"><div STYLE=\"margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\"><div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><span STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\"><div STYLE=\"margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\"><div STYLE=\"margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\"><a HREF=\"https://www.zhihu.com/people/alex-81-53-67\" TARGET=\"_blank\" STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);\">Alex</a></div></div></span></div><div STYLE=\"margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\"><div STYLE=\"margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\"><div STYLE=\"margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\">公众号：身边的行囊，传播正确的知识。</div></div></div></div></div></div><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">一．修改freebsd默认安装源</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">Freebsd默认安装源无法安装以下软件，所以需要更换新的安装源</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><b STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;\">1.更换软件源</b></p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">Setenv PACKAGESITE <a HREF=\"http://link.zhihu.com/?target=http%3A//mirror.its.dal.ca/freebsd/releases/amd64/9.2-RELEASE/packages/Latest/\" TARGET=\"_blank\" STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);\">http://mirror.its.dal.ca/freebsd/releases/amd64/9.2-RELEASE/packages/Latest/</a></p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"> freebsd-update fetch install</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"> portsnap fetch extract</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><b STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;\">2.安装 kqemu-kmod和qemu</b></p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"> pkg_add -r kqemu-kmod</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"> pkg_add -r qemu</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><b STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;\">3.加载kvm核心模块</b></p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">kldload kqemu</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">kldload aio</p><h2 STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;font-family:&quot;PT Serif&quot;;text-align:left;\"><b STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;\">二．创建和安装虚拟机系统</b></h2><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><b STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;\">1.为了便于管理新建虚拟机相关文件夹</b></p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">mkdir /vm</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">mkdir /vm/iso</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">mkdir /vm/FreeBSD</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><b STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;\">2.创建image文件（创建虚拟机硬盘）创建了一个50G的硬盘空间，具体空间可以根据实际需要设置</b></p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">qemu-img create -f qcow2 /vm/FreeBSD/freebsd.img 50G</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><b STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;\">3.创建和安装虚拟机系统</b></p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">一定要根据安装的系统选择32位安装命令或64位安装命令，否则执行后在安装系统时会提示cpu不支持（-vnc和冒号之间有空格）</p><div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;display:block;margin-bottom:1em;margin-top:1em;\"><div STYLE=\"margin-bottom:0px;display:block;text-align:center;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-top:1em;\"><img src=\"../_resources/v2-9edd9bcb77e13df224f713be7ec122ae_r.jpg\"  type=\"image/jpeg\" hash=\"da161e52488149a174dfaf7b4ca68470\" width=\"576\" height=\"339\" style=\"display:block;max-width:100%;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;border-color:rgb(31, 9, 9);\" alt=\"v2-9edd9bcb77e13df224f713be7ec122ae_r.jpg\" /></en-media></div></div><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><b STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;\">安装32位系统</b></p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">qemu -cdrom /vm/iso/freebsd9.2.iso -hda /vm/freebsd.img -m 1024 -boot d kernel-kqemu -vnc :0 &ndash;localtime</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><b STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;\">安装64位系统</b></p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">qemu-system-x86_64 -cdrom FreeBSD-9.2-RELEASE-amd64-disc1.iso -hda freebsd.img -m 1024 -boot d kernel-kqemu -vnc :0 -localtime</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><b STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;\">参数说明：</b></p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">-cdrom：指定从光盘启动，也可以用该参数指定iso文件</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">-had：指定硬盘文件</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">-m：指定内存单位M</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">-boot：指定启动方式，d是从光盘启动</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">-vnc：指定vnc端口:0表示5900端口</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">-localtime：制动虚拟机使用宿主机时间</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><b STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;\">4.系统安装完成后直接ctrl+c结束掉进程，然后执行下面的命令启动虚拟机</b></p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">（按下面的命令启动虚拟后虚拟机是无法和外面进行通信的，因为没有给虚拟机指定和宿主机通信网卡）</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">qemu-system-x86_64  -hda /vm/FreeBSD_9.2x64/freebsd.img -m 1024 kernel-kqemu -vnc :0 -localtime</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><b STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;\">三．创建bridge和tap接口</b></p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">虚拟机和宿主机之间通信使用的是Linux bridge</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><b STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;\">1.开启tap支持</b></p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">echo net.link.tap.user_open=1 &gt;&gt; /etc/sysctl.conf</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">echo net.link.tap.up_on_open=1 &gt;&gt; /etc/sysctl.conf</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><b STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;\">2.开机开启kqemu</b></p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">在/etc/rc.conf下添加</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">ifconfig_em1=&quot; inet 192.168.1.29 netmask 255.255.255.0&quot;</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">kqemu_enable=&quot;YES&quot;</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><b STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;\">3.创建bridge和tap接口</b></p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">chmod 0660 /dev/tap0----不执行这条命令创建tap0时会报错</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">ifconfig bridge0 create</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">ifconfig tap0 create</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">ifconfig bridge0 addm em1 addm tap0 up ---将em1和tap0加入到bridge0</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">（ifconfig bridge0 destroy 删除接口命令）</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><b STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;\">四．常见问题</b></p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">1.bridge和tap的在创建后会自动生产mac地址，虚拟机也会自动生成mac地址，也就是说bridge、tap和虚拟机中的网口都会重新自动生成mac地址不会引用真实网卡的mac地址</p><div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;display:block;margin-bottom:1em;margin-top:1em;\"><div STYLE=\"margin-bottom:0px;display:block;text-align:center;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-top:1em;\"><img src=\"../_resources/v2-ec757d66f04441cfb934c602f997c3f7_r.jpg\"  type=\"image/jpeg\" hash=\"e2a602411c40011748b2e799edf2398f\" width=\"576\" height=\"115\" style=\"display:block;max-width:100%;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;border-color:rgb(31, 9, 9);\" alt=\"v2-ec757d66f04441cfb934c602f997c3f7_r.jpg\" /></en-media></div></div><div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;display:block;margin-bottom:1em;margin-top:1em;\"><div STYLE=\"margin-bottom:0px;display:block;text-align:center;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-top:1em;\"><img src=\"../_resources/v2-2801d5469c581d9c4258f612e0c50c5c_r.jpg\"  type=\"image/jpeg\" hash=\"14dc2449f0de8d5ebec7f51f3e9152a3\" width=\"576\" height=\"257\" style=\"display:block;max-width:100%;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;border-color:rgb(31, 9, 9);\" alt=\"v2-2801d5469c581d9c4258f612e0c50c5c_r.jpg\" /></en-media></div></div><br/><br/><div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;display:block;margin-bottom:1em;margin-top:1em;\"><div STYLE=\"margin-bottom:0px;display:block;text-align:center;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-top:1em;\"><img src=\"../_resources/v2-fbc7fac38259b936907057ae1a5911cc_r.jpg\"  type=\"image/jpeg\" hash=\"4285441e21761a129cc033aaa4a53bf3\" width=\"576\" height=\"217\" style=\"display:block;max-width:100%;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;border-color:rgb(31, 9, 9);\" alt=\"v2-fbc7fac38259b936907057ae1a5911cc_r.jpg\" /></en-media></div></div><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">2.在openstack中需要清除物理口的ip地址，然后将ip地址设置到bridge接口虚拟机才可以正常和外部通信，但是在这里无需如此，只需正确创建接口即可正常通信</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">3.一个bridge下可以有多个物理口和tap口，一个物理接口只能属于一个bridge。</p><div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;display:block;margin-bottom:1em;margin-top:1em;\"><div STYLE=\"margin-bottom:0px;display:block;text-align:center;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-top:1em;\"><img src=\"../_resources/v2-ea0399cb07b9cccf54542f283dd5ac09_r.jpg\"  type=\"image/jpeg\" hash=\"0e56f3ffe0971e9b0ed75ce4c9e41f1a\" width=\"576\" height=\"279\" style=\"display:block;max-width:100%;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;border-color:rgb(31, 9, 9);\" alt=\"v2-ea0399cb07b9cccf54542f283dd5ac09_r.jpg\" /></en-media></div></div><br/><br/><div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;display:block;margin-bottom:1em;margin-top:1em;\"><div STYLE=\"margin-bottom:0px;display:block;text-align:center;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-top:1em;\"><img src=\"../_resources/v2-0a39ea073b89c871d9daf3fa2a407ea2_r.jpg\"  type=\"image/jpeg\" hash=\"c9441821ca448f8d8281c43a28298bd4\" width=\"464\" height=\"112\" style=\"display:block;max-width:100%;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;border-color:rgb(31, 9, 9);\" alt=\"v2-0a39ea073b89c871d9daf3fa2a407ea2_r.jpg\" /></en-media></div></div><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">4.一个bridge下可以有多个tap接口，当在启动虚拟机时命令中指定的tap接口如果已经在用，系统会自动按顺序分配一个没在用的tap接口。</p><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">下面启动的2个虚拟机在启动参数中都指定的是tap0接口，当启动时后启动的虚拟机会自动给分配到tap1接口下</p><div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;display:block;margin-bottom:1em;margin-top:1em;\"><div STYLE=\"margin-bottom:0px;display:block;text-align:center;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-top:1em;\"><img src=\"../_resources/v2-77bc036cd5932753e851fec382aeeee5_r.jpg\"  type=\"image/jpeg\" hash=\"cf9a8fc217edf60d3fa5a07da0186797\" width=\"576\" height=\"76\" style=\"display:block;max-width:100%;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;border-color:rgb(31, 9, 9);\" alt=\"v2-77bc036cd5932753e851fec382aeeee5_r.jpg\" /></en-media></div></div><p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">在tap接口下可以看到使用该接口的虚拟机进程号</p><div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;display:block;margin-bottom:1em;margin-top:1em;\"><div STYLE=\"margin-bottom:0px;display:block;text-align:center;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-top:1em;\"><img src=\"../_resources/v2-1c2175f5339fc9cda5194f561fc3d237_r.jpg\"  type=\"image/jpeg\" hash=\"02f820168d5556ca2d1efa5733f41f26\" width=\"576\" height=\"314\" style=\"display:block;max-width:100%;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;border-color:rgb(31, 9, 9);\" alt=\"v2-1c2175f5339fc9cda5194f561fc3d237_r.jpg\" /></en-media></div></div><ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:disc outside none;list-style-type:disc;\"><li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">微信公众号ID：snmp161</li></ul></div></div></div><div STYLE=\"position:absolute;top:-1000px;left:-1000px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">Measure</div><div STYLE=\"margin-bottom:0px;position:absolute;top:-1000px;left:-1000px;line-height:1;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\">Measure</div></div></div></div></div></div></div></div>\n</div>\n</en-note>      ",
      "content_path": null,
      "diff_base_variant_id": null,
      "metadata": {
        "checksum": "29cdc6db8e466b1f7c79844a7b86e747733e8fe6d1215faa89924a70aaaac226",
        "path": "backups/2023年6月/IT技术/FreeBsd也可以部署KVM.html"
      }
    },
    {
      "id": "6165d14b-f7c0-456b-8b0a-22509b0913ea",
      "note_id": "34541c8a-0daa-4ebe-ab41-bae1fcba5dc3",
      "variant_type": "clean_text",
      "version": 1,
      "created_by": "evernote_ingest:v0",
      "created_at": "2025-11-10T15:43:30.766757Z",
      "content": "---\ntitle: FreeBsd也可以部署KVM\nupdated: 2019-02-18 07:46:29Z\ncreated: 2019-02-18 07:46:29Z\nsource: https://zhuanlan.zhihu.com/p/38089691\n---\n\nFreeBsd也可以部署KVM\nAlex\n公众号：身边的行囊，传播正确的知识。\n一．修改freebsd默认安装源\nFreebsd默认安装源无法安装以下软件，所以需要更换新的安装源\n1.更换软件源\nSetenv PACKAGESITE\nhttp://mirror.its.dal.ca/freebsd/releases/amd64/9.2-RELEASE/packages/Latest/\n freebsd-update fetch install\n portsnap fetch extract\n2.安装 kqemu-kmod和qemu\n pkg_add -r kqemu-kmod\n pkg_add -r qemu\n3.加载kvm核心模块\nkldload kqemu\nkldload aio\n二．创建和安装虚拟机系统\n1.为了便于管理新建虚拟机相关文件夹\nmkdir /vm\nmkdir /vm/iso\nmkdir /vm/FreeBSD\n2.创建image文件（创建虚拟机硬盘）创建了一个50G的硬盘空间，具体空间可以根据实际需要设置\nqemu-img create -f qcow2 /vm/FreeBSD/freebsd.img 50G\n3.创建和安装虚拟机系统\n一定要根据安装的系统选择32位安装命令或64位安装命令，否则执行后在安装系统时会提示cpu不支持（-vnc和冒号之间有空格）\n安装32位系统\nqemu -cdrom /vm/iso/freebsd9.2.iso -hda /vm/freebsd.img -m 1024 -boot d kernel-kqemu -vnc :0 –localtime\n安装64位系统\nqemu-system-x86_64 -cdrom FreeBSD-9.2-RELEASE-amd64-disc1.iso -hda freebsd.img -m 1024 -boot d kernel-kqemu -vnc :0 -localtime\n参数说明：\n-cdrom：指定从光盘启动，也可以用该参数指定iso文件\n-had：指定硬盘文件\n-m：指定内存单位M\n-boot：指定启动方式，d是从光盘启动\n-vnc：指定vnc端口:0表示5900端口\n-localtime：制动虚拟机使用宿主机时间\n4.系统安装完成后直接ctrl+c结束掉进程，然后执行下面的命令启动虚拟机\n（按下面的命令启动虚拟后虚拟机是无法和外面进行通信的，因为没有给虚拟机指定和宿主机通信网卡）\nqemu-system-x86_64  -hda /vm/FreeBSD_9.2x64/freebsd.img -m 1024 kernel-kqemu -vnc :0 -localtime\n三．创建bridge和tap接口\n虚拟机和宿主机之间通信使用的是Linux bridge\n1.开启tap支持\necho net.link.tap.user_open=1 >> /etc/sysctl.conf\necho net.link.tap.up_on_open=1 >> /etc/sysctl.conf\n2.开机开启kqemu\n在/etc/rc.conf下添加\nifconfig_em1=\" inet 192.168.1.29 netmask 255.255.255.0\"\nkqemu_enable=\"YES\"\n3.创建bridge和tap接口\nchmod 0660 /dev/tap0----不执行这条命令创建tap0时会报错\nifconfig bridge0 create\nifconfig tap0 create\nifconfig bridge0 addm em1 addm tap0 up ---将em1和tap0加入到bridge0\n（ifconfig bridge0 destroy 删除接口命令）\n四．常见问题\n1.bridge和tap的在创建后会自动生产mac地址，虚拟机也会自动生成mac地址，也就是说bridge、tap和虚拟机中的网口都会重新自动生成mac地址不会引用真实网卡的mac地址\n2.在openstack中需要清除物理口的ip地址，然后将ip地址设置到bridge接口虚拟机才可以正常和外部通信，但是在这里无需如此，只需正确创建接口即可正常通信\n3.一个bridge下可以有多个物理口和tap口，一个物理接口只能属于一个bridge。\n4.一个bridge下可以有多个tap接口，当在启动虚拟机时命令中指定的tap接口如果已经在用，系统会自动按顺序分配一个没在用的tap接口。\n下面启动的2个虚拟机在启动参数中都指定的是tap0接口，当启动时后启动的虚拟机会自动给分配到tap1接口下\n在tap接口下可以看到使用该接口的虚拟机进程号\n微信公众号ID：snmp161\nMeasure",
      "content_path": null,
      "diff_base_variant_id": null,
      "metadata": {
        "language": "no",
        "length": 2152,
        "rule_count": 2,
        "applied_rules": [
          {
            "rule_id": "dedupe_lines",
            "description": "Collapse adjacent duplicate lines",
            "note": "collapsed duplicate adjacent lines"
          },
          {
            "rule_id": "whitespace",
            "description": "Normalize whitespace",
            "note": "collapsed whitespace"
          }
        ]
      }
    }
  ],
  "extractions": [],
  "journal": {
    "id": "7e462230-21ec-40fb-8727-fb1f1a338304",
    "note_id": "34541c8a-0daa-4ebe-ab41-bae1fcba5dc3",
    "stage": "ingest",
    "agent_id": "evernote_ingest:v0",
    "started_at": "2025-11-10T15:43:30.766761Z",
    "finished_at": "2025-11-10T15:43:30.766762Z",
    "status": "success",
    "input_ref": {
      "task_id": "4dff3b29-db4f-4d7c-8911-8333e3b8145c",
      "source_path": "backups/2023年6月/IT技术/FreeBsd也可以部署KVM.html",
      "checksum": "29cdc6db8e466b1f7c79844a7b86e747733e8fe6d1215faa89924a70aaaac226"
    },
    "output_ref": {
      "ingest_source": "84e5b077-f1b7-440b-9a2f-b10b888a8e31",
      "note": "34541c8a-0daa-4ebe-ab41-bae1fcba5dc3",
      "variants": [
        "e2d7a5aa-9af1-4009-a84b-a3979dca5216",
        "6165d14b-f7c0-456b-8b0a-22509b0913ea"
      ]
    },
    "error_detail": null
  }
}