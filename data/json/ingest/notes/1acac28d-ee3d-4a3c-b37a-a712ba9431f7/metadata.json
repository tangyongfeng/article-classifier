{
  "ingest_source": {
    "id": "f6a60ee7-9153-49a4-8d2e-cc7b8338c224",
    "source_type": "evernote_html",
    "source_path": "backups/2023年6月/IT技术/sudoers改坏后无法使用sudo的解决办法.html",
    "collected_at": "2025-11-10T15:43:31.945792Z",
    "external_id": null,
    "title_hint": null,
    "language_hint": "en",
    "captured_at": null,
    "checksum": "a713ca0b8d181c0960ce8230a4a35c65382fe1055928f4ee98ace3f2d6a8192b",
    "status": "pending",
    "notes": {
      "batch_id": "phase2-backfill-202306"
    }
  },
  "note": {
    "id": "1acac28d-ee3d-4a3c-b37a-a712ba9431f7",
    "ingest_source_id": "f6a60ee7-9153-49a4-8d2e-cc7b8338c224",
    "canonical_title": "sudoers改坏后无法使用sudo的解决办法",
    "language": "en",
    "ingested_at": "2025-11-10T15:43:31.945795Z",
    "created_at": null,
    "status": "active",
    "importance": 0,
    "attributes": {
      "source_filename": "sudoers改坏后无法使用sudo的解决办法.html"
    }
  },
  "variants": [
    {
      "id": "ed559dd3-40ac-4163-9623-d03b17dd7725",
      "note_id": "1acac28d-ee3d-4a3c-b37a-a712ba9431f7",
      "variant_type": "raw_html",
      "version": 1,
      "created_by": "evernote_ingest:v0",
      "created_at": "2025-11-10T15:43:31.945798Z",
      "content": "---\ntitle: sudoers改坏后无法使用sudo的解决办法\nupdated: 2021-01-10 21:20:00Z\ncreated: 2021-01-10 21:18:44Z\nauthor: tangyongfeng@gmail.com\n---\n\n\n<en-note><div><span STYLE=\"-en-paragraph:true;\">练习安装odoo的时候，创建了一个odoo用户，想把它赋予sudo权限，然而，编辑的时候不留意，改坏了，导致sudo无法使用，无法编辑sudoers文件修改回来。\n</span></div><div><span STYLE=\"-en-paragraph:true;\">提示如下信息：</span></div><div><span STYLE=\"-en-paragraph:true;\">&gt;&gt;&gt; /etc/sudoers: syntax error near line 22 &lt;&lt;&lt;</span><span STYLE=\"-en-paragraph:true;\">sudo: parse error in /etc/sudoers near line 22sudo: no valid sudoers sources found, quitting</span><span STYLE=\"-en-paragraph:true;\">sudo: unable to initialize policy plugin</span></div><div><span STYLE=\"-en-paragraph:true;\">任何涉及权限的操作的无法进行，编辑查看都不行。我不想重装系统了.</span></div><div><span STYLE=\"-en-paragraph:true;\">各种搜索，找到说可以使用下面的命令来编辑sudoers文件</span></div><div>pkexec visudo</div><div><span STYLE=\"-en-paragraph:true;\">然而，又出现了新的错误\n</span></div><div>==== AUTHENTICATING FOR org.freedesktop.policykit.exec ===Authentication is needed to run `/usr/sbin/visudo&apos; as the super userAuthenticating as: ubuntu,,, (ubuntu)Password:polkit-agent-helper-1: error response to PolicyKit daemon: GDBus.Error:org.freedesktop.PolicyKit1.Error.Failed: No session for cookie==== AUTHENTICATION FAILED ===Error executing command as another user: Not authorizedThis incident has been reported.</div><div><span STYLE=\"-en-paragraph:true;\">然后终于找到一个神奇的方法：远程的话开两个ssh终端，能直接操作物理机的话使用ctrl+alt+F2 创建第二个终端窗口【</span><span STYLE=\"-en-paragraph:true;\">使用ctrl+alt+F1=》tty1;ctrl+alt+F2=》tty2对窗口进行切换】，两个终端，都用ubuntu用户登录。</span><span STYLE=\"-en-paragraph:true;\">\n</span></div><div><br/></div><div><span STYLE=\"-en-paragraph:true;\">对tty1终端：输入 echo $$//获取pid\n</span></div><div><br/></div><div><span STYLE=\"-en-paragraph:true;\">切换到tty2：输入</span></div><div><span STYLE=\"-en-paragraph:true;\">pkttyagent --process 获取的pid值 ；此时该tty2终端会卡住</span></div><div><span STYLE=\"-en-paragraph:true;\"> </span></div><div><span STYLE=\"-en-paragraph:true;\"> \n</span></div><div><span STYLE=\"-en-paragraph:true;\">切到tty1：输入 pkexec visudo ；此时tty1也会卡住\n</span></div><div><br/></div><div><span STYLE=\"-en-paragraph:true;\">切到tty2：会看到要求输入密码，对应输入\n</span></div><div><br/></div><div><span STYLE=\"-en-paragraph:true;\">切回到tty1：发现已经进入了visudo编辑界面，修改出错的sudoers，保存\n</span></div><div><br/></div><div><span STYLE=\"-en-paragraph:true;\">修改完成，按 CTRL + X 保存退出 发现就可以继续使用sudo命令了。</span></div><div><span STYLE=\"-en-paragraph:true;\"> \n</span></div><div><span STYLE=\"-en-paragraph:true;\">PS:</span></div><div><span STYLE=\"-en-paragraph:true;\">一般对/etc/sudoers文件进行操作,建议使用visudo命令. 注意:</span><span STYLE=\"-en-paragraph:true;\">不要直接使用 vi,直接使用vi不会对文件新加的做相关验证,这可能导致该文件无法正确解析.最终导致sudo命令不能使用,也不能切换使用root用户等一系列问题..</span></div></en-note>      ",
      "content_path": null,
      "diff_base_variant_id": null,
      "metadata": {
        "checksum": "a713ca0b8d181c0960ce8230a4a35c65382fe1055928f4ee98ace3f2d6a8192b",
        "path": "backups/2023年6月/IT技术/sudoers改坏后无法使用sudo的解决办法.html"
      }
    },
    {
      "id": "17d94174-faed-47a2-aeff-d26b697db89d",
      "note_id": "1acac28d-ee3d-4a3c-b37a-a712ba9431f7",
      "variant_type": "clean_text",
      "version": 1,
      "created_by": "evernote_ingest:v0",
      "created_at": "2025-11-10T15:43:31.945801Z",
      "content": "---\ntitle: sudoers改坏后无法使用sudo的解决办法\nupdated: 2021-01-10 21:20:00Z\ncreated: 2021-01-10 21:18:44Z\nauthor: tangyongfeng@gmail.com\n---\n\n练习安装odoo的时候，创建了一个odoo用户，想把它赋予sudo权限，然而，编辑的时候不留意，改坏了，导致sudo无法使用，无法编辑sudoers文件修改回来。\n\n提示如下信息：\n>>> /etc/sudoers: syntax error near line 22 <<<\nsudo: parse error in /etc/sudoers near line 22sudo: no valid sudoers sources found, quitting\nsudo: unable to initialize policy plugin\n任何涉及权限的操作的无法进行，编辑查看都不行。我不想重装系统了.\n各种搜索，找到说可以使用下面的命令来编辑sudoers文件\npkexec visudo\n然而，又出现了新的错误\n\n==== AUTHENTICATING FOR org.freedesktop.policykit.exec ===Authentication is needed to run `/usr/sbin/visudo' as the super userAuthenticating as: ubuntu,,, (ubuntu)Password:polkit-agent-helper-1: error response to PolicyKit daemon: GDBus.Error:org.freedesktop.PolicyKit1.Error.Failed: No session for cookie==== AUTHENTICATION FAILED ===Error executing command as another user: Not authorizedThis incident has been reported.\n然后终于找到一个神奇的方法：远程的话开两个ssh终端，能直接操作物理机的话使用ctrl+alt+F2 创建第二个终端窗口【\n使用ctrl+alt+F1=》tty1;ctrl+alt+F2=》tty2对窗口进行切换】，两个终端，都用ubuntu用户登录。\n\n对tty1终端：输入 echo $$//获取pid\n\n切换到tty2：输入\npkttyagent --process 获取的pid值 ；此时该tty2终端会卡住\n\n切到tty1：输入 pkexec visudo ；此时tty1也会卡住\n\n切到tty2：会看到要求输入密码，对应输入\n\n切回到tty1：发现已经进入了visudo编辑界面，修改出错的sudoers，保存\n\n修改完成，按 CTRL + X 保存退出 发现就可以继续使用sudo命令了。\n\nPS:\n一般对/etc/sudoers文件进行操作,建议使用visudo命令. 注意:\n不要直接使用 vi,直接使用vi不会对文件新加的做相关验证,这可能导致该文件无法正确解析.最终导致sudo命令不能使用,也不能切换使用root用户等一系列问题..",
      "content_path": null,
      "diff_base_variant_id": null,
      "metadata": {
        "language": "en",
        "length": 1395,
        "rule_count": 2,
        "applied_rules": [
          {
            "rule_id": "dedupe_lines",
            "description": "Collapse adjacent duplicate lines",
            "note": "collapsed duplicate adjacent lines"
          },
          {
            "rule_id": "whitespace",
            "description": "Normalize whitespace",
            "note": "collapsed whitespace"
          }
        ]
      }
    }
  ],
  "extractions": [
    {
      "id": "832cd3fd-849a-43f4-9237-82878d015dc7",
      "note_id": "1acac28d-ee3d-4a3c-b37a-a712ba9431f7",
      "extractor": "llm_enhance:v0#qwen3:30b",
      "payload": {
        "summary": "误改sudoers文件导致sudo失效，通过多终端切换（tty1/tty2）使用pkexec visudo修复，强调应使用visudo而非vi编辑系统配置文件。",
        "keywords": [
          "sudoers",
          "权限修复",
          "终端切换",
          "visudo",
          "系统管理"
        ],
        "action_items": [
          "无"
        ],
        "source": "qwen3:30b",
        "category_path": [
          "Unclassified"
        ],
        "new_category_suggestion": null
      },
      "version": 1,
      "created_at": "2025-11-11T15:59:11.859001Z",
      "created_by": "llm_enhance:v0",
      "quality_score": 0.215
    }
  ],
  "journal": {
    "id": "37888983-02ca-4033-8800-17a656e26ebb",
    "note_id": "1acac28d-ee3d-4a3c-b37a-a712ba9431f7",
    "stage": "ingest",
    "agent_id": "evernote_ingest:v0",
    "started_at": "2025-11-10T15:43:31.945805Z",
    "finished_at": "2025-11-10T15:43:31.945806Z",
    "status": "success",
    "input_ref": {
      "task_id": "87ad70ef-0401-4523-8d7b-439421f65847",
      "source_path": "backups/2023年6月/IT技术/sudoers改坏后无法使用sudo的解决办法.html",
      "checksum": "a713ca0b8d181c0960ce8230a4a35c65382fe1055928f4ee98ace3f2d6a8192b"
    },
    "output_ref": {
      "ingest_source": "f6a60ee7-9153-49a4-8d2e-cc7b8338c224",
      "note": "1acac28d-ee3d-4a3c-b37a-a712ba9431f7",
      "variants": [
        "ed559dd3-40ac-4163-9623-d03b17dd7725",
        "17d94174-faed-47a2-aeff-d26b697db89d"
      ]
    },
    "error_detail": null
  },
  "llm": {
    "status": "success",
    "model": "qwen3:30b",
    "updated_at": "2025-11-11T15:59:11.858837Z",
    "latency_seconds": 15.163236082997173,
    "attempts": 2,
    "summary": {
      "summary": "误改sudoers文件导致sudo失效，通过多终端切换（tty1/tty2）使用pkexec visudo修复，强调应使用visudo而非vi编辑系统配置文件。",
      "keywords": [
        "sudoers",
        "权限修复",
        "终端切换",
        "visudo",
        "系统管理"
      ],
      "action_items": [
        "无"
      ],
      "source": "qwen3:30b",
      "category_path": [
        "Unclassified"
      ],
      "new_category_suggestion": null
    },
    "quality": {
      "score": 0.215,
      "metrics": {
        "input_chars": 1395.0,
        "input_lines": 28.0,
        "summary_chars": 80.0,
        "summary_coverage_ratio": 0.057,
        "keyword_hit_rate": 0.4,
        "action_item_count": 1.0,
        "unique_summary_sentences": 1.0,
        "estimated_read_seconds": 83.7
      }
    }
  }
}