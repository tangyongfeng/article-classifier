---
title: Linux系统无线网络抓包程序(分析手机WIFI MAC地址)-echojb.com
updated: 2018-11-09 08:42:57Z
created: 2018-11-09 08:42:57Z
source: http://www.echojb.com/wireless/2017/01/17/304182.html
---


<en-note>
  <div>
<div STYLE="font-size: 16px; display: inline-block;  min-width: 100%;position: relative;"><div STYLE="font-family:inherit;font-size:62.5%;font-style:inherit;outline:0px;vertical-align:baseline;box-sizing:border-box;text-size-adjust:100%;"><div STYLE="font-family:inherit;font-size:100%;font-style:inherit;outline:0px;vertical-align:baseline;box-sizing:inherit;font:14px/180% &quot;Microsoft YaHei&quot;, Helvetica, Arial, &quot;Lucida Grande&quot;, Tahoma, sans-serif;color:rgb(68, 68, 68);background:rgb(241, 241, 241);"><div STYLE="font-family:inherit;font-size:100%;font-style:inherit;outline:0px;vertical-align:baseline;box-sizing:inherit;"><div STYLE="font-family:inherit;font-size:100%;font-style:inherit;outline:0px;vertical-align:baseline;box-sizing:inherit;"><div STYLE="font-family:inherit;font-size:100%;font-style:inherit;outline:0px;vertical-align:baseline;box-sizing:inherit;transition-duration:0.5s;"><span STYLE="box-sizing:inherit;"><div STYLE="font-family:inherit;font-size:100%;font-style:inherit;outline:0px;vertical-align:baseline;box-sizing:inherit;animation-duration:1s;animation-fill-mode:both;animation-delay:0.3s;"><div STYLE="font-family:inherit;font-size:100%;font-style:inherit;outline:0px;vertical-align:baseline;box-sizing:inherit;background:rgb(255, 255, 255);box-shadow:rgba(0, 0, 0, 0.04) 0px 1px 1px;border-radius:2px;">
&Tab;&Tab;<div STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;display:block;">
&Tab;&Tab;<h1 STYLE="border:0px;font-family:inherit;font-size:18px;font-style:inherit;margin:35px -20px 20px;outline:0px;padding:5px 20px;vertical-align:baseline;box-sizing:inherit;position:relative;line-height:30px;text-align:center;border-left:5px solid rgb(47, 136, 154);border-right:5px solid rgb(47, 136, 154);">Linux系统无线网络抓包程序(分析手机WIFI MAC地址)</h1>
&Tab;&Tab;</div>
&Tab;<div STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;">
&Tab;&Tab;<div STYLE="border:0px;font-family:inherit;font-size:15px;font-style:inherit;margin:0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;line-height:1.8;overflow-wrap:break-word;">
&Tab;&Tab;&Tab;<div STYLE="border:none;font-family:inherit;font-size:100%;font-style:inherit;margin:0px -11px 10px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;background:transparent;padding-top:6px;box-shadow:none;border-radius:0px;overflow:hidden;text-align:center;">

<ins STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;display:block;"></ins>
</div>
&Tab;&Tab;&Tab;&Tab;<p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;">首先要介绍ieee802.11的帧格式，只有知道帧格式才能正确解析对应字段，拿到我们感兴趣的信息。其次介绍Linux raw socket编程抓包。最后解析ieee802.11数据包，从而获取到MAC地址。实际上，从数据包中可以得到很多信息，这些信息就是后续需要继续进行的事了。</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;">一、ieee802.11帧格式</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;">ieee802.11帧格式如下图所示：</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;"><img src="../_resources/91b852bbbc0355f5771cd40a2e5447db.png"  type="image/png" hash="91b852bbbc0355f5771cd40a2e5447db" width="718" height="156" style="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px;vertical-align:middle;box-sizing:inherit;max-width:100%;height:auto;display:block;" alt="" /></en-media><br STYLE="box-sizing:inherit;"/>
</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;">二、C实现socket抓包</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;">&nbsp;Linux系统抓包使用SOCK_RAW方式，类型为ETH_P_ALL(表示抓取所有类型的帧，不管是IP帧还是ARP帧)。下面给出代码重要函数代码片段。为减小文章篇幅，保留主要代码函数，至于完整代码，请参阅文章后面的附录。</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;">1、设置混杂模式</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;">抓包工具都会开启混杂模式(promisc)，下面是代码：</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;"></p><pre STYLE="border:0px;font-family:inherit;font-size:10.5pt;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;background:rgb(240, 240, 240);line-height:20px;width:100%;overflow:auto hidden;">// 混杂模式
bool set_promisc_mode(const char* eth, bool promisc)
{
    int org_errno = 0;
    int fd;
    struct ifreq ifreq;

    if ((fd = socket(AF_INET, SOCK_DGRAM, 0)) == -1)
        return false;

    memset(&amp;ifreq, 0, sizeof(ifreq));
    strncpy(ifreq.ifr_name, eth, IF_NAMESIZE - 1);

    ioctl(fd, SIOCGIFFLAGS, &amp;ifreq);

    // check if eth is up
    if (!(ifreq.ifr_flags &amp; IFF_UP))
    {
        printf(&quot;%s is not up yet.n&quot;, eth);
        return false;
    }

    if (promisc)
        ifreq.ifr_flags |= IFF_PROMISC;
    else
        ifreq.ifr_flags &amp;= ~IFF_PROMISC;

    ioctl(fd, SIOCSIFFLAGS, &amp;ifreq);

    if (close(fd))
        return false;

    return true;
}</pre><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;"></p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;">2、初始化socket</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;">初始化socket包括创建RAW socket，绑定指定网卡。</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;"></p><pre STYLE="border:0px;font-family:inherit;font-size:10.5pt;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;background:rgb(240, 240, 240);line-height:20px;width:100%;overflow:auto hidden;">int init_socket(const char* eth)
{
    int ret = 0;
    int fd = -1;

    // 混杂模式
    if (!set_promisc_mode(eth, true))
    {
        //printf(&quot;set %s to promisc mode failed.n&quot;, eth);
        return -1;
    }

    // 注意与下面绑定时协议一致
    fd = socket(PF_PACKET, SOCK_RAW, htons(ETH_P_ALL));

    // 绑定网卡
    struct ifreq req;
    strcpy(req.ifr_name, eth);
    ioctl(fd, SIOCGIFINDEX, &amp;req);

    struct sockaddr_ll addr;
    addr.sll_family = PF_PACKET;
    addr.sll_ifindex = req.ifr_ifindex;
    addr.sll_protocol = htons(ETH_P_ALL);
    ret = bind(fd, (struct sockaddr *)&amp;addr, sizeof(struct sockaddr_ll));
    
    return fd;
}</pre><br STYLE="box-sizing:inherit;"/>
3、获取网卡信息
<p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;"></p><pre STYLE="border:0px;font-family:inherit;font-size:10.5pt;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;background:rgb(240, 240, 240);line-height:20px;width:100%;overflow:auto hidden;">int get_hwinfo(int fd, char* eth, unsigned char* mac)
{
    struct ifreq ifr;

    memset(&amp;ifr, 0, sizeof(ifr));
    strncpy(ifr.ifr_name, eth, IFNAMSIZ - 1);
    ifr.ifr_name[IFNAMSIZ - 1] = &apos;&apos;;

    if (ioctl(fd, SIOCGIFHWADDR, &amp;ifr) &lt; 0)
    {
        printf(&quot;Could not get arptypen&quot;);
        return -1;
    }
    printf(&quot;ARPTYPE %dn&quot;, ifr.ifr_hwaddr.sa_family);
    memcpy(mac, ifr.ifr_hwaddr.sa_data, 6);
    return ifr.ifr_hwaddr.sa_family;
}</pre><br STYLE="box-sizing:inherit;"/>
注意，函数返回的sa_family十分重要，它是判断抓取的帧类型的依据。跟踪SIOCGIFHWADDR调用过程，发现内核驱动将dev-&gt;dev_addr赋值给ifr-&gt;ifr_hwaddr.sa_data，而dev-&gt;type赋值给ifr-&gt;ifr_hwaddr.sa_family。<br STYLE="box-sizing:inherit;"/><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;"></p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;">4、接收数据</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;">一般网络接收数据都会使用select模型，使用recv即可收到内核传递的数据。</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;"></p><pre STYLE="border:0px;font-family:inherit;font-size:10.5pt;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;background:rgb(240, 240, 240);line-height:20px;width:100%;overflow:auto hidden;">int receive_packet(int socket)
{
    int ret = 0;

    struct timeval tv;

    static fd_set read_fds;

    tv.tv_sec = 0;
    tv.tv_usec = 100;

    FD_ZERO(&amp;read_fds);
    FD_SET(socket, &amp;read_fds);

    ret = select(socket+1, &amp;read_fds, NULL, NULL, &amp;tv);

    if (ret == -1 &amp;&amp; errno == EINTR) /* interrupted */
        return -1;
    if (ret == 0)
        return -1;
    else if (ret &lt; 0)
        return -1;

    if (FD_ISSET(socket, &amp;read_fds))
    {
        memset(buffer, &apos;&apos;, BUFFER_SIZE);
        ret = recv(socket, buffer, BUFFER_SIZE, MSG_DONTWAIT);
        if (ret &lt;= 0)
            return -1;
        //printf(&quot;--recv len: %dn&quot;, ret);
        if (debug_level)
        {
            dump(buffer, ret);
            printf(&quot;====================n&quot;);
        }
        if (arphrd == 1)
            parse_packet(buffer, ret); // ieee802.3包
        else if (arphrd == 802 || arphrd == 803) // ieee802.11包
            parse_packet_wlan(buffer, ret);
    }

    return 0;
}</pre><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;"></p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;">三、解析</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;"></p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;">下图是笔者手机发的probe request帧截图(使用tcpdump抓包，再用wireshark查看)。</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;"><img src="../_resources/783ba06ada8f889b7d4cd5742d302666.png"  type="image/png" hash="783ba06ada8f889b7d4cd5742d302666" width="569" height="214" style="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px;vertical-align:middle;box-sizing:inherit;max-width:100%;height:auto;display:block;" alt="" /></en-media><br STYLE="box-sizing:inherit;"/>
</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;">1、radiotap头部</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;">radiotap包含大量有用信息，比如SSI信号强度。但我们暂时不需要，直接跳过。它的结构体定义如下：</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;"></p><pre STYLE="border:0px;font-family:inherit;font-size:10.5pt;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;background:rgb(240, 240, 240);line-height:20px;width:100%;overflow:auto hidden;">// radiotap头部
// radiotap官网：http://www.radiotap.org/
struct ieee80211_radiotap_header {
        uint8_t        it_version;     /* set to 0 */
        uint8_t        it_pad;
        uint16_t       it_len;         /* entire length */
        uint32_t       it_present;     /* fields present */
} __attribute__((__packed__));
</pre>其中的it_len成员表示整个radiotap头部的大小。因此在代码中直接使用it_len作偏移量计算出ieee802.11头部地址。
<p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;"></p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;">2、ieee802.11头部</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;">ieee802.11头部结构体如下：</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;"></p><pre STYLE="border:0px;font-family:inherit;font-size:10.5pt;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;background:rgb(240, 240, 240);line-height:20px;width:100%;overflow:auto hidden;">// 802.11帧头
struct wlan_frame {
&Tab;uint16_t&Tab;fc;
&Tab;uint16_t&Tab;duration;
&Tab;uint8_t&Tab;&Tab;addr1[6];
&Tab;uint8_t&Tab;&Tab;addr2[6];
&Tab;uint8_t&Tab;&Tab;addr3[6];
&Tab;uint16_t&Tab;seq;
&Tab;union {
&Tab;&Tab;uint16_t&Tab;&Tab;qos;
&Tab;&Tab;uint8_t&Tab;&Tab;&Tab;addr4[6];
&Tab;&Tab;struct {
&Tab;&Tab;&Tab;uint16_t&Tab;qos;
&Tab;&Tab;&Tab;uint32_t&Tab;ht;
&Tab;&Tab;} __attribute__ ((packed)) ht;
&Tab;&Tab;struct {
&Tab;&Tab;&Tab;uint8_t&Tab;&Tab;addr4[6];
&Tab;&Tab;&Tab;uint16_t&Tab;qos;
&Tab;&Tab;&Tab;uint32_t&Tab;ht;
&Tab;&Tab;} __attribute__ ((packed)) addr4_qos_ht;
&Tab;} u;
} __attribute__ ((packed));</pre>从前面的图示知道，addr1为接收方(Receiver)MAC地址，addr2为发送者(Transmitter)MAC地址，addr3为BSSID。不同类型的帧，Receiver和Transmitter不同，对于probe request类型帧来说，Transmitter地址即为所需要的MAC号&mdash;&mdash;因为probe都是广播，目标地址都是ff。<br STYLE="box-sizing:inherit;"/>
下面是解析ieee802.11的函数代码：
<p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;"></p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;"></p><pre STYLE="border:0px;font-family:inherit;font-size:10.5pt;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;background:rgb(240, 240, 240);line-height:20px;width:100%;overflow:auto hidden;">int parse_packet_wlan(const char* buffer, int len)
{
    int hdrlen = 0;
    uint16_t fc = 0;
&Tab;uint8_t* ra = NULL;
&Tab;uint8_t* ta = NULL;
&Tab;uint8_t* bssid = NULL;
    
    struct ieee80211_radiotap_header* radiotap_header = NULL;
    struct wlan_frame* wh = NULL;
    
    if (buffer == NULL)
    {
        return -1;
    }

    radiotap_header = (struct ieee80211_radiotap_header*)buffer;
    // it_len表示整个radiotap信息，包括头部，因此直接跳过到ieee80211头部
    int radiotap_len = radiotap_header-&gt;it_len;
    wh = (struct wlan_frame*)(buffer+radiotap_len);
    
    fc = le16toh(wh-&gt;fc); // 传输格式为little endian，要转换成host格式
    int wlan_type = (fc &amp; 0xfc);
    int type = (fc &amp; 0xc)&gt;&gt;2;
    int stype = (fc &amp; 0xf0)&gt;&gt;4;
&Tab;//printf(&quot;fc:0x%x wlan_type 0x%x - type 0x%x - stype 0x%x n&quot;, fc, wlan_type, type, stype);
    
    // 数据帧
    if (type == 0x02)
    {
        
    }
    // 控制帧
    else if (type == 0x01)
    {
        
    }
    // 管理帧
    else if (type == 0x0)
    {
        if (stype == 0x04) // probe帧
        {
            ra = wh-&gt;addr1;
            ta = wh-&gt;addr2;
            bssid = wh-&gt;addr3;
            if (ta)
                printf(&quot;SRC MAC: [&quot; MACFMT &quot;] --&gt; &quot;, MAC2ADDR(ta));
            if (ra)
                printf(&quot;DST MAC: [&quot; MACFMT &quot;]&quot;, MAC2ADDR(ra));
            if (bssid)
                printf(&quot; BSSID MAC: [&quot; MACFMT &quot;]&quot;, MAC2ADDR(bssid));
            printf(&quot;n&quot;);    
        }
    }
    else
    {
        printf(&quot;unknown frame.n&quot;);
        return -1;
    }

    return 0;
}</pre>看上去十分简单，因为我们只需要其中一种帧的MAC地址信息，其它一概忽视。&nbsp;
<p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;"></p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;">下图是扫描probe得到的MAC地址，并且根据OUI查出MAC所属组织名称(代码需修改)：</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;">&nbsp;<img src="../_resources/c297621b7cee2964a351bffdeb2767b3.png"  type="image/png" hash="c297621b7cee2964a351bffdeb2767b3" width="628" height="395" style="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px;vertical-align:middle;box-sizing:inherit;max-width:100%;height:auto;display:block;" alt="" /></en-media></p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;">修改后的版本演示结果如下(代码需修改)：</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;"><img src="../_resources/89ef29188c6b39dd551031f2cf340161.png"  type="image/png" hash="89ef29188c6b39dd551031f2cf340161" width="718" height="119" style="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px;vertical-align:middle;box-sizing:inherit;max-width:100%;height:auto;display:block;" alt="" /></en-media><br STYLE="box-sizing:inherit;"/>
</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;"><br STYLE="box-sizing:inherit;"/>
</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;">&nbsp;</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;">附代码：</p><p STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px 0px 5px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;overflow-wrap:break-word;word-break:break-all;text-indent:2em;"><br STYLE="box-sizing:inherit;"/>
</p>&Tab;&Tab;</div>
<div STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;clear:both;"></div>

<div STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:15px auto 80px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;position:relative;">
&Tab;<div STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px auto;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;position:relative;width:243px;">
&Tab;&Tab;&Tab;<div STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;clear:both;"></div>
&Tab;</div>
</div>&Tab;&Tab;

&Tab;&Tab;&Tab;<div STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;display:block;">
&Tab;&Tab;&Tab;&Tab;<ul STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;list-style:none;position:absolute;top:15px;right:15px;">
&Tab;&Tab;&Tab;&Tab;<li STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;float:left;"><a HREF="#" TITLE="Sidebar " STYLE="border:1px solid rgb(221, 221, 221);font-family:inherit;font-size:100%;font-style:inherit;margin:0px 5px 0px 0px;outline:0px;padding:0px 8px;vertical-align:baseline;box-sizing:inherit;color:rgb(153, 153, 153);text-decoration:none;-webkit-tap-highlight-color:rgba(255, 0, 0, 0);line-height:26px;display:block;border-radius:2px;"><i STYLE="border:0px;font-family:FontAwesome;font-size:inherit;font-style:normal;margin:0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;display:inline-block;font-variant:normal;font-weight:normal;font-stretch:normal;line-height:1;text-rendering:auto;-webkit-font-smoothing:antialiased;"><span STYLE="font-family:FontAwesome;font-size:inherit;font-style:normal;font-variant:normal;font-weight:normal;line-height:1;"></span></i> <i STYLE="border:0px;font-family:FontAwesome;font-size:inherit;font-style:normal;margin:0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;display:inline-block;font-variant:normal;font-weight:normal;font-stretch:normal;line-height:1;text-rendering:auto;-webkit-font-smoothing:antialiased;"><span STYLE="font-family:FontAwesome;font-size:inherit;font-style:normal;font-variant:normal;font-weight:normal;line-height:1;"></span></i></a></li>
&Tab;&Tab;&Tab;&Tab;</ul>
&Tab;
<ul STYLE="border:1px solid rgb(221, 221, 221);font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px 0px 1px;vertical-align:baseline;box-sizing:inherit;list-style:none;position:absolute;top:15px;left:20px;line-height:24px;width:40px;text-align:center;cursor:pointer;border-radius:2px;">A+</ul>
<div STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;clear:both;"></div>
&Tab;&Tab;&Tab;&Tab;<div STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:10px 0px;vertical-align:baseline;box-sizing:inherit;position:absolute;background:rgb(248, 248, 248);bottom:-1px;left:0px;width:100%;border-bottom:1px solid rgb(221, 221, 221);border-radius:0px 0px 2px 2px;">
                                        <div STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px 20px;vertical-align:baseline;box-sizing:inherit;"><div STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;zoom:1;"><a HREF="http://www.echojb.com/wireless/2017/01/17/304182.html#" STYLE="border:0px;font-family:inherit;font-size:12px;font-style:inherit;margin:6px 6px 6px 0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;color:rgb(51, 51, 51);text-decoration:none;-webkit-tap-highlight-color:rgba(255, 0, 0, 0);background-position:0px 0px;float:left;padding-left:17px;line-height:16px;height:16px;background-image:url(http://bdimg.share.baidu.com/static/api/css/../img/share/icons_0_16.png?v=91362611.png);background-repeat:no-repeat;cursor:pointer;">分享到：</a><a TITLE="分享到百度云收藏" HREF="http://www.echojb.com/wireless/2017/01/17/304182.html#" STYLE="border:0px;font-family:inherit;font-size:12px;font-style:inherit;margin:6px 6px 6px 0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;color:rgb(68, 68, 68);text-decoration:none;-webkit-tap-highlight-color:rgba(255, 0, 0, 0);background-position:0px -3068px;float:left;padding-left:17px;line-height:16px;height:16px;background-image:url(http://bdimg.share.baidu.com/static/api/css/../img/share/icons_0_16.png?v=91362611.png);background-repeat:no-repeat;cursor:pointer;">百度云收藏</a><a TITLE="分享到QQ空间" HREF="http://www.echojb.com/wireless/2017/01/17/304182.html#" STYLE="border:0px;font-family:inherit;font-size:12px;font-style:inherit;margin:6px 6px 6px 0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;color:rgb(68, 68, 68);text-decoration:none;-webkit-tap-highlight-color:rgba(255, 0, 0, 0);background-position:0px -52px;float:left;padding-left:17px;line-height:16px;height:16px;background-image:url(http://bdimg.share.baidu.com/static/api/css/../img/share/icons_0_16.png?v=91362611.png);background-repeat:no-repeat;cursor:pointer;">QQ空间</a><a TITLE="分享到百度首页" HREF="http://www.echojb.com/wireless/2017/01/17/304182.html#" STYLE="border:0px;font-family:inherit;font-size:12px;font-style:inherit;margin:6px 6px 6px 0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;color:rgb(68, 68, 68);text-decoration:none;-webkit-tap-highlight-color:rgba(255, 0, 0, 0);background-position:0px -156px;float:left;padding-left:17px;line-height:16px;height:16px;background-image:url(http://bdimg.share.baidu.com/static/api/css/../img/share/icons_0_16.png?v=91362611.png);background-repeat:no-repeat;cursor:pointer;">百度</a><a TITLE="分享到百度贴吧" HREF="http://www.echojb.com/wireless/2017/01/17/304182.html#" STYLE="border:0px;font-family:inherit;font-size:12px;font-style:inherit;margin:6px 6px 6px 0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;color:rgb(68, 68, 68);text-decoration:none;-webkit-tap-highlight-color:rgba(255, 0, 0, 0);background-position:0px -728px;float:left;padding-left:17px;line-height:16px;height:16px;background-image:url(http://bdimg.share.baidu.com/static/api/css/../img/share/icons_0_16.png?v=91362611.png);background-repeat:no-repeat;cursor:pointer;">贴吧</a><a TITLE="分享到新浪微博" HREF="http://www.echojb.com/wireless/2017/01/17/304182.html#" STYLE="border:0px;font-family:inherit;font-size:12px;font-style:inherit;margin:6px 6px 6px 0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;color:rgb(68, 68, 68);text-decoration:none;-webkit-tap-highlight-color:rgba(255, 0, 0, 0);background-position:0px -104px;float:left;padding-left:17px;line-height:16px;height:16px;background-image:url(http://bdimg.share.baidu.com/static/api/css/../img/share/icons_0_16.png?v=91362611.png);background-repeat:no-repeat;cursor:pointer;">新浪</a><a TITLE="分享到微信" HREF="http://www.echojb.com/wireless/2017/01/17/304182.html#" STYLE="border:0px;font-family:inherit;font-size:12px;font-style:inherit;margin:6px 6px 6px 0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;color:rgb(68, 68, 68);text-decoration:none;-webkit-tap-highlight-color:rgba(255, 0, 0, 0);background-position:0px -1612px;float:left;padding-left:17px;line-height:16px;height:16px;background-image:url(http://bdimg.share.baidu.com/static/api/css/../img/share/icons_0_16.png?v=91362611.png);background-repeat:no-repeat;cursor:pointer;">微信</a><a TITLE="分享到天涯社区" HREF="http://www.echojb.com/wireless/2017/01/17/304182.html#" STYLE="border:0px;font-family:inherit;font-size:12px;font-style:inherit;margin:6px 6px 6px 0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;color:rgb(68, 68, 68);text-decoration:none;-webkit-tap-highlight-color:rgba(255, 0, 0, 0);background-position:0px -1196px;float:left;padding-left:17px;line-height:16px;height:16px;background-image:url(http://bdimg.share.baidu.com/static/api/css/../img/share/icons_0_16.png?v=91362611.png);background-repeat:no-repeat;cursor:pointer;">天涯</a><a TITLE="分享到邮件分享" HREF="http://www.echojb.com/wireless/2017/01/17/304182.html#" STYLE="border:0px;font-family:inherit;font-size:12px;font-style:inherit;margin:6px 6px 6px 0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;color:rgb(68, 68, 68);text-decoration:none;-webkit-tap-highlight-color:rgba(255, 0, 0, 0);background-position:0px -2340px;float:left;padding-left:17px;line-height:16px;height:16px;background-image:url(http://bdimg.share.baidu.com/static/api/css/../img/share/icons_0_16.png?v=91362611.png);background-repeat:no-repeat;cursor:pointer;">邮件分享</a><a TITLE="分享到复制网址" HREF="http://www.echojb.com/wireless/2017/01/17/304182.html#" STYLE="border:0px;font-family:inherit;font-size:12px;font-style:inherit;margin:6px 6px 6px 0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;color:rgb(68, 68, 68);text-decoration:none;-webkit-tap-highlight-color:rgba(255, 0, 0, 0);background-position:0px -2288px;float:left;padding-left:17px;line-height:16px;height:16px;background-image:url(http://bdimg.share.baidu.com/static/api/css/../img/share/icons_0_16.png?v=91362611.png);background-repeat:no-repeat;cursor:pointer;">复制网址</a><span STYLE="font-family:inherit;font-size:100%;font-style:inherit;visibility:hidden;display:block;height:0px;clear:both;">.</span></div></div> 
&Tab;&Tab;&Tab;&Tab;&Tab;<div STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px 20px;vertical-align:baseline;box-sizing:inherit;">Date：2017-01-17</div>
&Tab;&Tab;&Tab;&Tab;&Tab;<div STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px 20px;vertical-align:baseline;box-sizing:inherit;">Tag：<a HREF="http://www.echojb.com/search/search.php?q=%E7%A8%8B%E5%BA%8F" TARGET="_blank" STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px 10px 0px 0px;vertical-align:baseline;box-sizing:inherit;color:rgb(68, 68, 68);text-decoration:none;-webkit-tap-highlight-color:rgba(255, 0, 0, 0);overflow-wrap:break-word;word-break:break-all;"><span STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;">程序</span></a>　<a HREF="http://www.echojb.com/search/search.php?q=%E6%89%8B%E6%9C%BA" TARGET="_blank" STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px 10px 0px 0px;vertical-align:baseline;box-sizing:inherit;color:rgb(68, 68, 68);text-decoration:none;-webkit-tap-highlight-color:rgba(255, 0, 0, 0);overflow-wrap:break-word;word-break:break-all;"><span STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;">手机</span></a>　<a HREF="http://www.echojb.com/search/search.php?q=WIFI" TARGET="_blank" STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px 10px 0px 0px;vertical-align:baseline;box-sizing:inherit;color:rgb(68, 68, 68);text-decoration:none;-webkit-tap-highlight-color:rgba(255, 0, 0, 0);overflow-wrap:break-word;word-break:break-all;"><span STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;">WIFI</span></a>　<a HREF="http://www.echojb.com/search/search.php?q=%E5%88%86%E6%9E%90" TARGET="_blank" STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px 10px 0px 0px;vertical-align:baseline;box-sizing:inherit;color:rgb(68, 68, 68);text-decoration:none;-webkit-tap-highlight-color:rgba(255, 0, 0, 0);overflow-wrap:break-word;word-break:break-all;"><span STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;">分析</span></a>　<a HREF="http://www.echojb.com/search/search.php?q=MAC" TARGET="_blank" STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px 10px 0px 0px;vertical-align:baseline;box-sizing:inherit;color:rgb(68, 68, 68);text-decoration:none;-webkit-tap-highlight-color:rgba(255, 0, 0, 0);overflow-wrap:break-word;word-break:break-all;"><span STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;">MAC</span></a>　</div>
&Tab;&Tab;&Tab;&Tab;</div>
&Tab;&Tab;&Tab;</div>

&Tab;&Tab;&Tab;&Tab;<div STYLE="border:0px;font-family:inherit;font-size:100%;font-style:inherit;margin:0px;outline:0px;padding:0px;vertical-align:baseline;box-sizing:inherit;clear:both;"></div>
&Tab;</div>

&Tab;</div></div></span></div></div></div></div></div></div>
</div>
</en-note>      