---
title: 用 Python 脚本，监听附近网络 Wi-Fi 设备，通过邮件和微信进行消息推送 - 知乎
updated: 2019-06-01 00:34:20Z
created: 2019-06-01 00:34:20Z
source: https://zhuanlan.zhihu.com/p/55648225
---

下载 App
注册或登录
神奇的战士
​
哈尔滨工业大学 计算机科学与技术博士在读
​
关注
用 Python 脚本，监听附近网络 Wi-Fi 设备，通过邮件和微信进行消息推送
4 个月前 · 来自专栏
工科给事中的技术博客
代码地址
https://
github.com/wangshub/hmp
a-pi
在树莓派上，利用 Wireshark 扫描附近网络 WiFi 设备，并对扫描结果通过邮件或者微信进行推送。
临近春节回老家过年，家里没人，又不想安装摄像头监控，参考
howmanypeoplearearound
写了一个监测脚本，当有手机或其它 Wi-Fi 设备在附近时，通过邮件或者微信提醒。
特性
[x] Wi-Fi 设备扫描
[x] 邮件提醒
[x] 微信提醒(Server 酱)
[ ] 陌生设备检测
原理
在 Wi-Fi 网络中，无线网卡是以广播模式发射信号的。当无线网卡将信息广播出去后，所有的设备都可以接收到该信息。将无线网卡设置为监听模式后，就可以捕获到该网卡接收范围的所有数据包。
通过这些数据包，就可以扫描出附近 Wi-Fi 的网络内的设备与信号强度。
监听模式的网卡
一些支持监听模式的网卡
wifi-adapter-that-supports-monitor-mode
USB Rt3070 $14
Panda PAU5 $14
Panda PAU6 $15
Panda PAU9 $36
Alfa AWUSO36NH $33
Alfa AWUS036NHA $40
Alfa AWUS036NEH $40
Sabrent NT-WGHU $15 (b/g) only
软件安装
Mac
 brew install wireshark
 brew cask install wireshark-chmodbpf

Linux 或 Raspberry Pi
sudo apt-get install tshark

# run as non-root

sudo dpkg-reconfigure wireshark-common    
(
select
 YES
)

sudo usermod -a -G wireshark
${
USER
:-
root
}

newgrp wireshark

配置网卡
如果是支持监听模式的网卡，可以直接运行
如果刚好是 Rtl8192 + Raspberry Pi，需要先卸载rtl8192驱动，再加载RTL8188驱动
#!/usr/bin/env bash
uname -a

# disable rtl8192 driver
sudo depmod 4.14.79-v7+
sudo rmmod 8192cu
sudo modprobe rtl8192cu

# set RTL8188 monitor mode
sudo ifconfig wlan1 down
sudo iwconfig wlan1 mode monitor
sudo ifconfig wlan1 up
运行代码
下载代码
git clone https://github.com/wangshub/hmpa-pi.git

cd
 hmpa-pi/
&&
 pip install -r requirements.txt

编辑配置文件
cp config/config.py.example config/config.py
vi config/config.py

参考配置
adapter

=

'wlan1'

use_email

=

True

email

=

{
"host"
:

"smtp.163.com"
,

"port"
:

465
,

"user"
:

"xxxxxxx@163.com"
,

"password"
:

"xxxxxxxxxx"
,

"to_user"
:

"xxxxxxxx@xxxx.com"
}

use_wechat

=

True

serverchan

=

{
"sckey"
:

"xxxxxxxxxxxxxxxxxxxxx"
}

known_devices

=

{
"94:65:2d:xx:xx:xx"
:

"my cellPhone"
,

"dc:a4:ca:xx:xx:xx"
:

"my Mac"
,

"b8:27:eb:xx:xx:xx"
:

"my raspberry"
}

运行
python main.py

消息推送
Server 酱微信推送
，需要 Github 登录获取
sckey
yagmail 邮箱推送
运行结果
2019-01-24 07:37:01.211617 一共发现了 67 台设备

Known Devices:
- my cellPhone
- my raspberry
- my mac

All Devices:
- 00:e0:70:3e:xx:xx 14 DH TECHNOLOGY
- 94:65:2d:91:xx:xx 14 OnePlus Technology (Shenzhen) Co., Ltd
- dc:d9:16:7e:xx:xx -12 HUAWEI TECHNOLOGIES CO.,LTD
- b8:27:eb:12:xx:xx -20 Raspberry Pi Foundation
- 98:01:a7:eb:xx:xx -40 Apple, Inc.
- 20:5d:47:44:xx:xx -44 vivo Mobile Communication Co., Ltd.
- ac:b5:7d:5f:xx:xx -46 Liteon Technology Corporation
- 04:03:d6:1f:xx:xx -47 Nintendo Co.,Ltd
- d4:ee:07:55:xx:xx -48 HIWIFI Co., Ltd.
- 44:6e:e5:63:xx:xx -51 HUAWEI TECHNOLOGIES CO.,LTD
- 14:75:90:8d:xx:xx -51 TP-LINK TECHNOLOGIES CO.,LTD.
- 34:96:72:1d:xx:xx -56 TP-LINK TECHNOLOGIES CO.,LTD.
- d8:cb:8a:74:xx:xx -57 Micro-Star INTL CO., LTD.
- 40:8d:5c:21:xx:xx -57 GIGA-BYTE TECHNOLOGY CO.,LTD.
- 6c:59:40:25:xx:xx -58 SHENZHEN MERCURY COMMUNICATION TECHNOLOGIES CO.,LTD.

More ...

TODO
[ ] 美化打印信息
[ ] 更优雅的参数配置
[ ] 当发现新设备时提醒
[ ] 绘图统计
[ ] 设备距离估计
参考链接
schollz / howmanypeoplearearound
derv82 / wifite2
第 3 章 监听 WiFi 网络
License
MIT
仅供学习和研究，切勿非法使用
代码地址
https://
github.com/wangshub/hmp
a-pi
编辑于 2019-01-24
Python
Wi-Fi
树莓派（Raspberry Pi）
文章被以下专栏收录
工科给事中的技术博客
关注专栏
Python程序员
Python相关的文章、资源、课程、资讯等分享
关注专栏
推荐阅读
Python 骚操作-邮件转微信
阅读本文大约需要 2 分钟。 今天是七夕，来一波浪的，如果你没有出去玩，不妨一试。在日常工作中，我们会经常收到邮件，有些是重要的邮件我们希望第一时间知晓，如领导发送的邮件，程序报警…
somenzz
给python脚本加个图形界面（GUI）并打包成绿色软件
少年猫
黑客世界！同桌学会Python后整天捣鼓这些稀奇古怪的黑客脚本！
NicePython
python:用itchat打造属于自己的微信聊天机器人，挂在自己的服务器上24小时运行，很简单~
thin... · 发表于python学习
查看更多
5 条评论
写下你的评论…
王盖文
2 个月前
感谢写作。想问下是不是所有的RT3070都可以，案例中使用的型号能否给一下？谢谢
​
赞
​
回复
​
举报
神奇的战士
 (作者)
回复
王盖文
2 个月前
我用的就是 RT3070，淘宝上有
​
1
​
查看对话
​
回复
​
举报
王盖文
回复
神奇的战士
 (作者)
2 个月前
谢谢，我是指具体网卡品牌和型号，我有个vodafane的RT3070，似乎不起作用，发现不了任何设备。运行你的代码本身没有问题。
​
赞
​
查看对话
​
回复
​
举报
王盖文
回复
神奇的战士
 (作者)
2 个月前
昨天继续尝试后，发现需要先down掉wlan1，iwconfig设置monitor mode，然后再up wlan1，最后sudo python main.py，就行了
​
1
​
查看对话
​
回复
​
举报
王盖文
2 个月前
但是还是想请教下，抓下来的数据要分析的话，有没有可以参考的文档，我的需求是想过滤出来某些设备的数据。
​
赞
​
回复
​
举报
App 内打开
44
​
5 条评论
​