{
  "ingest_source": {
    "id": "bea64955-62c7-46b3-b45d-d29502dbbdce",
    "source_type": "evernote_html",
    "source_path": "/Users/tang/workbench/article-classifier/backups/2023年6月/IT技术/sudoers改坏后无法使用sudo的解决办法.html",
    "collected_at": "2025-11-09T20:01:35.132007Z",
    "external_id": null,
    "title_hint": null,
    "language_hint": "en",
    "captured_at": null,
    "checksum": "a713ca0b8d181c0960ce8230a4a35c65382fe1055928f4ee98ace3f2d6a8192b",
    "status": "pending",
    "notes": {
      "batch_id": null
    }
  },
  "note": {
    "id": "f29308e4-6163-4bd3-85eb-2983f6fac8a4",
    "ingest_source_id": "bea64955-62c7-46b3-b45d-d29502dbbdce",
    "canonical_title": "sudoers改坏后无法使用sudo的解决办法",
    "language": "en",
    "ingested_at": "2025-11-09T20:01:35.132011Z",
    "created_at": null,
    "status": "active",
    "importance": 0,
    "attributes": {
      "source_filename": "sudoers改坏后无法使用sudo的解决办法.html"
    }
  },
  "variants": [
    {
      "id": "bd8e65e0-fd38-43f3-9912-383b6d87ffaa",
      "note_id": "f29308e4-6163-4bd3-85eb-2983f6fac8a4",
      "variant_type": "raw_html",
      "version": 1,
      "created_by": "evernote_ingest:v0",
      "created_at": "2025-11-09T20:01:35.132013Z",
      "content": "---\ntitle: sudoers改坏后无法使用sudo的解决办法\nupdated: 2021-01-10 21:20:00Z\ncreated: 2021-01-10 21:18:44Z\nauthor: tangyongfeng@gmail.com\n---\n\n\n<en-note><div><span STYLE=\"-en-paragraph:true;\">练习安装odoo的时候，创建了一个odoo用户，想把它赋予sudo权限，然而，编辑的时候不留意，改坏了，导致sudo无法使用，无法编辑sudoers文件修改回来。\n</span></div><div><span STYLE=\"-en-paragraph:true;\">提示如下信息：</span></div><div><span STYLE=\"-en-paragraph:true;\">&gt;&gt;&gt; /etc/sudoers: syntax error near line 22 &lt;&lt;&lt;</span><span STYLE=\"-en-paragraph:true;\">sudo: parse error in /etc/sudoers near line 22sudo: no valid sudoers sources found, quitting</span><span STYLE=\"-en-paragraph:true;\">sudo: unable to initialize policy plugin</span></div><div><span STYLE=\"-en-paragraph:true;\">任何涉及权限的操作的无法进行，编辑查看都不行。我不想重装系统了.</span></div><div><span STYLE=\"-en-paragraph:true;\">各种搜索，找到说可以使用下面的命令来编辑sudoers文件</span></div><div>pkexec visudo</div><div><span STYLE=\"-en-paragraph:true;\">然而，又出现了新的错误\n</span></div><div>==== AUTHENTICATING FOR org.freedesktop.policykit.exec ===Authentication is needed to run `/usr/sbin/visudo&apos; as the super userAuthenticating as: ubuntu,,, (ubuntu)Password:polkit-agent-helper-1: error response to PolicyKit daemon: GDBus.Error:org.freedesktop.PolicyKit1.Error.Failed: No session for cookie==== AUTHENTICATION FAILED ===Error executing command as another user: Not authorizedThis incident has been reported.</div><div><span STYLE=\"-en-paragraph:true;\">然后终于找到一个神奇的方法：远程的话开两个ssh终端，能直接操作物理机的话使用ctrl+alt+F2 创建第二个终端窗口【</span><span STYLE=\"-en-paragraph:true;\">使用ctrl+alt+F1=》tty1;ctrl+alt+F2=》tty2对窗口进行切换】，两个终端，都用ubuntu用户登录。</span><span STYLE=\"-en-paragraph:true;\">\n</span></div><div><br/></div><div><span STYLE=\"-en-paragraph:true;\">对tty1终端：输入 echo $$//获取pid\n</span></div><div><br/></div><div><span STYLE=\"-en-paragraph:true;\">切换到tty2：输入</span></div><div><span STYLE=\"-en-paragraph:true;\">pkttyagent --process 获取的pid值 ；此时该tty2终端会卡住</span></div><div><span STYLE=\"-en-paragraph:true;\"> </span></div><div><span STYLE=\"-en-paragraph:true;\"> \n</span></div><div><span STYLE=\"-en-paragraph:true;\">切到tty1：输入 pkexec visudo ；此时tty1也会卡住\n</span></div><div><br/></div><div><span STYLE=\"-en-paragraph:true;\">切到tty2：会看到要求输入密码，对应输入\n</span></div><div><br/></div><div><span STYLE=\"-en-paragraph:true;\">切回到tty1：发现已经进入了visudo编辑界面，修改出错的sudoers，保存\n</span></div><div><br/></div><div><span STYLE=\"-en-paragraph:true;\">修改完成，按 CTRL + X 保存退出 发现就可以继续使用sudo命令了。</span></div><div><span STYLE=\"-en-paragraph:true;\"> \n</span></div><div><span STYLE=\"-en-paragraph:true;\">PS:</span></div><div><span STYLE=\"-en-paragraph:true;\">一般对/etc/sudoers文件进行操作,建议使用visudo命令. 注意:</span><span STYLE=\"-en-paragraph:true;\">不要直接使用 vi,直接使用vi不会对文件新加的做相关验证,这可能导致该文件无法正确解析.最终导致sudo命令不能使用,也不能切换使用root用户等一系列问题..</span></div></en-note>      ",
      "content_path": null,
      "diff_base_variant_id": null,
      "metadata": {
        "checksum": "a713ca0b8d181c0960ce8230a4a35c65382fe1055928f4ee98ace3f2d6a8192b",
        "path": "/Users/tang/workbench/article-classifier/backups/2023年6月/IT技术/sudoers改坏后无法使用sudo的解决办法.html"
      }
    },
    {
      "id": "4b16830d-f080-4658-b5bc-9e13b165f324",
      "note_id": "f29308e4-6163-4bd3-85eb-2983f6fac8a4",
      "variant_type": "clean_text",
      "version": 1,
      "created_by": "evernote_ingest:v0",
      "created_at": "2025-11-09T20:01:35.132016Z",
      "content": "---\ntitle: sudoers改坏后无法使用sudo的解决办法\nupdated: 2021-01-10 21:20:00Z\ncreated: 2021-01-10 21:18:44Z\nauthor: tangyongfeng@gmail.com\n---\n\n练习安装odoo的时候，创建了一个odoo用户，想把它赋予sudo权限，然而，编辑的时候不留意，改坏了，导致sudo无法使用，无法编辑sudoers文件修改回来。\n\n提示如下信息：\n>>> /etc/sudoers: syntax error near line 22 <<<\nsudo: parse error in /etc/sudoers near line 22sudo: no valid sudoers sources found, quitting\nsudo: unable to initialize policy plugin\n任何涉及权限的操作的无法进行，编辑查看都不行。我不想重装系统了.\n各种搜索，找到说可以使用下面的命令来编辑sudoers文件\npkexec visudo\n然而，又出现了新的错误\n\n==== AUTHENTICATING FOR org.freedesktop.policykit.exec ===Authentication is needed to run `/usr/sbin/visudo' as the super userAuthenticating as: ubuntu,,, (ubuntu)Password:polkit-agent-helper-1: error response to PolicyKit daemon: GDBus.Error:org.freedesktop.PolicyKit1.Error.Failed: No session for cookie==== AUTHENTICATION FAILED ===Error executing command as another user: Not authorizedThis incident has been reported.\n然后终于找到一个神奇的方法：远程的话开两个ssh终端，能直接操作物理机的话使用ctrl+alt+F2 创建第二个终端窗口【\n使用ctrl+alt+F1=》tty1;ctrl+alt+F2=》tty2对窗口进行切换】，两个终端，都用ubuntu用户登录。\n\n对tty1终端：输入 echo $$//获取pid\n\n切换到tty2：输入\npkttyagent --process 获取的pid值 ；此时该tty2终端会卡住\n\n切到tty1：输入 pkexec visudo ；此时tty1也会卡住\n\n切到tty2：会看到要求输入密码，对应输入\n\n切回到tty1：发现已经进入了visudo编辑界面，修改出错的sudoers，保存\n\n修改完成，按 CTRL + X 保存退出 发现就可以继续使用sudo命令了。\n\nPS:\n一般对/etc/sudoers文件进行操作,建议使用visudo命令. 注意:\n不要直接使用 vi,直接使用vi不会对文件新加的做相关验证,这可能导致该文件无法正确解析.最终导致sudo命令不能使用,也不能切换使用root用户等一系列问题..",
      "content_path": null,
      "diff_base_variant_id": null,
      "metadata": {
        "language": "en",
        "length": 1395,
        "rule_count": 2,
        "applied_rules": [
          {
            "rule_id": "dedupe_lines",
            "description": "Collapse adjacent duplicate lines",
            "note": "collapsed duplicate adjacent lines"
          },
          {
            "rule_id": "whitespace",
            "description": "Normalize whitespace",
            "note": "collapsed whitespace"
          }
        ]
      }
    }
  ],
  "extractions": [],
  "journal": {
    "id": "d263bc50-259c-4418-a53d-0eca10ceed0b",
    "note_id": "f29308e4-6163-4bd3-85eb-2983f6fac8a4",
    "stage": "ingest",
    "agent_id": "evernote_ingest:v0",
    "started_at": "2025-11-09T20:01:35.132021Z",
    "finished_at": "2025-11-09T20:01:35.132021Z",
    "status": "success",
    "input_ref": {
      "task_id": "34cde79c-ba1e-481c-8730-0f53b71ee82e",
      "source_path": "/Users/tang/workbench/article-classifier/backups/2023年6月/IT技术/sudoers改坏后无法使用sudo的解决办法.html",
      "checksum": "a713ca0b8d181c0960ce8230a4a35c65382fe1055928f4ee98ace3f2d6a8192b"
    },
    "output_ref": {
      "ingest_source": "bea64955-62c7-46b3-b45d-d29502dbbdce",
      "note": "f29308e4-6163-4bd3-85eb-2983f6fac8a4",
      "variants": [
        "bd8e65e0-fd38-43f3-9912-383b6d87ffaa",
        "4b16830d-f080-4658-b5bc-9e13b165f324"
      ]
    },
    "error_detail": null
  }
}