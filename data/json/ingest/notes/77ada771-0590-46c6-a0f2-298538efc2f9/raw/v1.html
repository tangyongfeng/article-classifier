---
title: 免费SSL安全证书Let's Encrypt安装使用教程(附Nginx/Apache配置) - VPS侦探
updated: 2018-12-23 03:01:46Z
created: 2018-12-23 03:01:46Z
source: https://www.vpser.net/build/letsencrypt-free-ssl.html
---


<en-note>
  <div>
<div><br/></div><div STYLE="font-size: 16px; display:block; min-width: 100%; "> <div STYLE="background-color:transparent;font:inherit;vertical-align:baseline;"><div STYLE="background-color:transparent;font:inherit;vertical-align:baseline;font-family:&quot;PT Serif&quot;;font-size:16px;line-height:1.5em;color:rgb(31, 9, 9);text-align:left;"><div STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;"><div STYLE="z-index:200;padding-left:2em;padding-right:2em;margin-left:auto;margin-right:auto;position:relative;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;width:36em;"><div STYLE="position:relative;margin-left:-25px;margin-right:25px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;"><div STYLE="position:relative;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;padding-top:4.5em;padding-bottom:9em;"><div STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"><div STYLE="margin-bottom:0px;position:relative;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;"><div STYLE="margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;"><div STYLE="margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;"><h1 STYLE="padding:0px;margin:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:35px;line-height:35px;margin-bottom:20px;font-family:&quot;PT Serif&quot;;text-align:left;">免费SSL安全证书Let&apos;s Encrypt安装使用教程(附Nginx/Apache配置)</h1><div STYLE="margin-bottom:0px;position:relative;margin:0px;height:1em;line-height:1;text-align:center;padding:0px;border:0px;font:inherit;vertical-align:baseline;padding-top:1.5em;padding-bottom:1.5em;"><div STYLE="margin-bottom:0px;position:absolute;left:-4em;top:50%;z-index:10;width:100%;padding-left:4em;padding-right:4em;height:0.1em;margin:0px;opacity:0.5;padding:0px;border:0px;font:inherit;vertical-align:baseline;background:-webkit-linear-gradient(0deg, rgb(243, 242, 238) 1%, rgb(31, 9, 9) 50%, rgb(243, 242, 238) 99%);"><span STYLE="font:inherit;position:absolute;left:-4em;top:50%;z-index:10;width:100%;padding-left:4em;padding-right:4em;height:0.1em;margin:0px;opacity:0.5;background:-webkit-linear-gradient(0deg, rgb(243, 242, 238) 1%, rgb(31, 9, 9) 50%, rgb(243, 242, 238) 99%);"></span></div></div></div>
&Tab;&Tab;&Tab;&Tab;<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">
&Tab;&Tab;&Tab;&Tab;&Tab;<span STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;">2015年12月9日 上午 | 作者：VPS侦探</span>
&Tab;&Tab;&Tab;&Tab;</p>
&Tab;&Tab;&Tab;&Tab;
&Tab;&Tab;&Tab;&Tab;&Tab;<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"><a HREF="https://www.vpser.net/build/letsencrypt-free-ssl.html" TARGET="_blank" STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);"><img src="../_resources/84abd5c796f93270b5db58a78f0c686f.png"  type="image/png" hash="84abd5c796f93270b5db58a78f0c686f" width="334" height="79" style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;border-color:rgb(6, 85, 136);" alt="" /></en-media></a></p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">Let&apos;s Encrypt是最近很火的一个免费SSL证书发行项目，Let&apos;s Encrypt是由ISRG提供的免费免费公益项目，自动化发行证书，但是证书只有90天的有效期。适合个人使用或者临时使用，不用再忍受自签发证书不受浏览器信赖的提示。前段时间一直是内测，现在已经开放了。本教程安装不需要停掉当前Web服务(Nginx/Apache)，直接生成证书，废话不多说下面开始：</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">目前已经更新为新工具certbot，使用教程：<a HREF="https://www.vpser.net/build/letsencrypt-certbot.html" TARGET="_blank" STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);">https://www.vpser.net/build/letsencrypt-certbot.html</a> 配置文件和以前一样。<br/>
<del STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;">建议使用git 以后有了新版更新方便，没安装的话Debian/Ubuntu：<strong STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;">apt-get install git</strong> ，CentOS：<strong STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;">yum install git-core</strong></del><br/>
<del STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;"> <strong STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;">git clone https://github.com/letsencrypt/letsencrypt.git</strong></del><br/>
<del STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;"> <strong STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;"> cd letsencrypt</strong></del></p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"><del STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;">不安装git的话：<strong STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;">wget -c&nbsp;https://github.com/letsencrypt/letsencrypt/archive/master.zip &amp;&amp; unzip&nbsp;master.zip &amp;&amp; cd&nbsp;letsencrypt-master</strong></del></p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"><a HREF="https://lnmp.org/" TARGET="_blank" STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);">LNMP一键安装包</a>都是Nginx/Apache默认支持ssl不需要另外单独编译，接下来先以<a HREF="https://lnmp.org/" TARGET="_blank" STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);">LNMP一键安装包</a>为例，LNMP用户可以直接参考此教程(LNMP v1.4自带此功能，可以直接使用lnmp ssl add (已经添加过该域名) 或lnmp vhost add (未添加过该域名)添加，1.3及之前用户可以升级到1.4，<a HREF="https://bbs.vpser.net/thread-14905-1-1.html" TARGET="_blank" STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);">lnmp1.3升级1.4教程</a>)：</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">执行：<strong STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;">mkdir -p /home/wwwroot/域名/.well-known/acme-challenge</strong> 创建临时目录，当然这个.well-known/acme-challenge前面的目录要替换为你自己的网站目录，根据你自己的实际情况修改。</p>
<h3 STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;font-family:&quot;PT Serif&quot;;text-align:left;">正式开始生成证书</h3>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"><del STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;">接下来正式进行证书生成操作：</del><br/>
<del STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;"> <strong STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;">./letsencrypt-auto certonly --email 邮箱 -d 域名 --webroot -w /网站目录完整路径 --agree-tos</strong></del><br/>
<del STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;"> 如果多个域名可以加多个-d 域名，注意替换上面的邮箱、域名和网站目录，注意这里的网站目录完整路径只是你单纯的网站目录也就是虚拟主机配置文件里的，如Nginx虚拟主机配置里的root，Apache虚拟主机配置里的DocumentRoot。</del></p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">首先Let&apos;s Encrypt会检测系统安装一些依赖包，安装完依赖包会有<del STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;">蓝色的让阅读TOS的提示，Agree回车 稍等片刻就行了</del>可添加--agree-tos参数屏蔽该窗口。<br/>
生成证书后会有如下提示：</p>
<blockquote STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;quotes:none;margin-bottom:1.5em;font-style:italic;border-left:5px solid;margin-left:2em;padding-left:1em;"><span STYLE="font:inherit;quotes:none;font-style:italic;"></span><p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">IMPORTANT NOTES:<br/>
- If you lose your account credentials, you can recover through<br/>
e-mails sent to licess@vpser.net.<br/>
- Congratulations! Your certificate and chain have been saved at<br/>
/etc/letsencrypt/live/www.vpser.net/fullchain.pem. Your cert will<br/>
expire on 2016-03-07. To obtain a new version of the certificate in<br/>
the future, simply run Let&apos;s Encrypt again.<br/>
- Your account credentials have been saved in your Let&apos;s Encrypt<br/>
configuration directory at /etc/letsencrypt. You should make a<br/>
secure backup of this folder now. This configuration directory will<br/>
also contain certificates and private keys obtained by Let&apos;s<br/>
Encrypt so making regular backups of this folder is ideal.<br/>
- If like Let&apos;s Encrypt, please consider supporting our work by:</p>
<p STYLE="margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;">Donating to ISRG / Let&apos;s Encrypt: https://letsencrypt.org/donate<br/>
Donating to EFF: https://eff.org/donate-le</p><span STYLE="font:inherit;quotes:none;font-style:italic;"></span></blockquote>
<h3 STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;font-family:&quot;PT Serif&quot;;text-align:left;">Nginx虚拟主机的设置</h3>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">接下来进行配置Nginx虚拟主机文件，<a HREF="https://lnmp.org/" TARGET="_blank" STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);">LNMP</a>模式下完整配置如下：</p>
<blockquote STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;quotes:none;margin-bottom:1.5em;font-style:italic;border-left:5px solid;margin-left:2em;padding-left:1em;"><span STYLE="font:inherit;quotes:none;font-style:italic;"></span><p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">server<br/>
{<br/>
listen 443 ssl; &nbsp; #lnmp1.3+版本默认支持http2，可以加上http2，lnmp1.2版本默认支持spdy，可以加上spdy<br/>
server_name www.vpser.net; &nbsp; &nbsp; ##这里是你的域名<br/>
index index.html index.htm index.php default.html default.htm default.php;<br/>
root /home/wwwroot/www.vpser.net; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#网站目录<br/>
ssl_certificate /etc/letsencrypt/live/www.vpser.net/fullchain.pem; &nbsp; &nbsp;#前面生成的证书，改一下里面的域名就行<br/>
ssl_certificate_key /etc/letsencrypt/live/www.vpser.net/privkey.pem; &nbsp; #前面生成的密钥，改一下里面的域名就行<br/>
SSLCertificateChainFile /etc/letsencrypt/live/www.vpser.net/chain.pem; #Apache 2.2版本需要加入该中间证书，否则浏览器可能不信任<br/>
ssl_ciphers &quot;EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5&quot;;<br/>
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;<br/>
ssl_prefer_server_ciphers on;<br/>
ssl_session_cache shared:SSL:10m;</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">include wordpress.conf; &nbsp;#这个是伪静态根据自己的需求改成其他或删除<br/>
#error_page 404 /404.html;<br/>
location ~ [^/]\.php(/|$)<br/>
{<br/>
# comment try_files $uri =404; to enable pathinfo<br/>
try_files $uri =404;<br/>
fastcgi_pass unix:/tmp/php-cgi.sock;<br/>
fastcgi_index index.php;<br/>
include fastcgi.conf; &nbsp; &nbsp; #lnmp 1.0及之前版本替换为include fcgi.conf;<br/>
#include pathinfo.conf;<br/>
}</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$<br/>
{<br/>
expires 30d;<br/>
}</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">location ~ .*\.(js|css)?$<br/>
{<br/>
expires 12h;<br/>
}</p>
<p STYLE="margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;">access_log off;<br/>
}</p><span STYLE="font:inherit;quotes:none;font-style:italic;"></span></blockquote>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">需将上述配置根据自己的实际情况修改后，添加到虚拟主机配置文件最后面。</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">添加完需要执行：<strong STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;">/etc/init.d/nginx reload</strong> 重新载入配置使其生效。</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"><strong STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;">不要轻易添加HSTS</strong>，如果需要HSTS，可以加上add_header Strict-Transport-Security &quot;max-age=63072000; includeSubdomains; preload&quot;; 前面参数里的数值是秒。<strong STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;">&nbsp;开启后有效期内只能https访问而且所有二级域名也都是强制https，不确定的话不要开启。</strong></p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">LNMPA模式下只需要在Nginx上设置，只需要将location ~ [^/]\.php(/|$) { 到下一个 } 的php解析部分替换为 include proxy-pass-php.conf; 即可。</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"><strong STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;">Apache虚拟主机上的设置</strong></p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">LAMP模式按下面配置文件。Apache在生成证书后也需要修改一下apache的配置文件 /usr/local/apache/conf/httpd.conf ，查找httpd-ssl将前面的#去掉。</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">然后再执行：</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">Apache 2.2如下：<br/>
cat &gt;/usr/local/apache/conf/extra/httpd-ssl.conf&lt;&lt;EOF<br/>
Listen 443</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">AddType application/x-x509-ca-cert .crt<br/>
AddType application/x-pkcs7-crl .crl</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">SSLCipherSuite EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5<br/>
SSLProxyCipherSuite EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5<br/>
SSLHonorCipherOrder on</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">SSLProtocol all -SSLv2 -SSLv3<br/>
SSLProxyProtocol all -SSLv2 -SSLv3<br/>
SSLPassPhraseDialog builtin</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">SSLSessionCache &quot;shmcb:/usr/local/apache/logs/ssl_scache(512000)&quot;<br/>
SSLSessionCacheTimeout 300</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">SSLMutex &quot;file:/usr/local/apache/logs/ssl_mutex&quot;</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">SSLStrictSNIVHostCheck on<br/>
NameVirtualHost *:443<br/>
EOF</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">Apache 2.4如下：</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">cat &gt;/usr/local/apache/conf/extra/httpd-ssl.conf&lt;&lt;EOF<br/>
Listen 443</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">AddType application/x-x509-ca-cert .crt<br/>
AddType application/x-pkcs7-crl .crl</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">SSLCipherSuite EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5<br/>
SSLProxyCipherSuite EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5<br/>
SSLHonorCipherOrder on</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">SSLProtocol all -SSLv2 -SSLv3<br/>
SSLProxyProtocol all -SSLv2 -SSLv3<br/>
SSLPassPhraseDialog builtin</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">SSLSessionCache &quot;shmcb:/usr/local/apache/logs/ssl_scache(512000)&quot;<br/>
SSLSessionCacheTimeout 300</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">Mutex sysvsem default</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">SSLStrictSNIVHostCheck on<br/>
EOF</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">并在对应apache虚拟主机配置文件的最后&lt;/VirtualHost&gt;下面添加上SSL部分的配置文件：</p>
<blockquote STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;quotes:none;margin-bottom:1.5em;font-style:italic;border-left:5px solid;margin-left:2em;padding-left:1em;"><span STYLE="font:inherit;quotes:none;font-style:italic;"></span><p STYLE="margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;">&lt;VirtualHost *:443&gt;<br/>
DocumentRoot /home/wwwroot/www.vpser.net &nbsp; #网站目录<br/>
ServerName www.vpser.net:443 &nbsp; #域名<br/>
ServerAdmin licess@vpser.net &nbsp; &nbsp; &nbsp;#邮箱<br/>
ErrorLog &quot;/home/wwwlogs/www.vpser.net-error_log&quot; &nbsp; #错误日志<br/>
CustomLog &quot;/home/wwwlogs/www.vpser.net-access_log&quot; common &nbsp; &nbsp;#访问日志<br/>
SSLEngine on<br/>
SSLCertificateFile /etc/letsencrypt/live/www.vpser.net/fullchain.pem &nbsp; #改一下里面的域名就行<br/>
SSLCertificateKeyFile /etc/letsencrypt/live/www.vpser.net/privkey.pem &nbsp; &nbsp;#改一下里面的域名就行<br/>
&lt;Directory &quot;/home/wwwroot/www.vpser.net&quot;&gt; &nbsp; #网站目录<br/>
SetOutputFilter DEFLATE<br/>
Options FollowSymLinks<br/>
AllowOverride All<br/>
Order allow,deny<br/>
Allow from all<br/>
DirectoryIndex index.html index.php<br/>
&lt;/Directory&gt;<br/>
&lt;/VirtualHost&gt;</p><span STYLE="font:inherit;quotes:none;font-style:italic;"></span></blockquote>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">需将上述配置根据自己的实际情况修改后，添加到虚拟主机配置文件最后面。注意要重启apache使其实现。执行：<strong STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;">/etc/init.d/httpd restart</strong> 重启Apache使其生效。</p>
<h3 STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;font-family:&quot;PT Serif&quot;;text-align:left;">下面说一下可能会遇到的问题：</h3>
<h4 STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;font-size:20px;margin-top:30px;margin-bottom:1.5em;font-family:&quot;PT Serif&quot;;text-align:left;">1、国内DNS服务商可能会不行，<del STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;">目前已知dnspod、cloudxns不行</del>dnspod、cloudxns目前已经可以</h4>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">Namecheap、Route 53的都可以。</p>
<h4 STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;font-size:20px;margin-top:30px;margin-bottom:1.5em;font-family:&quot;PT Serif&quot;;text-align:left;">2、Linode福利或IPv6用户福利</h4>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">可能目前Linode用户应该遇到了<br/>
An unexpected error occurred:<br/>
There were too many requests of a given type :: Error creating new registration :: Too many registrations from this IP<br/>
Please see the logfiles in /var/log/letsencrypt for more details.<br/>
这个不一定是因为IP注册的次数过多，可能是因为IPv6的事，具体解决方法如下：<br/>
执行：<strong STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;">sysctl -w net.ipv6.conf.all.disable_ipv6=1</strong> 来临时禁用IPv6<br/>
再生成证书后执行：<strong STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;">sysctl -w net.ipv6.conf.all.disable_ipv6=0</strong> 再来解除禁用IPv6</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">3、如果启用了防火墙需要将443端口加入允许规则，一般iptables可以参考：<a HREF="https://www.vpser.net/security/linux-iptables.html" TARGET="_blank" STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);">https://www.vpser.net/security/linux-iptables.html</a></p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">4、如果LNMP下访问http://abc.com/.well-known/acme-challenge/**** 这个链接403的话是<strong STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;">因为默认LNMP 1.3的虚拟主机里是禁止.开头的隐藏文件及目录的。</strong>需要将<br/>
location ~ /\.<br/>
{<br/>
deny all;<br/>
}<br/>
这段配置删掉或注释掉或在这段配置前面加上</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">location ~ /.well-known {<br/>
allow all;<br/>
}</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">以上配置代码，然后重启nginx。</p>
<h3 STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;font-family:&quot;PT Serif&quot;;text-align:left;">证书续期</h3>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">最后要说的是续期，因为证书只有90天，所以建议60左右的时候进行一次续期，续期很简单可以交给<a HREF="https://www.vpser.net/manage/crontab.html" TARGET="_blank" STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);">crontab</a>进行完成，执行：</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"><del STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;"><strong STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;">cat &gt;/root/renew-ssl.sh&lt;&lt;EOF<br/>
#!/bin/bash<br/>
mkdir -p /网站目录完整路径/.well-known/acme-challenge<br/>
/root/letsencrypt/letsencrypt-auto --renew-by-default certonly --email 邮箱 -d 域名 --webroot -w /网站目录完整路径 --agree-tos<br/>
/etc/init.d/nginx reload<br/>
EOF<br/>
chmod +x /root/renew-ssl.sh</strong></del></p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"><del STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;">注意要修改上面letsencrypt-auto的路径为你自己的，并且里面的邮箱和域名也要修改。</del><br/>
<del STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;"> 再crontab里添加上：<strong STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;">0 3 */60 * * /root/renew-ssl.sh</strong>&nbsp;具体<a HREF="https://www.vpser.net/manage/crontab.html" TARGET="_blank" STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);">crontab教程点击查看</a></del></p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">2015.12.13更新<br/>
官网更新了参数，对本文进行了部分参数的调整。原-a webroot --webroot-path=/网站目录完整路径替换为--webroot -w；--renew替换为--renew-by-default；增加--agree-tos参数。</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;"><strong STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;">同时这里提醒一下如果设置了http 301跳到https的用户，再续期前还需要在nginx设置如下：</strong><br/>
80端口的虚拟主机上需要添加上，不加的话会无法验证的</p>
<blockquote STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;quotes:none;margin-bottom:1.5em;font-style:italic;border-left:5px solid;margin-left:2em;padding-left:1em;"><span STYLE="font:inherit;quotes:none;font-style:italic;"></span><p STYLE="margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;">location /.well-known/ {<br/>
add_header Content-Type &apos;text/plain;&apos;;<br/>
root /网站目录完整路径;<br/>
}</p><span STYLE="font:inherit;quotes:none;font-style:italic;"></span></blockquote>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">附完整的nginx下301 http跳到https的配置：</p>
<blockquote STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;quotes:none;margin-bottom:1.5em;font-style:italic;border-left:5px solid;margin-left:2em;padding-left:1em;"><span STYLE="font:inherit;quotes:none;font-style:italic;"></span><p STYLE="margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;">server<br/>
{<br/>
listen 80;<br/>
server_name www.vpser.net;<br/>
location /.well-known/ {<br/>
add_header Content-Type &apos;text/plain;&apos;;<br/>
root /网站目录完整路径;<br/>
}<br/>
location / {<br/>
return 301 https://www.vpser.net$request_uri;<br/>
}<br/>
}</p><span STYLE="font:inherit;quotes:none;font-style:italic;"></span></blockquote>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">目前就先说这些，有问题可以在本文章下部留言或到<a HREF="https://bbs.vpser.net/" TARGET="_blank" STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);">VPS论坛</a>发帖。</p>
<p STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">VPS侦探论坛邀请码：<a HREF="https://bbs.vpser.net/reg.php?invitecode=4957327b6f7rDwOe" TARGET="_blank" STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);">https://bbs.vpser.net/reg.php?invitecode=4957327b6f7rDwOe</a> &nbsp;有效期至：2015-12-13 14:34</p>
&Tab;&Tab;&Tab;&Tab;&Tab;<b STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;">&gt;&gt;转载请注明出处：<a HREF="https://www.vpser.net/" TARGET="_blank" STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);">VPS侦探</a> 本文链接地址：<a HREF="https://www.vpser.net/build/letsencrypt-free-ssl.html" TITLE="免费SSL安全证书Let's Encrypt安装使用教程(附Nginx/Apache配置)" TARGET="_blank" STYLE="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);">https://www.vpser.net/build/letsencrypt-free-ssl.html</a></b>





&Tab;&Tab;&Tab;&Tab;</div></div></div><div STYLE="position:absolute;top:-1000px;left:-1000px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;">Measure</div><div STYLE="margin-bottom:0px;position:absolute;top:-1000px;left:-1000px;line-height:1;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;">Measure</div></div></div></div></div></div></div></div>
</div>
</en-note>      