{
  "ingest_source": {
    "id": "1930c68c-9f3d-4d33-9f1e-5ac955e49812",
    "source_type": "evernote_html",
    "source_path": "backups/2023年6月/IT技术/python3之requests - Py.qi - 博客园.html",
    "collected_at": "2025-11-10T15:43:31.877779Z",
    "external_id": null,
    "title_hint": null,
    "language_hint": "en",
    "captured_at": null,
    "checksum": "67df169fdc7751cac393e280bbfa474da4d4a7a5bb0087b3b54bfc546b0e5b55",
    "status": "pending",
    "notes": {
      "batch_id": "phase2-backfill-202306"
    }
  },
  "note": {
    "id": "f7fd6c85-5723-4f35-a2e1-c74e4f57a836",
    "ingest_source_id": "1930c68c-9f3d-4d33-9f1e-5ac955e49812",
    "canonical_title": "python3之requests - Py.qi - 博客园",
    "language": "en",
    "ingested_at": "2025-11-10T15:43:31.877783Z",
    "created_at": null,
    "status": "active",
    "importance": 0,
    "attributes": {
      "source_filename": "python3之requests - Py.qi - 博客园.html"
    }
  },
  "variants": [
    {
      "id": "16eea4cd-a369-4cde-95f8-f5ff43133521",
      "note_id": "f7fd6c85-5723-4f35-a2e1-c74e4f57a836",
      "variant_type": "raw_html",
      "version": 1,
      "created_by": "evernote_ingest:v0",
      "created_at": "2025-11-10T15:43:31.877786Z",
      "content": "---\ntitle: python3之requests - Py.qi - 博客园\nupdated: 2019-01-25 11:58:54Z\ncreated: 2019-01-25 11:58:54Z\nsource: https://www.cnblogs.com/zhangxinqi/p/9201594.html\n---\n\n\n<en-note>\n  <div>\n<div><br/></div><div STYLE=\"font-size: 16px; display:block; min-width: 100%; \"> <div STYLE=\"background-color:transparent;font:inherit;vertical-align:baseline;\"><div STYLE=\"background-color:transparent;font:inherit;vertical-align:baseline;font-family:&quot;PT Serif&quot;;font-size:16px;line-height:1.5em;color:rgb(31, 9, 9);text-align:left;\"><div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\"><div STYLE=\"z-index:200;padding-left:2em;padding-right:2em;margin-left:auto;margin-right:auto;position:relative;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;width:36em;\"><div STYLE=\"position:relative;margin-left:-25px;margin-right:25px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\"><div STYLE=\"position:relative;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;padding-top:4.5em;padding-bottom:9em;\"><div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><div STYLE=\"margin-bottom:0px;position:relative;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\"><div STYLE=\"margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\"><div STYLE=\"margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\"><h1 STYLE=\"padding:0px;margin:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:35px;line-height:35px;margin-bottom:20px;font-family:&quot;PT Serif&quot;;text-align:left;\"> python3之requests </h1><div STYLE=\"margin-bottom:0px;position:relative;margin:0px;height:1em;line-height:1;text-align:center;padding:0px;border:0px;font:inherit;vertical-align:baseline;padding-top:1.5em;padding-bottom:1.5em;\"><div STYLE=\"margin-bottom:0px;position:absolute;left:-4em;top:50%;z-index:10;width:100%;padding-left:4em;padding-right:4em;height:0.1em;margin:0px;opacity:0.5;padding:0px;border:0px;font:inherit;vertical-align:baseline;background:-webkit-linear-gradient(0deg, rgb(243, 242, 238) 1%, rgb(31, 9, 9) 50%, rgb(243, 242, 238) 99%);\"><span STYLE=\"font:inherit;position:absolute;left:-4em;top:50%;z-index:10;width:100%;padding-left:4em;padding-right:4em;height:0.1em;margin:0px;opacity:0.5;background:-webkit-linear-gradient(0deg, rgb(243, 242, 238) 1%, rgb(31, 9, 9) 50%, rgb(243, 242, 238) 99%);\"></span></div></div></div>\n&Tab;&Tab;\n&Tab;&Tab;\n&Tab;&Tab;&Tab;<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><a HREF=\"https://www.cnblogs.com/zhangxinqi/p/9201594.html#_labelTop\" TARGET=\"_blank\" STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);\">回到顶部</a></div><h3 STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;font-family:&quot;PT Serif&quot;;text-align:left;\">1、requests简介</h3>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">requests是通过urllib3实现自动发送HTTP/1.1请求，它能轻松的实现cookies，登陆验证，代理设置等操作。</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">Python内置的urllib模块，用于访问网络资源。但是，它用起来比较麻烦，而且，缺少很多实用的高级功能。<br/>更好的方案是使用requests。它是一个Python第三方库，处理URL 资源特别方便</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">requests实现内容：</p>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;margin-top:-1em;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">保持活力和连接池</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">支持国际域名和网址</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">会话与Cookie持久性</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">浏览器式SSL验证</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">自动内容解码</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">基本/摘要式身份验证</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">自动解压缩</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">Unicode响应body</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">HTTP(s)代理支持</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">多部分文件上传</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">流媒体下载</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">连接超时</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">分块的请求</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">.netrc 支持</li>\n\n</ul>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><a HREF=\"https://www.cnblogs.com/zhangxinqi/p/9201594.html#_labelTop\" TARGET=\"_blank\" STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);\">回到顶部</a></div><h3 STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;font-family:&quot;PT Serif&quot;;text-align:left;\">2、requests的安装</h3>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">(1)源码安装：</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">git clone git: // github.com / requests / requests.git # 克隆公共存储库\n或者下载tarball\ncurl - OL https: // github.com / requests / requests / tarball / master\ncd requests / requests\npip install .</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">(2)pip安装</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">pip install requests</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">(3)pipenv安装在虚拟环境下安装</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">pipenv install requests</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">request依赖包关系：</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">requests==2.19.1\n  - certifi [required: &gt;=2017.4.17, installed: 2018.4.16]  #CA认证模块\n  - chardet [required: &lt;3.1.0,&gt;=3.0.2, installed: 3.0.4]  #通用字符编码检测器模块\n  - idna [required: &lt;2.8,&gt;=2.5, installed: 2.7]  #国际化域名解析模块\n  - urllib3 [required: &lt;1.24,&gt;=1.21.1, installed: 1.23] #线程安全HTTP库</pre>\n</div>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><a HREF=\"https://www.cnblogs.com/zhangxinqi/p/9201594.html#_labelTop\" TARGET=\"_blank\" STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);\">回到顶部</a></div><h3 STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;font-family:&quot;PT Serif&quot;;text-align:left;\">3、requests请求</h3>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">所有请求的功能可通过这7种方法访问，他们都返回response对象的一个实例。<br/>(1)requests.request(method,url,**kwargs):构造并发送一个request，返回一个response对象<br/>参数：</p>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;margin-top:-1em;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">method：　　request对象的方法(POST)</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">url：　　request对象的URL</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">params：可选的，要在查询字符串中发送的字典或字节request</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">data：可选的，字典或元祖列表以表单编码，字节或类似文件的对象在主体中发送[(key,value)]</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">json：可选的，一个json可序列化的python对象，在主体中发送request</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">headers：可选的，用于编写http头信息</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">cookies：可选，用dict或cookieJar对象发送Cookies</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">file：可选，用于多部分编码上传的字典，可以是多元祖，其中是定义给定文件的内容类型的字符串，以及包含问文件添加的额外头文件的类字典对象</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">auth：可选，身份验证元祖，自定义http身份验证</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">timeout：可选，发送等待请求数据的超时时间(float/tuple),设置为元祖即为练级connect和read读取超时，如果设置为None即为永久等待</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">allow_redirects：布尔值，可选，启用或禁用GET,OPTIONS,POST,PUT,PATCH,DELETE,HEAD重定向，默认为true</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">proxies：可选，字典映射协议到代理的URL</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">verify：可选，可以是布尔值，可以指定验证服务器的TLS证书路径，默认为true</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">stream：可选，如果是False，响应内容将立即下载</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">cert：可选，如果是string，则为ssl客户端证书文件路径，如果是元祖则(&apos;cert&apos;,&apos;key&apos;)指定证书和密钥</li>\n\n</ul>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/20 10:04\n# @Author  : Py.qi\n# @File    : req_reqst.py\n# @Software: PyCharm\nfrom requests import request\nheader={\n&apos;User-Agent&apos;:&apos;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.79 Safari/537.36&apos;\n}\nresponse=request(&apos;GET&apos;,&apos;https://api.github.com/events&apos;,headers=header) #定义头信息发送请求返回response对象\nprint(response.url) #返回请求的URL\nprint(response.status_code)  #返回状态码200\nprint(response.encoding)  #返回编码\nprint(response.text)  #返回响应的内容以unicode表示\nprint(response.headers) #返回头信息\nprint(response.cookies) #返回cookies CookieJar\nprint(response.json()) #返回json数据</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">(2)requests.head(url,**kwargs):发送head请求，url:网站URL地址，返回一个response对象</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/20 11:19\n# @Author  : Py.qi\n# @File    : req_head.py\n# @Software: PyCharm\nfrom requests import head\nheader=head(&apos;https://github.com/get&apos;)\nprint(&apos;text:&apos;,header.text) #不会返回内容信息\nprint(&apos;headers:&apos;,header.headers) #返回头信息\nprint(header.cookies.items()) #返回cookies元组列表</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">(3)requests.get(url,params=None,**kwargs):发送GET请求，params:要在查询字符串中发送的字典或字节request，返回一个response对象</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/20 11:29\n# @Author  : Py.qi\n# @File    : req_get.py\n# @Software: PyCharm\nfrom requests import get\nresponse=get(&apos;http://httpbin.org/get&apos;,params={&apos;name&apos;:&apos;py.qi&apos;,&apos;age&apos;:22})#添加参数查询\nprint(response.text) #返回结果包含args参数,headers头信息,URL和IP信息\nprint(response.url) #返回组合的URL(http://httpbin.org/get?name=py.qi&amp;age=22)\nprint(response.json()) #如果返回网页是JSON格式，可以使用json()方法解析返回字典数据</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">抓取网页：</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/20 11:46\n# @Author  : Py.qi\n# @File    : req_zhuaqu.py\n# @Software: PyCharm\nimport requests\nimport re\nurl=&apos;http://www.runoob.com/python3/python3-reg-expressions.html&apos;\nheaders={\n    &apos;User-Agent&apos;:&apos;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.79 Safari/537.36&apos;\n}\nresponse=requests.get(url,headers=headers)\nresponse.encoding=&apos;UTF-8&apos;\n#print(response.encoding)\n#print(response.text)\npattern = re.compile(&apos;id=&quot;content&quot;&gt;.*?&lt;h1&gt;(.*?)&lt;/h1&gt;.*?&lt;p&gt;(.*?)&lt;/p&gt;&lt;p&gt;(.*?)&lt;/p&gt;.*?&lt;p&gt;(.*?)&lt;/p&gt;.*?&lt;p&gt;(.*?)&lt;/p&gt;.*?&lt;p&gt;(.*?)&lt;/p&gt;&apos;,re.S)\ntext = re.search(pattern,response.text)\n\nfor i in text.groups():\n    print(i)\n\n#\nPython3 正则表达式\n正则表达式是一个特殊的字符序列，它能帮助你方便的检查一个字符串是否与某种模式匹配。\nPython 自1.5版本起增加了re 模块，它提供 Perl 风格的正则表达式模式。\nre 模块使 Python 语言拥有全部的正则表达式功能。 \ncompile 函数根据一个模式字符串和可选的标志参数生成一个正则表达式对象。该对象拥有一系列方法用于正则表达式匹配和替换。 \nre 模块也提供了与这些方法功能完全一致的函数，这些函数使用一个模式字符串做为它们的第一个参数。</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">抓取二进制文件：图像，BytesIO创建内存对象存储数据，Image打开图像获得图像对象，也可以用上下问方式将图像直接写入文件，适合音频，视频等文件</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/20 14:10\n# @Author  : Py.qi\n# @File    : req_content.py\n# @Software: PyCharm\nimport requests\nfrom io import BytesIO\nfrom PIL import Image\n\nurl=&apos;http://docs.python-requests.org/en/master/_static/requests-sidebar.png&apos;\nr=requests.get(url)\ni=Image.open(BytesIO(r.content)) #获得一个图像对象\nprint(i.format,i.size,i.mode) #查看图像的来源，像素和像素类型（RGB）\n#print(i.show())  #显示图片\ni.save(&apos;requests_log.png&apos;)  #保存图像数据到文件</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">(4)requests.post(url,data=None,json=None,**kwargs):发送POST请求，data:字典数据也可以是元组列表，将被表单编码，以字节或文件对象在数据主体中发送<br/>json:在json数据中发送正文，返回一个response对象</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/20 14:41\n# @Author  : Py.qi\n# @File    : req_post1.py\n# @Software: PyCharm\nimport requests\ndata={&apos;k1&apos;:&apos;v1&apos;,&apos;k2&apos;:&apos;v2&apos;}\nr = requests.post(&apos;http://httpbin.org/post&apos;,data=data) #以表单数据发送数据\nbody=r.json()  #获得字典格式的返回数据 \nprint(body[&apos;form&apos;])  #窃取表单编码数据</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">上传文件：files参数指定上传文件，上传的文件在主体数据中</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/20 15:23\n# @Author  : Py.qi\n# @File    : req_post_file.py\n# @Software: PyCharm\n\nimport requests\nurl=&apos;http://httpbin.org/post&apos;\nfiles={&apos;file&apos;:open(&apos;network.csv&apos;,&apos;rb&apos;)}\nfiles1={&apos;file&apos;:(&apos;filename.xls&apos;,open(&apos;fileanme.xls&apos;,&apos;rb&apos;),&apos;application/vnd.ms-excel&apos;,{&apos;expires&apos;:&apos;0&apos;})} #设置文件名\nr=requests.post(url,files=files) #指定文件发送请求\nprint(r.json()[&apos;files&apos;])</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">多个文件上传：</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">import requests\n\nurl=&apos;http://httpbin.org/post&apos;\n\nmultple_files=[\n    (&apos;images1&apos;,(&apos;11.jpg&apos;,open(&apos;11.jpg&apos;,&apos;rb&apos;),&apos;image/jpg&apos;)),\n    (&apos;images2&apos;,(&apos;22.jpg&apos;,open(&apos;22.jpg&apos;,&apos;rb&apos;),&apos;image/jpg&apos;)),\n]  #字段代表意思依次为：文件名，文件对象，文件类型\nr=requests.post(url,files=multple_files)\nprint(r.text)</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">在网站中PUT,PATCH,DELETE请求很少使用，不做介绍</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">(5)requests.put(url,data=None,**kwargs):发送PUT请求参数同POST一样，将返回一个response对象</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">(6)requests.patch(url,data=None,**kwargs):发送PATCH请求<br/>(7)requests.delete(url,**kwargs):发送DELETE请求</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><a HREF=\"https://www.cnblogs.com/zhangxinqi/p/9201594.html#_labelTop\" TARGET=\"_blank\" STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);\">回到顶部</a></div><h3 STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;font-family:&quot;PT Serif&quot;;text-align:left;\">4、请求响应</h3>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><strong STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;\">class response.Response</strong> ：该Response对象包含服务器对HTTP请求的响应信息</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">该对象包含的属性和方法：</p>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;margin-top:-1em;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\"><code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">apparent_encodind：</code>由chardet库提供的明显编码。</li>\n\n</ul>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\"><code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">close()：</code>将连接释放回池中，即关闭连接，通常不需要调用</li>\n\n</ul>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\"><code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">content：</code>响应的内容，以字节为单位。</li>\n\n</ul>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\"><code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">cookies</code><em STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-style:italic;\">=None ：</em>服务器发回的Cookies CookieJar。</li>\n\n</ul>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\"><code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">elapsed</code><em STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-style:italic;\">=None ：</em>发送请求和响应到达之间所经过的时间量（作为timedelta）。该属性具体测量发送请求的第一个字节和完成解析报头之间的时间。因此，它不受消费响应内容或<code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">stream</code>关键字参数值的影响。</li>\n\n</ul>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\"><code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">encoding</code><em STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-style:italic;\">=None ：</em>编码以在访问r.text时进行解码。</li>\n\n</ul>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\"><code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">headers</code><em STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-style:italic;\">=None ：</em>不区分大小写的响应头字典。例如，<code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">headers[&apos;content-encoding&apos;]</code>将返回<code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">&apos;Content-Encoding&apos;</code>响应头的值。</li>\n\n</ul>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\"><code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">history</code><em STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-style:italic;\">=None ：</em><code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">Response</code>请求历史记录中的对象列表。任何重定向响应都会在这里结束。该列表从最旧的到最近的请求进行排序。</li>\n\n</ul>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\"><code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">is_permanent_redirect：</code>如果此响应为真，则为重定向的永久版本之一。</li>\n\n</ul>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\"><code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">is_redirect：</code>如果此响应是可以自动处理的格式良好的HTTP重定向，则为真。</li>\n\n</ul>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\"><code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">iter_content</code>（<em STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-style:italic;\">chunk_size = 1</em>，<em STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-style:italic;\">decode_unicode = False&nbsp;</em>）：迭代响应数据。在请求中设置stream = True时，可以避免将内容一次性读入内存以获得较大的响应。块大小是它应该读入内存的字节数；chunk_size必须是int或None类型。stream = True将在数据以任何大小接收到的数据到达时读取数据。如果stream = False，则数据作为单个块返回；如果decode_unicode为True，则内容将使用基于响应的最佳可用编码进行解码。</li>\n\n</ul>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\"><code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">iter_lines(</code><em STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-style:italic;\">chunk_size = 512</em>，<em STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-style:italic;\">decode_unicode = None</em>，<em STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-style:italic;\">delimiter = None )：</em>迭代响应数据，一次一行。在请求中设置stream = True时，可以避免将内容一次性读入内存以获得较大的响应。</li>\n\n</ul>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\"><code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">json</code>（<em STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-style:italic;\">** kwargs&nbsp;</em>）：返回响应的json编码内容</li>\n\n</ul>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\"><code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">links：</code>返回解析的响应头部链接</li>\n\n</ul>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\"><code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">next：</code>返回重定向链中下一个请求的PreparedRequest</li>\n\n</ul>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\"><code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">ok：</code>如果<code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">status_code</code>小于400&nbsp;则返回True，否则返回False</li>\n\n</ul>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\"><code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">reason</code><em STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-style:italic;\">=None：</em>响应HTTP状态的文本原因，例如&ldquo;未找到&rdquo;或&ldquo;确定&rdquo;。</li>\n\n</ul>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\"><code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">request</code><em STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-style:italic;\">=None：</em>一个响应的对象。</li>\n\n</ul>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\"><code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">status_code</code><em STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-style:italic;\">=None：</em>整数响应HTTP状态的代码，例如404或200。</li>\n\n</ul>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\"><code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">text：</code>响应的内容，以unicode表示。&nbsp;</li>\n\n</ul>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\"><code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">url</code><em STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-style:italic;\">=None：</em>响应的最终URL位置</li>\n\n</ul>\n<dl STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\"><dt STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\">发送请求后，会得到响应信息，我们可以使用text和content获取相应的内容，此外还有很多属性和方法来获取其他信息，如状态码，响应头，Cookies等</dt></dl>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/20 15:51\n# @Author  : Py.qi\n# @File    : req_respon.py\n# @Software: PyCharm\n\nimport requests\nheaders={&apos;User-Agent&apos;:&apos;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.79 Safari/537.36&apos;}\nr=requests.get(&apos;http://docs.python-requests.org/en/master/&apos;,headers=headers)\nprint(&apos;chardet提供的编码:&apos;,r.apparent_encoding)\nprint(&apos;响应字节内容:&apos;,r.content)\nprint(&apos;响应cookies:&apos;,r.cookies.items())\nprint(&apos;请求到响应之间的时间:&apos;,r.elapsed)\nprint(&apos;响应编码:&apos;,r.encoding)\nprint(&apos;响应头信息:&apos;,r.headers)\nprint(&apos;头信息中的server:&apos;,r.headers[&apos;Server&apos;])\nprint(&apos;请求历史记录:&apos;,r.history)\nprint(&apos;迭代响应数据:&apos;,r.iter_lines())\n#print(&apos;响应json编码数据:&apos;,r.json())\nprint(&apos;返回解析的响应头链接:&apos;,r.links)\nprint(&apos;返回状态码:&apos;,r.status_code)\nprint(&apos;响应str内容:&apos;,r.text)\nprint(&apos;响应URL:&apos;,r.url)\nprint(&apos;返回发送的头参数:&apos;,r.request.headers)\n\n#\nchardet提供的编码: Windows-1254\n响应字节内容: b&apos;\\n&lt;!DOCTYPE html PUBLIC...\n响应cookies: []\n请求到响应之间的时间: 0:00:00.844991\n响应编码: ISO-8859-1\n响应头信息: {&apos;Server&apos;: &apos;nginx/1.10.3 (Ubuntu)&apos;, &apos;Date&apos;: &apos;Wed, 20 Jun 2018 08:10:26 GMT&apos;, &apos;Content-Type&apos;: &apos;text/html&apos;, &apos;Last-Modified&apos;: &apos;Thu, 14 Jun 2018 13:27:43 GMT&apos;, &apos;Transfer-Encoding&apos;: &apos;chunked&apos;, &apos;Connection&apos;: &apos;keep-alive&apos;, &apos;Vary&apos;: &apos;Accept-Encoding&apos;, &apos;ETag&apos;: &apos;W/&quot;5b226d4f-8438&quot;&apos;, &apos;X-Cname-TryFiles&apos;: &apos;True&apos;, &apos;X-Served&apos;: &apos;Nginx&apos;, &apos;X-Deity&apos;: &apos;web05&apos;, &apos;Content-Encoding&apos;: &apos;gzip&apos;}\n头信息中的server: nginx/1.10.3 (Ubuntu)\n请求历史记录: []\n迭代响应数据: &lt;generator object Response.iter_lines at 0x0000005A4A6F3888&gt;\n返回解析的响应头链接: {}\n返回状态码: 200\n响应str内容: &lt;!DOCTYPE html PUBLIC.....\n响应URL: http://docs.python-requests.org/en/master/\n返回发送的头参数: {&apos;User-Agent&apos;: &apos;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.79 Safari/537.36&apos;, &apos;Accept-Encoding&apos;: &apos;gzip, deflate&apos;, &apos;Accept&apos;: &apos;*/*&apos;, &apos;Connection&apos;: &apos;keep-alive&apos;}</pre>\n</div>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><a HREF=\"https://www.cnblogs.com/zhangxinqi/p/9201594.html#_labelTop\" TARGET=\"_blank\" STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);\">回到顶部</a></div><h3 STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;font-family:&quot;PT Serif&quot;;text-align:left;\">5、requests异常处理</h3>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">exception requests.RequestException(*args, **kwargs)：发送一个模糊的异常<br/>exception requests.ConnectionError(*args, **kwargs)：发生连接错误时的异常<br/>exception requests.HTTPError(*args, **kwargs)：发生HTTP错误时的异常<br/>exception requests.URLRequired(*args, **kwargs)：URL错误时的异常<br/>exception requests.TooManyRedirects(*args, **kwargs)：太多的重定向<br/>exception requests.ConnectTimeout(*args, **kwargs)：连接服务器是请求超时<br/>exception requests.ReadTimeout(*args, **kwargs)：服务器没有在指定的时间内发送数据<br/>exception requests.Timeout(*args, **kwargs)：请求超时</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><a HREF=\"https://www.cnblogs.com/zhangxinqi/p/9201594.html#_labelTop\" TARGET=\"_blank\" STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);\">回到顶部</a></div><h3 STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;font-family:&quot;PT Serif&quot;;text-align:left;\">6、cookies</h3>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">cookies包括下面四个类：</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">requests.utils.dict_from_cookiejar(cj)：从CookieJar中返回一个键/值字典,cj为CookieJar对象，返回字典<br/>requests.utils.add_dict_to_cookiejar(cj, cookie_dict)：从键/值字典中返回CookieJar，cj指定CookieJar类型，cookie_dict，字典类型的JAR值，返回CookieJar<br/>requests.cookies.cookiejar_from_dict(cookie_dict, cookiejar=None, overwrite=True)：从键/值字典中返回CookieJar<br/>class requests.cookies.RequestsCookieJar(policy=None)：创建CookieJar，应用请求和未指定的请求和会话</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">cookieJar对象方法与属性：</p>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;margin-top:-1em;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">add_cookie_header(request)：添加正确的Cookie到请求头</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">clear(domain=None,path=None,name=None)：清除cookies</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">clear_expired_cookies()：丢弃所有过期的cookies。</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">clear_session_cookies()：丢弃所有会话cookie。</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">copy()：返回这个RequestsCookieJar的副本。</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">extract_cookies(response,request)：根据请求提取允许的响应中的cookie。</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">get(name,default = None,domain = None,path = None)：类似于字典的get()，它还支持可选的域和路径参数，以解决在多个域中使用一个cookie jar造成的命名冲突。</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">get_dict(domain=None,path=None)：以可选域和路径作为参数，并返回符合要求的名称 - 值对Cookie的普通旧Python字典。</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">items()：类似Dict的项目()从jar中返回名称值元组的列表。</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">iteritems()：类似于dict的iteritems()从jar中返回名称值元组的迭代器。</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">iterkeys()：返回jar中cookie的名字的迭代器。</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">itervalues()：返回jar中cookie值的迭代器。</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">keys()：返回jar中的cookies的名字列表。</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">list_domains()：实用程序方法列出jar中的所有域。</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">list_paths()：实用程序方法列出jar中的所有路径。</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">make_cookies(response,request)：从响应对象中提取的Cookie对象的返回序列。</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">multiple_domains()：如果jar中有多个域，则返回True。否则返回False。</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">pop(k[,d]) ：移除指定的键并返回相应的值。</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">popitem() ：移除并返回（键，值）对</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">set(name,value)：还支持可选的域和路径参数，以解决在多个域中使用一个cookie jar造成的命名冲突。</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">set_cookie(cookie，* args，** kwargs)：设置一个cookie，不检查是否应该设置。</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">set_cookie_if_ok(cookie,request)：判断设置cookies是否可行，返回OK</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">update(other)：用另一个CookieJar或类似字典的cookie更新这个jar</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">values()：返回jar中cookie的值列表。</li>\n\n</ul>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">&nbsp;获取网站cookies：</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">import requests\nr=requests.get(&apos;https://www.baidu.com&apos;)\nprint(r.cookies)\nprint(r.cookies.items())\n\n\n#\n&lt;RequestsCookieJar[&lt;Cookie BDORZ=27315 for .baidu.com/&gt;]&gt;   #RequestsCookieJar对象</pre>\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\"> [(&apos;BDORZ&apos;, &apos;27315&apos;)]</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">使用cookies维持登陆状态：</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">import requests\nheaders={\n    &apos;Cookie&apos;:&apos;www51cto=F7A5DB397E1897B2B12EEC15A74FB351kYaA; Cto_lvt_=1503809599; ......#登陆网站后将cookie信息拷贝到此处\n    &apos;User-Agent&apos;:&apos;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36&apos;\n}\nr=requests.get(&apos;http://blog.51cto.com/zhangxinqi&apos;,headers=headers)\nprint(r.text)\nprint(r.cookies.items())\n\n#显示结果是登陆后的信息，表明登陆成功\n&lt;!DOCTYPE html&gt;\n&lt;html lang=&quot;zh-CN&quot;&gt;\n&lt;head&gt;\n    &lt;meta charset=&quot;UTF-8&quot;&gt;\n    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;\n    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;\n    &lt;link type=&quot;favicon&quot; rel=&quot;shortcut icon&quot; href=&quot;/favicon.ico&quot; /&gt;\n        &lt;title&gt;80后小菜鸟-51CTO博客&lt;/title&gt;\n    &lt;meta name=&quot;keywords&quot; content=&quot;80后小菜鸟,linux技术,windows技术,网络技术,zabbix监控,数据库,虚拟化,自动化运维,系统安全,集群架构,python,企业应用,51CTO博客&quot;&gt;\n\n[(&apos;_identity&apos;, &apos;574c0a6fbf29ac6f44f66068e5f02b0b438aed6840bf......&apos;)]</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">创建RequestsCookieJar对象，使用cookies保持登陆：</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">import requests\nfrom requests.cookies import RequestsCookieJar\n\ncookie=&apos;www51cto=F7A5DB397E1897B2B12EEC15A74FB351kYaA; ......&apos;\nheaders = {    &apos;User-Agent&apos;:&apos;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36&apos;\n}\n\njar=RequestsCookieJar()  #创建Jar对象\nfor i in cookie.split(&apos;;&apos;):\n    key,value = i.split(&apos;=&apos;,1)\n    jar.set(key,value)  #设置cookies的键值\n#print(jar.items())\nr=requests.get(&apos;http://blog.51cto.com/zhangxinqi&apos;,cookies=jar,headers=headers) #传入cookies\n#print(r.text)\nprint(r.headers[&apos;Set-Cookie&apos;])  \nprint(r.request.headers[&apos;Cookie&apos;]) #获取客户端设置的cookie</pre>\n</div>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><a HREF=\"https://www.cnblogs.com/zhangxinqi/p/9201594.html#_labelTop\" TARGET=\"_blank\" STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);\">回到顶部</a></div><h3 STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;font-family:&quot;PT Serif&quot;;text-align:left;\">7、请求会话(Session)</h3>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">在requests中，如果直接利用get()和post()方法的确可以做到模拟网页的请求，但这实际上是相当于不同的会话，也就是说相当于使用了两个浏览器打开ileal不同的页面</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">如果利用psot()请求登陆了网站，然后使用get()方法请求个人信息，将得到两个完全不同的会话，就不能获取到个人信息，实际上可以使用设置cookies一样请求会话得到个人信息，</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">单方法显得很繁琐，可用使用更简单的方法，Session维持会话，利用它不需要设置cookies，它能帮助我们自动处理，下面先看下Session对象的API</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><strong STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;\">class requests.Session</strong>:请求会话，提供cookie持久性，连接池和配置</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">方法与属性：</p>\n<ul STYLE=\"margin:0px 0px 1.5em 1.5em;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none outside none;margin-top:-1em;list-style-type:none;\">\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">auth=None 身份验证元祖</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">cert=None SSL客户端证书路径，如果为元祖(&apos;cert&apos;,&apos;key&apos;)</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">close() 关闭会话</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">cookies=None 会话中设置的未处理的cookie的cookieJar，默认是一个RequestsCookieJar</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">delete(url,**kwargs) 发送DELETE请求,返回一个response对象</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">get(url) 发送GET请求，返回response对象</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">get_adapter(url) 为给定的URL返回适当的连接适配器</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">get_redirect_target(resp) 返回重定向URL或None</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">head(url) 发送head请求，返回response对象</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">headers=None 一个不区分大小写的字典，由字典发送Session</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">hooks=None 事件处理</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">max_redirects=None 允许最大重定向次数默认为30</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">merge_environment_settings(url,proxies,stream,verify,cert) 检查环境并将参数设置合并，返回字典</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">params=None 设置传递的参数</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">post(url,data=None,json=None) 发送POST请求返回response对象</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">prepare_request(request) 构造一个PreparedRequest并返回它，将生成一个请求的数据结构，通过Session发送</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">proxies=None 代理URL</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">request(method,url,params=None,data=None,headers=None,cookies=None,files=None,auth=None,timeout=None,allow_redirects=True,proxies=None,hooks=None,stream=None,verify=None,cert=None,json=None) 构建一个request,返回response对象</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">send(request) 发送给定的PreparedRequest，返回Response对象</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">stream=None 流响应的内容</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">trust_env=None 代理设置的身份验证和信任环境设置</li>\n<li STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style-type:inherit;list-style-position:outside;\">verify=None SSL验证,设置为false则忽略SSL验证</li>\n</ul>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">测试能否获取自己设置的cookies：</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">import requests\n#使用测试网站设置cookies的名称为number值为123456\nrequests.get(&apos;http://httpbin.org/cookies/set/number/123456&apos;)\nr=requests.get(&apos;http://httpbin.org/cookies&apos;)\nprint(r.text) #然后通过请求获取cookies，结果cookies显示为空\n\n#\n{&quot;cookies&quot;:{}}</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">然而并不能获取到设置的cookies，说明它们使用不同的浏览器访问了页面，即得到的cookies会不一样</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">现在我们使用Seesion会话保持来设置请求看有什么变化</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">import requests\n\ns=requests.Session()  #创建session对象\ns.get(&apos;http://httpbin.org/cookies/set/number/123456&apos;)\nr=s.get(&apos;http://httpbin.org/cookies&apos;) #通过session获取请求的cookies\nprint(r.text)  \n\n#成功返回cookies信息\n{&quot;cookies&quot;:{&quot;number&quot;:&quot;123456&quot;}}</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">利用session可以 做到模拟同一个会话而不用担心cookies的问题，它常用于模拟登陆成功后再进行下一步操作，可以模拟在同一个浏览器中打开同一个站点的不同页面</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">实例：通过session会话登陆页面获取个人信息</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/21 9:12\n# @Author  : Py.qi\n# @File    : req_session.py\n# @Software: PyCharm\nimport requests\nfrom requests.auth import HTTPBasicAuth\n\n\nurl=&apos;http://192.168.146.140/admin/&apos;\ns=requests.Session()\nresponse=s.get(url,auth=HTTPBasicAuth(&apos;admin&apos;,&apos;123&apos;))\nprint(response.text)\nprint(response.headers)\nprint(response.status_code)</pre>\n</div>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><a HREF=\"https://www.cnblogs.com/zhangxinqi/p/9201594.html#_labelTop\" TARGET=\"_blank\" STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);\">回到顶部</a></div><h3 STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;font-family:&quot;PT Serif&quot;;text-align:left;\">8、SSL证书验证</h3>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">rerquests提供了证书验证的功能，当发送http请求时，它会检查SSL证书，可以通过verify参数来控制是否检查此证书，如果不设置默认为True会自动验证,我们使用https://www.12306.cn测试</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">import requests\n\nr=requests.get(&apos;https://www.12306.cn&apos;)\nprint(r.status_code)\n\n#返回SSLError\nraise SSLError(e, request=request)</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">将verify参数设置为false在看结果：</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">import requests\nr=requests.get(&apos;https://www.12306.cn&apos;,verify=False)\nprint(r.status_code)\n\n#能正常返回200，但有个警告信息\nD:\\virtualenv-36\\.venv\\lib\\site-packages\\urllib3\\connectionpool.py:857: InsecureRequestWarning: Unverified HTTPS request is being made. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings\n  InsecureRequestWarning)\n200</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">可以使用urllib3中的disable_warnings()忽略警告，也可以用logging日子模块将警告写入日志</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">import requests\nimport logging\nimport urllib3\nurllib3.disable_warnings()  #忽略警告\n#logging.captureWarnings(True)  #也可以写入日志中\nr=requests.get(&apos;https://www.12306.cn&apos;,verify=False)\nprint(r.status_code)\n\n#\n200</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">除了以上的方法，我们如果有证书的话，可以cert参数指定证书路径，如果是单个文件包含密钥和证书，也可以设置两个文件路径的元祖分别指向证书和密钥</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">import requests\n \nresponse = requests.get(&apos;https://www.12306.cn&apos;, cert=(&apos;/path/server.crt&apos;, &apos;/path/key&apos;))\nprint(response.status_code)\n\n#注意，如果是本地私有证书的key必须是解密状态，加密状态的key是不支持的</pre>\n</div>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><a HREF=\"https://www.cnblogs.com/zhangxinqi/p/9201594.html#_labelTop\" TARGET=\"_blank\" STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);\">回到顶部</a></div><h3 STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;font-family:&quot;PT Serif&quot;;text-align:left;\">9、代理设置</h3>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">对于某些网站，在测试的时候请求几次，能正常获取内容。但是一旦开始大规模爬取，对于大规模且频繁的请求，网站可能会弹出验证码，或者跳转到登录认证页面，更甚者可能会直接封禁客户端的IP，导致一定时间段内无法访问。</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">那么，为了防止这种情况发生，我们需要设置代理来解决这个问题，这就需要用到<code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">proxies</code>参数</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">import requests\n \nproxies = {\n  &quot;http&quot;: &quot;http://10.10.1.10:3128&quot;,\n  &quot;https&quot;: &quot;http://10.10.1.10:1080&quot;,\n}\n \nrequests.get(&quot;https://www.taobao.com&quot;, proxies=proxies)</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">若代理需要使用HTTP Basic Auth，可以使用类似http://user:password@host:port这样的语法来设置代理</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">import requests\n \nproxies = {\n    &quot;http&quot;: &quot;http://user:password@10.10.1.10:3128/&quot;,\n}\nrequests.get(&quot;https://www.taobao.com&quot;, proxies=proxies)</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">除了基本的HTTP代理外，requests还支持SOCKS协议的代理</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">这是一个可选功能，需要在使用前安装额外的第三方库</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">您可以从以下位置获取此功能的依赖关系</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">$ pip install requests[socks]</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">一旦你安装了这些依赖项，使用SOCKS代理就像使用HTTP代理一样简单:</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">import requests\n \nproxies = {\n    &apos;http&apos;: &apos;socks5://user:password@host:port&apos;,\n    &apos;https&apos;: &apos;socks5://user:password@host:port&apos;\n}\nrequests.get(&quot;https://www.taobao.com&quot;, proxies=proxies)</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">使用该方案<code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">socks5</code>会导致DNS解析发生在客户端上，而不是在代理服务器上,它使用该方案来决定是否在客户端或代理上执行DNS解析。如果要解析代理服务器上的域，请使用<code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">socks5h</code>该方案。</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><a HREF=\"https://www.cnblogs.com/zhangxinqi/p/9201594.html#_labelTop\" TARGET=\"_blank\" STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);\">回到顶部</a></div><h3 STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;font-family:&quot;PT Serif&quot;;text-align:left;\">10、身份认证</h3>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">如果访问的网站需要身份认证的话，可以使用requests自带的身份认证功能，其中包括四个类：</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">class requests.auth.AuthBase：所有auth实现派生自的基类</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">class requests.auth.HTTPBasicAuth(username, password)：将HTTP基本认证附加到给定的请求对象</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">class requests.auth.HTTPProxyAuth(username, password)：将HTTP代理身份验证附加到给定的请求对象</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">class requests.auth.HTTPDigestAuth(username, password)：将HTTP摘要式身份验证附加到给定的请求对象</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">&nbsp;基本认证：</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">import requests\nfrom requests.auth import HTTPBasicAuth\n\n\nurl=&apos;http://192.168.146.140/admin/&apos;\ns=requests.Session()\nauth=HTTPBasicAuth(&apos;admin&apos;,&apos;123&apos;)  #创建密码认证对象\nresponse=s.get(url,auth=auth)  #附加认证信息\nprint(response.text)</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">代理身份验证：</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/21 10:36\n# @Author  : Py.qi\n# @File    : req_proxauth.py\n# @Software: PyCharm\nimport requests\nfrom requests.auth import HTTPProxyAuth\n\nproauth=HTTPProxyAuth(username=&apos;admin&apos;,password=&apos;123&apos;)\nproxies={\n    &apos;http&apos;:&apos;10.0.0.10:3324&apos;\n}\ns=requests.Session()  #创建session对象\ns.trust_env=proauth   #添加代理身份验证\ns.proxies=proxies   #添加代理URL\nresponse=s.get(&apos;https://www.facebook.com&apos;)\nprint(response.text)</pre>\n</div>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><a HREF=\"https://www.cnblogs.com/zhangxinqi/p/9201594.html#_labelTop\" TARGET=\"_blank\" STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);\">回到顶部</a></div><h3 STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;font-family:&quot;PT Serif&quot;;text-align:left;\">11、编码</h3>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">当您收到响应时，请求会在您访问<code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">Response.text</code>属性时猜测用于解码响应的编码。请求将首先检查HTTP标头中的编码，如果不存在，将使用chardet通用字符编码检测器，来尝试猜测编码，如果没有明确的字符集是存在于HTTP头<strong STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:bold;\">，</strong>并在<code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">Content-Type</code>&nbsp;头中包含<code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">text</code>。在这种情况下，RFC 2616指定默认字符集必须是<code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">ISO-8859-1</code>。在这种情况下，请求遵循规范。如果你需要不同的编码，你可以手动设置<code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">Response.encoding</code>&nbsp;属性，或者使用原始的<code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">Response.content</code>。</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">requests.utils.get_encodings_from_content(content)：从给定的内容字符串返回编码</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">requests.utils.get_encoding_from_headers(headers)：从给定的HTTP标题字典返回编码,headers头文件字典，返回str</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">requests.utils.get_unicode_from_response(r)：以unicode形式返回请求的内容，r是响应对象，返回str</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/21 11:46\n# @Author  : Py.qi\n# @File    : req_enconding.py\n# @Software: PyCharm\nimport requests\nfrom requests.utils import get_encodings_from_content\nfrom requests.utils import get_encoding_from_headers\nfrom requests.utils import get_unicode_from_response\nr=requests.get(&apos;http://cnblogs.com&apos;)\nprint(get_encodings_from_content(r.text)) #从内容中返回编码\nprint(get_encoding_from_headers(r.headers)) #从头文件中返回编码\nprint(get_unicode_from_response(r))  #unicode返回请求内容\n\n\n#\n[&apos;utf-8&apos;]\nutf-8\n&lt;!DOCTYPE html&gt;\n&lt;html lang=&quot;zh-cn&quot;&gt;\n&lt;head&gt;\n    &lt;meta charset=&quot;utf-8&quot; /&gt;\n    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot; /&gt;\n    &lt;meta name=&quot;referrer&quot; content=&quot;always&quot; /&gt;\n    &lt;title&gt;博客园 - 开发者的网上家园&lt;/title&gt;.............</pre>\n</div>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><a HREF=\"https://www.cnblogs.com/zhangxinqi/p/9201594.html#_labelTop\" TARGET=\"_blank\" STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);\">回到顶部</a></div><h3 STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-weight:normal;font-size:30px;line-height:35px;margin-top:35px;margin-bottom:15px;font-family:&quot;PT Serif&quot;;text-align:left;\">12、其他说明</h3>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">(1)状态码</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">requests.codes 该codes对象定义了从http状态中通过名称映射的数字代码的状态码，可以作为属性或字典访问</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">import requests\n\nprint(requests.codes[&apos;forbidden&apos;])  #403\nprint(requests.codes[&apos;ok&apos;])  #200\nprint(requests.codes[&apos;not_modified&apos;]) #304\nprint(requests.codes[&apos;not_found&apos;])  #404\nprint(requests.codes[&apos;internal_server_error&apos;]) #500</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><a HREF=\"http://docs.python-requests.org/en/master/api/#status-code-lookup\" TARGET=\"_blank\" STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);\">其他状态码查询...</a></p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">(2)超时设置</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">如果服务器没有及时响应，大多数对外部服务器的请求应该附加一个超时值。默认情况下，除非显式设置超时值，否则请求不会超时。如果没有超时，您的代码可能会挂起几分钟或更长时间。</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">一旦你的客户端连接到服务器并发送了HTTP请求，&nbsp;读取超时就是客户端等待服务器发送响应的秒数</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">为超时指定单个值，如下所示：</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">r = requests.get(&apos;https://github.com&apos;, timeout=5)</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">超时值将应用于&nbsp;超时<code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">connect</code>和<code STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;font-family:Inconsolata;\">read</code>超时。如果您想单独设置值，请指定一个元组：</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">r = requests.get(&apos;https://github.com&apos;, timeout=(3.05, 27))</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">如果远程服务器速度非常慢，您可以通过将None作为超时值，让&ldquo;请求&rdquo;永久等待响应：</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">r = requests.get(&apos;https://github.com&apos;, timeout=None)</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">(3)流媒体请求</p>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">可以使用iter_content方法迭代获取数据，或者使用iter_line()，但在构建请求是需要指定stream=True来返回流内容数据</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">\n<pre STYLE=\"width:auto;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;font-size:0.875em;line-height:1.71429em;background-color:rgb(243, 242, 238);font-family:Inconsolata;\">#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/21 12:38\n# @Author  : Py.qi\n# @File    : req_block.py\n# @Software: PyCharm\nimport requests\nimport json\nr=requests.get(&apos;http://httpbin.org/stream/20&apos;,stream=True)\nfor i in r.iter_content(chunk_size=1024,decode_unicode=True):\n    if i:\n        print(json.loads(i.decode()))</pre>\n</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">抓取网页内容实例：</p>\n<div STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\"><img src=\"../_resources/ContractedBlock.gif\"  type=\"image/gif\" hash=\"1c53668bcee393edac0d7b3b3daff1ae\" width=\"11\" height=\"16\" style=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;border-color:rgb(31, 9, 9);\" alt=\"ContractedBlock.gif\" /></en-media>\n\nView Code</div>\n<p STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">更多关于requests使用请查看<a HREF=\"http://docs.python-requests.org/en/master/\" TITLE=\"http://docs.python-requests.org/en/master/\" TARGET=\"_blank\" STYLE=\"margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;text-decoration:none;color:rgb(6, 85, 136);\">官网</a></p>\n<p STYLE=\"margin-bottom:0px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\">&nbsp;-----------------------------------------end</p></div></div></div><div STYLE=\"position:absolute;top:-1000px;left:-1000px;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;margin-bottom:1.5em;\">Measure</div><div STYLE=\"margin-bottom:0px;position:absolute;top:-1000px;left:-1000px;line-height:1;margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;\">Measure</div></div></div></div></div></div></div></div>\n</div>\n</en-note>      ",
      "content_path": null,
      "diff_base_variant_id": null,
      "metadata": {
        "checksum": "67df169fdc7751cac393e280bbfa474da4d4a7a5bb0087b3b54bfc546b0e5b55",
        "path": "backups/2023年6月/IT技术/python3之requests - Py.qi - 博客园.html"
      }
    },
    {
      "id": "acdfdaf6-0f92-41e9-b1a1-b7b8c040bec2",
      "note_id": "f7fd6c85-5723-4f35-a2e1-c74e4f57a836",
      "variant_type": "clean_text",
      "version": 1,
      "created_by": "evernote_ingest:v0",
      "created_at": "2025-11-10T15:43:31.877788Z",
      "content": "---\ntitle: python3之requests - Py.qi - 博客园\nupdated: 2019-01-25 11:58:54Z\ncreated: 2019-01-25 11:58:54Z\nsource: https://www.cnblogs.com/zhangxinqi/p/9201594.html\n---\n\n python3之requests\n\n回到顶部\n1、requests简介\n\nrequests是通过urllib3实现自动发送HTTP/1.1请求，它能轻松的实现cookies，登陆验证，代理设置等操作。\n\nPython内置的urllib模块，用于访问网络资源。但是，它用起来比较麻烦，而且，缺少很多实用的高级功能。\n更好的方案是使用requests。它是一个Python第三方库，处理URL 资源特别方便\n\nrequests实现内容：\n\n保持活力和连接池\n\n支持国际域名和网址\n\n会话与Cookie持久性\n\n浏览器式SSL验证\n\n自动内容解码\n\n基本/摘要式身份验证\n\n自动解压缩\n\nUnicode响应body\n\nHTTP(s)代理支持\n\n多部分文件上传\n\n流媒体下载\n\n连接超时\n\n分块的请求\n\n.netrc 支持\n\n回到顶部\n2、requests的安装\n\n(1)源码安装：\n\ngit clone git: // github.com / requests / requests.git # 克隆公共存储库\n或者下载tarball\ncurl - OL https: // github.com / requests / requests / tarball / master\ncd requests / requests\npip install .\n\n(2)pip安装\n\npip install requests\n\n(3)pipenv安装在虚拟环境下安装\n\npipenv install requests\n\nrequest依赖包关系：\n\nrequests==2.19.1\n  - certifi [required: >=2017.4.17, installed: 2018.4.16]  #CA认证模块\n  - chardet [required: <3.1.0,>=3.0.2, installed: 3.0.4]  #通用字符编码检测器模块\n  - idna [required: <2.8,>=2.5, installed: 2.7]  #国际化域名解析模块\n  - urllib3 [required: <1.24,>=1.21.1, installed: 1.23] #线程安全HTTP库\n\n回到顶部\n3、requests请求\n\n所有请求的功能可通过这7种方法访问，他们都返回response对象的一个实例。\n(1)requests.request(method,url,**kwargs):构造并发送一个request，返回一个response对象\n参数：\n\nmethod：　　request对象的方法(POST)\n\nurl：　　request对象的URL\n\nparams：可选的，要在查询字符串中发送的字典或字节request\n\ndata：可选的，字典或元祖列表以表单编码，字节或类似文件的对象在主体中发送[(key,value)]\n\njson：可选的，一个json可序列化的python对象，在主体中发送request\n\nheaders：可选的，用于编写http头信息\n\ncookies：可选，用dict或cookieJar对象发送Cookies\n\nfile：可选，用于多部分编码上传的字典，可以是多元祖，其中是定义给定文件的内容类型的字符串，以及包含问文件添加的额外头文件的类字典对象\n\nauth：可选，身份验证元祖，自定义http身份验证\n\ntimeout：可选，发送等待请求数据的超时时间(float/tuple),设置为元祖即为练级connect和read读取超时，如果设置为None即为永久等待\n\nallow_redirects：布尔值，可选，启用或禁用GET,OPTIONS,POST,PUT,PATCH,DELETE,HEAD重定向，默认为true\n\nproxies：可选，字典映射协议到代理的URL\n\nverify：可选，可以是布尔值，可以指定验证服务器的TLS证书路径，默认为true\n\nstream：可选，如果是False，响应内容将立即下载\n\ncert：可选，如果是string，则为ssl客户端证书文件路径，如果是元祖则('cert','key')指定证书和密钥\n\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/20 10:04\n# @Author  : Py.qi\n# @File    : req_reqst.py\n# @Software: PyCharm\nfrom requests import request\nheader={\n'User-Agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.79 Safari/537.36'\n}\nresponse=request('GET','https://api.github.com/events',headers=header) #定义头信息发送请求返回response对象\nprint(response.url) #返回请求的URL\nprint(response.status_code)  #返回状态码200\nprint(response.encoding)  #返回编码\nprint(response.text)  #返回响应的内容以unicode表示\nprint(response.headers) #返回头信息\nprint(response.cookies) #返回cookies CookieJar\nprint(response.json()) #返回json数据\n\n(2)requests.head(url,**kwargs):发送head请求，url:网站URL地址，返回一个response对象\n\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/20 11:19\n# @Author  : Py.qi\n# @File    : req_head.py\n# @Software: PyCharm\nfrom requests import head\nheader=head('https://github.com/get')\nprint('text:',header.text) #不会返回内容信息\nprint('headers:',header.headers) #返回头信息\nprint(header.cookies.items()) #返回cookies元组列表\n\n(3)requests.get(url,params=None,**kwargs):发送GET请求，params:要在查询字符串中发送的字典或字节request，返回一个response对象\n\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/20 11:29\n# @Author  : Py.qi\n# @File    : req_get.py\n# @Software: PyCharm\nfrom requests import get\nresponse=get('http://httpbin.org/get',params={'name':'py.qi','age':22})#添加参数查询\nprint(response.text) #返回结果包含args参数,headers头信息,URL和IP信息\nprint(response.url) #返回组合的URL(http://httpbin.org/get?name=py.qi&age=22)\nprint(response.json()) #如果返回网页是JSON格式，可以使用json()方法解析返回字典数据\n\n抓取网页：\n\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/20 11:46\n# @Author  : Py.qi\n# @File    : req_zhuaqu.py\n# @Software: PyCharm\nimport requests\nimport re\nurl='http://www.runoob.com/python3/python3-reg-expressions.html'\nheaders={\n    'User-Agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.79 Safari/537.36'\n}\nresponse=requests.get(url,headers=headers)\nresponse.encoding='UTF-8'\n#print(response.encoding)\n#print(response.text)\npattern = re.compile('id=\"content\">.*?<h1>(.*?)</h1>.*?<p>(.*?)</p><p>(.*?)</p>.*?<p>(.*?)</p>.*?<p>(.*?)</p>.*?<p>(.*?)</p>',re.S)\ntext = re.search(pattern,response.text)\n\nfor i in text.groups():\n    print(i)\n\n#\nPython3 正则表达式\n正则表达式是一个特殊的字符序列，它能帮助你方便的检查一个字符串是否与某种模式匹配。\nPython 自1.5版本起增加了re 模块，它提供 Perl 风格的正则表达式模式。\nre 模块使 Python 语言拥有全部的正则表达式功能。\ncompile 函数根据一个模式字符串和可选的标志参数生成一个正则表达式对象。该对象拥有一系列方法用于正则表达式匹配和替换。\nre 模块也提供了与这些方法功能完全一致的函数，这些函数使用一个模式字符串做为它们的第一个参数。\n\n抓取二进制文件：图像，BytesIO创建内存对象存储数据，Image打开图像获得图像对象，也可以用上下问方式将图像直接写入文件，适合音频，视频等文件\n\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/20 14:10\n# @Author  : Py.qi\n# @File    : req_content.py\n# @Software: PyCharm\nimport requests\nfrom io import BytesIO\nfrom PIL import Image\n\nurl='http://docs.python-requests.org/en/master/_static/requests-sidebar.png'\nr=requests.get(url)\ni=Image.open(BytesIO(r.content)) #获得一个图像对象\nprint(i.format,i.size,i.mode) #查看图像的来源，像素和像素类型（RGB）\n#print(i.show())  #显示图片\ni.save('requests_log.png')  #保存图像数据到文件\n\n(4)requests.post(url,data=None,json=None,**kwargs):发送POST请求，data:字典数据也可以是元组列表，将被表单编码，以字节或文件对象在数据主体中发送\njson:在json数据中发送正文，返回一个response对象\n\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/20 14:41\n# @Author  : Py.qi\n# @File    : req_post1.py\n# @Software: PyCharm\nimport requests\ndata={'k1':'v1','k2':'v2'}\nr = requests.post('http://httpbin.org/post',data=data) #以表单数据发送数据\nbody=r.json()  #获得字典格式的返回数据\nprint(body['form'])  #窃取表单编码数据\n\n上传文件：files参数指定上传文件，上传的文件在主体数据中\n\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/20 15:23\n# @Author  : Py.qi\n# @File    : req_post_file.py\n# @Software: PyCharm\n\nimport requests\nurl='http://httpbin.org/post'\nfiles={'file':open('network.csv','rb')}\nfiles1={'file':('filename.xls',open('fileanme.xls','rb'),'application/vnd.ms-excel',{'expires':'0'})} #设置文件名\nr=requests.post(url,files=files) #指定文件发送请求\nprint(r.json()['files'])\n\n多个文件上传：\n\nimport requests\n\nurl='http://httpbin.org/post'\n\nmultple_files=[\n    ('images1',('11.jpg',open('11.jpg','rb'),'image/jpg')),\n    ('images2',('22.jpg',open('22.jpg','rb'),'image/jpg')),\n]  #字段代表意思依次为：文件名，文件对象，文件类型\nr=requests.post(url,files=multple_files)\nprint(r.text)\n\n在网站中PUT,PATCH,DELETE请求很少使用，不做介绍\n\n(5)requests.put(url,data=None,**kwargs):发送PUT请求参数同POST一样，将返回一个response对象\n\n(6)requests.patch(url,data=None,**kwargs):发送PATCH请求\n(7)requests.delete(url,**kwargs):发送DELETE请求\n\n回到顶部\n4、请求响应\n\nclass response.Response\n ：该Response对象包含服务器对HTTP请求的响应信息\n\n该对象包含的属性和方法：\n\napparent_encodind：\n由chardet库提供的明显编码。\n\nclose()：\n将连接释放回池中，即关闭连接，通常不需要调用\n\ncontent：\n响应的内容，以字节为单位。\n\ncookies\n=None ：\n服务器发回的Cookies CookieJar。\n\nelapsed\n=None ：\n发送请求和响应到达之间所经过的时间量（作为timedelta）。该属性具体测量发送请求的第一个字节和完成解析报头之间的时间。因此，它不受消费响应内容或\nstream\n关键字参数值的影响。\n\nencoding\n=None ：\n编码以在访问r.text时进行解码。\n\nheaders\n=None ：\n不区分大小写的响应头字典。例如，\nheaders['content-encoding']\n将返回\n'Content-Encoding'\n响应头的值。\n\nhistory\n=None ：\nResponse\n请求历史记录中的对象列表。任何重定向响应都会在这里结束。该列表从最旧的到最近的请求进行排序。\n\nis_permanent_redirect：\n如果此响应为真，则为重定向的永久版本之一。\n\nis_redirect：\n如果此响应是可以自动处理的格式良好的HTTP重定向，则为真。\n\niter_content\n（\nchunk_size = 1\n，\ndecode_unicode = False \n）：迭代响应数据。在请求中设置stream = True时，可以避免将内容一次性读入内存以获得较大的响应。块大小是它应该读入内存的字节数；chunk_size必须是int或None类型。stream = True将在数据以任何大小接收到的数据到达时读取数据。如果stream = False，则数据作为单个块返回；如果decode_unicode为True，则内容将使用基于响应的最佳可用编码进行解码。\n\niter_lines(\nchunk_size = 512\n，\ndecode_unicode = None\n，\ndelimiter = None )：\n迭代响应数据，一次一行。在请求中设置stream = True时，可以避免将内容一次性读入内存以获得较大的响应。\n\njson\n（\n** kwargs \n）：返回响应的json编码内容\n\nlinks：\n返回解析的响应头部链接\n\nnext：\n返回重定向链中下一个请求的PreparedRequest\n\nok：\n如果\nstatus_code\n小于400 则返回True，否则返回False\n\nreason\n=None：\n响应HTTP状态的文本原因，例如“未找到”或“确定”。\n\nrequest\n=None：\n一个响应的对象。\n\nstatus_code\n=None：\n整数响应HTTP状态的代码，例如404或200。\n\ntext：\n响应的内容，以unicode表示。 \n\nurl\n=None：\n响应的最终URL位置\n\n发送请求后，会得到响应信息，我们可以使用text和content获取相应的内容，此外还有很多属性和方法来获取其他信息，如状态码，响应头，Cookies等\n\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/20 15:51\n# @Author  : Py.qi\n# @File    : req_respon.py\n# @Software: PyCharm\n\nimport requests\nheaders={'User-Agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.79 Safari/537.36'}\nr=requests.get('http://docs.python-requests.org/en/master/',headers=headers)\nprint('chardet提供的编码:',r.apparent_encoding)\nprint('响应字节内容:',r.content)\nprint('响应cookies:',r.cookies.items())\nprint('请求到响应之间的时间:',r.elapsed)\nprint('响应编码:',r.encoding)\nprint('响应头信息:',r.headers)\nprint('头信息中的server:',r.headers['Server'])\nprint('请求历史记录:',r.history)\nprint('迭代响应数据:',r.iter_lines())\n#print('响应json编码数据:',r.json())\nprint('返回解析的响应头链接:',r.links)\nprint('返回状态码:',r.status_code)\nprint('响应str内容:',r.text)\nprint('响应URL:',r.url)\nprint('返回发送的头参数:',r.request.headers)\n\n#\nchardet提供的编码: Windows-1254\n响应字节内容: b'\\n<!DOCTYPE html PUBLIC...\n响应cookies: []\n请求到响应之间的时间: 0:00:00.844991\n响应编码: ISO-8859-1\n响应头信息: {'Server': 'nginx/1.10.3 (Ubuntu)', 'Date': 'Wed, 20 Jun 2018 08:10:26 GMT', 'Content-Type': 'text/html', 'Last-Modified': 'Thu, 14 Jun 2018 13:27:43 GMT', 'Transfer-Encoding': 'chunked', 'Connection': 'keep-alive', 'Vary': 'Accept-Encoding', 'ETag': 'W/\"5b226d4f-8438\"', 'X-Cname-TryFiles': 'True', 'X-Served': 'Nginx', 'X-Deity': 'web05', 'Content-Encoding': 'gzip'}\n头信息中的server: nginx/1.10.3 (Ubuntu)\n请求历史记录: []\n迭代响应数据: <generator object Response.iter_lines at 0x0000005A4A6F3888>\n返回解析的响应头链接: {}\n返回状态码: 200\n响应str内容: <!DOCTYPE html PUBLIC.....\n响应URL: http://docs.python-requests.org/en/master/\n返回发送的头参数: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.79 Safari/537.36', 'Accept-Encoding': 'gzip, deflate', 'Accept': '*/*', 'Connection': 'keep-alive'}\n\n回到顶部\n5、requests异常处理\n\nexception requests.RequestException(*args, **kwargs)：发送一个模糊的异常\nexception requests.ConnectionError(*args, **kwargs)：发生连接错误时的异常\nexception requests.HTTPError(*args, **kwargs)：发生HTTP错误时的异常\nexception requests.URLRequired(*args, **kwargs)：URL错误时的异常\nexception requests.TooManyRedirects(*args, **kwargs)：太多的重定向\nexception requests.ConnectTimeout(*args, **kwargs)：连接服务器是请求超时\nexception requests.ReadTimeout(*args, **kwargs)：服务器没有在指定的时间内发送数据\nexception requests.Timeout(*args, **kwargs)：请求超时\n\n回到顶部\n6、cookies\n\ncookies包括下面四个类：\n\nrequests.utils.dict_from_cookiejar(cj)：从CookieJar中返回一个键/值字典,cj为CookieJar对象，返回字典\nrequests.utils.add_dict_to_cookiejar(cj, cookie_dict)：从键/值字典中返回CookieJar，cj指定CookieJar类型，cookie_dict，字典类型的JAR值，返回CookieJar\nrequests.cookies.cookiejar_from_dict(cookie_dict, cookiejar=None, overwrite=True)：从键/值字典中返回CookieJar\nclass requests.cookies.RequestsCookieJar(policy=None)：创建CookieJar，应用请求和未指定的请求和会话\n\ncookieJar对象方法与属性：\n\nadd_cookie_header(request)：添加正确的Cookie到请求头\n\nclear(domain=None,path=None,name=None)：清除cookies\n\nclear_expired_cookies()：丢弃所有过期的cookies。\n\nclear_session_cookies()：丢弃所有会话cookie。\n\ncopy()：返回这个RequestsCookieJar的副本。\n\nextract_cookies(response,request)：根据请求提取允许的响应中的cookie。\n\nget(name,default = None,domain = None,path = None)：类似于字典的get()，它还支持可选的域和路径参数，以解决在多个域中使用一个cookie jar造成的命名冲突。\n\nget_dict(domain=None,path=None)：以可选域和路径作为参数，并返回符合要求的名称 - 值对Cookie的普通旧Python字典。\n\nitems()：类似Dict的项目()从jar中返回名称值元组的列表。\n\niteritems()：类似于dict的iteritems()从jar中返回名称值元组的迭代器。\n\niterkeys()：返回jar中cookie的名字的迭代器。\n\nitervalues()：返回jar中cookie值的迭代器。\n\nkeys()：返回jar中的cookies的名字列表。\n\nlist_domains()：实用程序方法列出jar中的所有域。\n\nlist_paths()：实用程序方法列出jar中的所有路径。\n\nmake_cookies(response,request)：从响应对象中提取的Cookie对象的返回序列。\n\nmultiple_domains()：如果jar中有多个域，则返回True。否则返回False。\n\npop(k[,d]) ：移除指定的键并返回相应的值。\n\npopitem() ：移除并返回（键，值）对\n\nset(name,value)：还支持可选的域和路径参数，以解决在多个域中使用一个cookie jar造成的命名冲突。\n\nset_cookie(cookie，* args，** kwargs)：设置一个cookie，不检查是否应该设置。\n\nset_cookie_if_ok(cookie,request)：判断设置cookies是否可行，返回OK\n\nupdate(other)：用另一个CookieJar或类似字典的cookie更新这个jar\n\nvalues()：返回jar中cookie的值列表。\n\n 获取网站cookies：\n\nimport requests\nr=requests.get('https://www.baidu.com')\nprint(r.cookies)\nprint(r.cookies.items())\n\n#\n<RequestsCookieJar[<Cookie BDORZ=27315 for .baidu.com/>]>   #RequestsCookieJar对象\n\n [('BDORZ', '27315')]\n\n使用cookies维持登陆状态：\n\nimport requests\nheaders={\n    'Cookie':'www51cto=F7A5DB397E1897B2B12EEC15A74FB351kYaA; Cto_lvt_=1503809599; ......#登陆网站后将cookie信息拷贝到此处\n    'User-Agent':'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'\n}\nr=requests.get('http://blog.51cto.com/zhangxinqi',headers=headers)\nprint(r.text)\nprint(r.cookies.items())\n\n#显示结果是登陆后的信息，表明登陆成功\n<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <link type=\"favicon\" rel=\"shortcut icon\" href=\"/favicon.ico\" />\n        <title>80后小菜鸟-51CTO博客</title>\n    <meta name=\"keywords\" content=\"80后小菜鸟,linux技术,windows技术,网络技术,zabbix监控,数据库,虚拟化,自动化运维,系统安全,集群架构,python,企业应用,51CTO博客\">\n\n[('_identity', '574c0a6fbf29ac6f44f66068e5f02b0b438aed6840bf......')]\n\n创建RequestsCookieJar对象，使用cookies保持登陆：\n\nimport requests\nfrom requests.cookies import RequestsCookieJar\n\ncookie='www51cto=F7A5DB397E1897B2B12EEC15A74FB351kYaA; ......'\nheaders = {    'User-Agent':'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'\n}\n\njar=RequestsCookieJar()  #创建Jar对象\nfor i in cookie.split(';'):\n    key,value = i.split('=',1)\n    jar.set(key,value)  #设置cookies的键值\n#print(jar.items())\nr=requests.get('http://blog.51cto.com/zhangxinqi',cookies=jar,headers=headers) #传入cookies\n#print(r.text)\nprint(r.headers['Set-Cookie']) \nprint(r.request.headers['Cookie']) #获取客户端设置的cookie\n\n回到顶部\n7、请求会话(Session)\n\n在requests中，如果直接利用get()和post()方法的确可以做到模拟网页的请求，但这实际上是相当于不同的会话，也就是说相当于使用了两个浏览器打开ileal不同的页面\n\n如果利用psot()请求登陆了网站，然后使用get()方法请求个人信息，将得到两个完全不同的会话，就不能获取到个人信息，实际上可以使用设置cookies一样请求会话得到个人信息，\n\n单方法显得很繁琐，可用使用更简单的方法，Session维持会话，利用它不需要设置cookies，它能帮助我们自动处理，下面先看下Session对象的API\n\nclass requests.Session\n:请求会话，提供cookie持久性，连接池和配置\n\n方法与属性：\n\nauth=None 身份验证元祖\n\ncert=None SSL客户端证书路径，如果为元祖('cert','key')\n\nclose() 关闭会话\n\ncookies=None 会话中设置的未处理的cookie的cookieJar，默认是一个RequestsCookieJar\n\ndelete(url,**kwargs) 发送DELETE请求,返回一个response对象\n\nget(url) 发送GET请求，返回response对象\n\nget_adapter(url) 为给定的URL返回适当的连接适配器\n\nget_redirect_target(resp) 返回重定向URL或None\n\nhead(url) 发送head请求，返回response对象\n\nheaders=None 一个不区分大小写的字典，由字典发送Session\n\nhooks=None 事件处理\n\nmax_redirects=None 允许最大重定向次数默认为30\n\nmerge_environment_settings(url,proxies,stream,verify,cert) 检查环境并将参数设置合并，返回字典\n\nparams=None 设置传递的参数\n\npost(url,data=None,json=None) 发送POST请求返回response对象\n\nprepare_request(request) 构造一个PreparedRequest并返回它，将生成一个请求的数据结构，通过Session发送\n\nproxies=None 代理URL\n\nrequest(method,url,params=None,data=None,headers=None,cookies=None,files=None,auth=None,timeout=None,allow_redirects=True,proxies=None,hooks=None,stream=None,verify=None,cert=None,json=None) 构建一个request,返回response对象\n\nsend(request) 发送给定的PreparedRequest，返回Response对象\n\nstream=None 流响应的内容\n\ntrust_env=None 代理设置的身份验证和信任环境设置\n\nverify=None SSL验证,设置为false则忽略SSL验证\n\n测试能否获取自己设置的cookies：\n\nimport requests\n\nrequests.get('http://httpbin.org/cookies/set/number/123456')\nr=requests.get('http://httpbin.org/cookies')\nprint(r.text) #然后通过请求获取cookies，结果cookies显示为空\n\n#\n{\"cookies\":{}}\n\n然而并不能获取到设置的cookies，说明它们使用不同的浏览器访问了页面，即得到的cookies会不一样\n\n现在我们使用Seesion会话保持来设置请求看有什么变化\n\nimport requests\n\ns=requests.Session()  #创建session对象\ns.get('http://httpbin.org/cookies/set/number/123456')\nr=s.get('http://httpbin.org/cookies') #通过session获取请求的cookies\nprint(r.text) \n\n{\"cookies\":{\"number\":\"123456\"}}\n\n利用session可以 做到模拟同一个会话而不用担心cookies的问题，它常用于模拟登陆成功后再进行下一步操作，可以模拟在同一个浏览器中打开同一个站点的不同页面\n\n实例：通过session会话登陆页面获取个人信息\n\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/21 9:12\n# @Author  : Py.qi\n# @File    : req_session.py\n# @Software: PyCharm\nimport requests\nfrom requests.auth import HTTPBasicAuth\n\nurl='http://192.168.146.140/admin/'\ns=requests.Session()\nresponse=s.get(url,auth=HTTPBasicAuth('admin','123'))\nprint(response.text)\nprint(response.headers)\nprint(response.status_code)\n\n回到顶部\n8、SSL证书验证\n\nrerquests提供了证书验证的功能，当发送http请求时，它会检查SSL证书，可以通过verify参数来控制是否检查此证书，如果不设置默认为True会自动验证,我们使用https://www.12306.cn测试\n\nimport requests\n\nr=requests.get('https://www.12306.cn')\nprint(r.status_code)\n\nraise SSLError(e, request=request)\n\n将verify参数设置为false在看结果：\n\nimport requests\nr=requests.get('https://www.12306.cn',verify=False)\nprint(r.status_code)\n\n#能正常返回200，但有个警告信息\nD:\\virtualenv-36\\.venv\\lib\\site-packages\\urllib3\\connectionpool.py:857: InsecureRequestWarning: Unverified HTTPS request is being made. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings\n  InsecureRequestWarning)\n200\n\n可以使用urllib3中的disable_warnings()忽略警告，也可以用logging日子模块将警告写入日志\n\nimport requests\nimport logging\nimport urllib3\nurllib3.disable_warnings()  #忽略警告\n#logging.captureWarnings(True)  #也可以写入日志中\nr=requests.get('https://www.12306.cn',verify=False)\nprint(r.status_code)\n\n#\n200\n\n除了以上的方法，我们如果有证书的话，可以cert参数指定证书路径，如果是单个文件包含密钥和证书，也可以设置两个文件路径的元祖分别指向证书和密钥\n\nimport requests\n\nresponse = requests.get('https://www.12306.cn', cert=('/path/server.crt', '/path/key'))\nprint(response.status_code)\n\n#注意，如果是本地私有证书的key必须是解密状态，加密状态的key是不支持的\n\n回到顶部\n9、代理设置\n\n对于某些网站，在测试的时候请求几次，能正常获取内容。但是一旦开始大规模爬取，对于大规模且频繁的请求，网站可能会弹出验证码，或者跳转到登录认证页面，更甚者可能会直接封禁客户端的IP，导致一定时间段内无法访问。\n\n那么，为了防止这种情况发生，我们需要设置代理来解决这个问题，这就需要用到\nproxies\n参数\n\nimport requests\n\nproxies = {\n  \"http\": \"http://10.10.1.10:3128\",\n  \"https\": \"http://10.10.1.10:1080\",\n}\n\nrequests.get(\"https://www.taobao.com\", proxies=proxies)\n\n若代理需要使用HTTP Basic Auth，可以使用类似http://user:password@host:port这样的语法来设置代理\n\nimport requests\n\nproxies = {\n    \"http\": \"http://user:password@10.10.1.10:3128/\",\n}\nrequests.get(\"https://www.taobao.com\", proxies=proxies)\n\n除了基本的HTTP代理外，requests还支持SOCKS协议的代理\n\n这是一个可选功能，需要在使用前安装额外的第三方库\n\n您可以从以下位置获取此功能的依赖关系\n\n$ pip install requests[socks]\n\n一旦你安装了这些依赖项，使用SOCKS代理就像使用HTTP代理一样简单:\n\nimport requests\n\nproxies = {\n    'http': 'socks5://user:password@host:port',\n    'https': 'socks5://user:password@host:port'\n}\nrequests.get(\"https://www.taobao.com\", proxies=proxies)\n\n使用该方案\nsocks5\n会导致DNS解析发生在客户端上，而不是在代理服务器上,它使用该方案来决定是否在客户端或代理上执行DNS解析。如果要解析代理服务器上的域，请使用\nsocks5h\n该方案。\n\n回到顶部\n10、身份认证\n\n如果访问的网站需要身份认证的话，可以使用requests自带的身份认证功能，其中包括四个类：\n\nclass requests.auth.AuthBase：所有auth实现派生自的基类\n\nclass requests.auth.HTTPBasicAuth(username, password)：将HTTP基本认证附加到给定的请求对象\n\nclass requests.auth.HTTPProxyAuth(username, password)：将HTTP代理身份验证附加到给定的请求对象\n\nclass requests.auth.HTTPDigestAuth(username, password)：将HTTP摘要式身份验证附加到给定的请求对象\n\n 基本认证：\n\nimport requests\nfrom requests.auth import HTTPBasicAuth\n\nurl='http://192.168.146.140/admin/'\ns=requests.Session()\nauth=HTTPBasicAuth('admin','123')  #创建密码认证对象\nresponse=s.get(url,auth=auth)  #附加认证信息\nprint(response.text)\n\n代理身份验证：\n\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/21 10:36\n# @Author  : Py.qi\n# @File    : req_proxauth.py\n# @Software: PyCharm\nimport requests\nfrom requests.auth import HTTPProxyAuth\n\nproauth=HTTPProxyAuth(username='admin',password='123')\nproxies={\n    'http':'10.0.0.10:3324'\n}\ns=requests.Session()  #创建session对象\ns.trust_env=proauth   #添加代理身份验证\ns.proxies=proxies   #添加代理URL\nresponse=s.get('https://www.facebook.com')\nprint(response.text)\n\n回到顶部\n11、编码\n\n当您收到响应时，请求会在您访问\nResponse.text\n属性时猜测用于解码响应的编码。请求将首先检查HTTP标头中的编码，如果不存在，将使用chardet通用字符编码检测器，来尝试猜测编码，如果没有明确的字符集是存在于HTTP头\n，\n并在\nContent-Type\n 头中包含\ntext\n。在这种情况下，RFC 2616指定默认字符集必须是\nISO-8859-1\n。在这种情况下，请求遵循规范。如果你需要不同的编码，你可以手动设置\nResponse.encoding\n 属性，或者使用原始的\nResponse.content\n。\n\nrequests.utils.get_encodings_from_content(content)：从给定的内容字符串返回编码\n\nrequests.utils.get_encoding_from_headers(headers)：从给定的HTTP标题字典返回编码,headers头文件字典，返回str\n\nrequests.utils.get_unicode_from_response(r)：以unicode形式返回请求的内容，r是响应对象，返回str\n\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/21 11:46\n# @Author  : Py.qi\n# @File    : req_enconding.py\n# @Software: PyCharm\nimport requests\nfrom requests.utils import get_encodings_from_content\nfrom requests.utils import get_encoding_from_headers\nfrom requests.utils import get_unicode_from_response\nr=requests.get('http://cnblogs.com')\nprint(get_encodings_from_content(r.text)) #从内容中返回编码\nprint(get_encoding_from_headers(r.headers)) #从头文件中返回编码\nprint(get_unicode_from_response(r))  #unicode返回请求内容\n\n#\n['utf-8']\nutf-8\n<!DOCTYPE html>\n<html lang=\"zh-cn\">\n<head>\n    <meta charset=\"utf-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n    <meta name=\"referrer\" content=\"always\" />\n    <title>博客园 - 开发者的网上家园</title>.............\n\n回到顶部\n12、其他说明\n\n(1)状态码\n\nrequests.codes 该codes对象定义了从http状态中通过名称映射的数字代码的状态码，可以作为属性或字典访问\n\nimport requests\n\nprint(requests.codes['forbidden'])  #403\nprint(requests.codes['ok'])  #200\nprint(requests.codes['not_modified']) #304\nprint(requests.codes['not_found'])  #404\nprint(requests.codes['internal_server_error']) #500\n\n其他状态码查询...\n\n(2)超时设置\n\n如果服务器没有及时响应，大多数对外部服务器的请求应该附加一个超时值。默认情况下，除非显式设置超时值，否则请求不会超时。如果没有超时，您的代码可能会挂起几分钟或更长时间。\n\n一旦你的客户端连接到服务器并发送了HTTP请求， 读取超时就是客户端等待服务器发送响应的秒数\n\n为超时指定单个值，如下所示：\n\nr = requests.get('https://github.com', timeout=5)\n\n超时值将应用于 超时\nconnect\n和\nread\n超时。如果您想单独设置值，请指定一个元组：\n\nr = requests.get('https://github.com', timeout=(3.05, 27))\n\n如果远程服务器速度非常慢，您可以通过将None作为超时值，让“请求”永久等待响应：\n\nr = requests.get('https://github.com', timeout=None)\n\n(3)流媒体请求\n\n可以使用iter_content方法迭代获取数据，或者使用iter_line()，但在构建请求是需要指定stream=True来返回流内容数据\n\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time    : 2018/6/21 12:38\n# @Author  : Py.qi\n# @File    : req_block.py\n# @Software: PyCharm\nimport requests\nimport json\nr=requests.get('http://httpbin.org/stream/20',stream=True)\nfor i in r.iter_content(chunk_size=1024,decode_unicode=True):\n    if i:\n        print(json.loads(i.decode()))\n\n抓取网页内容实例：\n\nView Code\n\n更多关于requests使用请查看\n官网\n\n -----------------------------------------end\nMeasure",
      "content_path": null,
      "diff_base_variant_id": null,
      "metadata": {
        "language": "en",
        "length": 21472,
        "rule_count": 3,
        "applied_rules": [
          {
            "rule_id": "social_handles",
            "description": "Drop standalone social handles and hashtags",
            "note": "removed social handle only lines"
          },
          {
            "rule_id": "dedupe_lines",
            "description": "Collapse adjacent duplicate lines",
            "note": "collapsed duplicate adjacent lines"
          },
          {
            "rule_id": "whitespace",
            "description": "Normalize whitespace",
            "note": "collapsed whitespace"
          }
        ]
      }
    }
  ],
  "extractions": [],
  "journal": {
    "id": "a9f4df34-62d5-47a8-9971-be90bec1f7f7",
    "note_id": "f7fd6c85-5723-4f35-a2e1-c74e4f57a836",
    "stage": "ingest",
    "agent_id": "evernote_ingest:v0",
    "started_at": "2025-11-10T15:43:31.877793Z",
    "finished_at": "2025-11-10T15:43:31.877794Z",
    "status": "success",
    "input_ref": {
      "task_id": "bc7a1cff-8a9e-4a1d-b116-e3869534da9a",
      "source_path": "backups/2023年6月/IT技术/python3之requests - Py.qi - 博客园.html",
      "checksum": "67df169fdc7751cac393e280bbfa474da4d4a7a5bb0087b3b54bfc546b0e5b55"
    },
    "output_ref": {
      "ingest_source": "1930c68c-9f3d-4d33-9f1e-5ac955e49812",
      "note": "f7fd6c85-5723-4f35-a2e1-c74e4f57a836",
      "variants": [
        "16eea4cd-a369-4cde-95f8-f5ff43133521",
        "acdfdaf6-0f92-41e9-b1a1-b7b8c040bec2"
      ]
    },
    "error_detail": null
  }
}