{
  "ingest_source": {
    "id": "b89c8484-de58-4264-a226-54ac69d4fec8",
    "source_type": "evernote_html",
    "source_path": "backups/2023年6月/IT技术/优化表空间.html",
    "collected_at": "2025-11-10T15:43:32.185376Z",
    "external_id": null,
    "title_hint": null,
    "language_hint": "no",
    "captured_at": null,
    "checksum": "5b29d7363c0573eb7f27239b75ef2dbe90fcd02b115d4168fa759b217f53c874",
    "status": "pending",
    "notes": {
      "batch_id": "phase2-backfill-202306"
    }
  },
  "note": {
    "id": "2f15ac2e-0f0c-4ebe-b92d-04da6d6a41d9",
    "ingest_source_id": "b89c8484-de58-4264-a226-54ac69d4fec8",
    "canonical_title": "优化表空间",
    "language": "no",
    "ingested_at": "2025-11-10T15:43:32.185381Z",
    "created_at": null,
    "status": "active",
    "importance": 0,
    "attributes": {
      "source_filename": "优化表空间.html"
    }
  },
  "variants": [
    {
      "id": "08efc549-b91f-4968-aa34-8f9aa1d82803",
      "note_id": "2f15ac2e-0f0c-4ebe-b92d-04da6d6a41d9",
      "variant_type": "raw_html",
      "version": 1,
      "created_by": "evernote_ingest:v0",
      "created_at": "2025-11-10T15:43:32.185384Z",
      "content": "---\ntitle: 优化表空间\nupdated: 2022-09-03 20:11:04Z\ncreated: 2022-09-03 20:08:56Z\n---\n\n\n<en-note><div>一、删除表|清空数据表</div><div>当执行删除数据表或者清空数据表的全部数据操作时，都会释放掉相应的磁盘存储空间。</div><div><br/></div><div>drop table table_name;</div><div>truncate table table_name;</div><div>在MyISAM和InnoDB(innodb_file_per_table)存储引擎中，数据信息存在在单个文件中。删除表操作和清空数据表操作都会释放空间。</div><div><br/></div><div>二、删除表数据</div><div>delete from table_name [where xxx];</div><div>使用delete删除的时候，MySQL并没有把数据文件删除，而是将数据文件的标识位删除，没有整理文件，因此不会彻底释放空间。被删除的数据将会被保存在一个链接清单中，当有新数据写入的时候，MySQL会利用这些已删除的空间再写入。即，删除操作会带来一些数据碎片，正是这些碎片在占用硬盘空间。</div><div><br/></div><div>三、优化表空间</div><div>方法一：</div><div><br/></div><div>optimize table table_name ;</div><div>当表数据被大量删除后，释放占用的空间就变得很有必要了。会明显的提高查询速度。使用 optimize table。被删除的记录被保持在链接清单中，后续的 insert 操作会重新使用旧的记录位置。您可以使用 optimize table 来重新利用未使用的空间，并整理数据文件的碎片。optimize 适用于InnoDB和MyISAM存储引擎。</div><div><br/></div><div>查看表占用硬盘空间大小的SQL语句如下：（默认用M做展示单位）</div><div><br/></div><div>SELECT TABLE_NAME, (DATA_LENGTH+INDEX_LENGTH)/1048576 as size_Mb, TABLE_ROWS FROM information_schema.tables WHERE TABLE_SCHEMA=&apos;数据库名称&apos; AND TABLE_NAME=&apos;表名&apos;</div><div><br/></div><div><br/></div><div>方法二：</div><div><br/></div><div>alter table tab_name&nbsp; ENGINE = &apos;InnoDB&apos;;</div><div>注意：该操作执行的时候会把该表格先写入一个tmp临时表，所以磁盘剩余空间必须大于表空间，否则会执行失败。</div><div><br/></div><div>方法三：</div><div>先将整个表的结构和数据导出来，删除整个表，再创建表，最后导入数据。生产环境不建议用这个方法。</div></en-note>      ",
      "content_path": null,
      "diff_base_variant_id": null,
      "metadata": {
        "checksum": "5b29d7363c0573eb7f27239b75ef2dbe90fcd02b115d4168fa759b217f53c874",
        "path": "backups/2023年6月/IT技术/优化表空间.html"
      }
    },
    {
      "id": "1afab505-1695-4afb-b953-61b43a69aa09",
      "note_id": "2f15ac2e-0f0c-4ebe-b92d-04da6d6a41d9",
      "variant_type": "clean_text",
      "version": 1,
      "created_by": "evernote_ingest:v0",
      "created_at": "2025-11-10T15:43:32.185387Z",
      "content": "---\ntitle: 优化表空间\nupdated: 2022-09-03 20:11:04Z\ncreated: 2022-09-03 20:08:56Z\n---\n\n一、删除表|清空数据表\n当执行删除数据表或者清空数据表的全部数据操作时，都会释放掉相应的磁盘存储空间。\ndrop table table_name;\ntruncate table table_name;\n在MyISAM和InnoDB(innodb_file_per_table)存储引擎中，数据信息存在在单个文件中。删除表操作和清空数据表操作都会释放空间。\n二、删除表数据\ndelete from table_name [where xxx];\n使用delete删除的时候，MySQL并没有把数据文件删除，而是将数据文件的标识位删除，没有整理文件，因此不会彻底释放空间。被删除的数据将会被保存在一个链接清单中，当有新数据写入的时候，MySQL会利用这些已删除的空间再写入。即，删除操作会带来一些数据碎片，正是这些碎片在占用硬盘空间。\n三、优化表空间\n方法一：\noptimize table table_name ;\n当表数据被大量删除后，释放占用的空间就变得很有必要了。会明显的提高查询速度。使用 optimize table。被删除的记录被保持在链接清单中，后续的 insert 操作会重新使用旧的记录位置。您可以使用 optimize table 来重新利用未使用的空间，并整理数据文件的碎片。optimize 适用于InnoDB和MyISAM存储引擎。\n查看表占用硬盘空间大小的SQL语句如下：（默认用M做展示单位）\nSELECT TABLE_NAME, (DATA_LENGTH+INDEX_LENGTH)/1048576 as size_Mb, TABLE_ROWS FROM information_schema.tables WHERE TABLE_SCHEMA='数据库名称' AND TABLE_NAME='表名'\n方法二：\nalter table tab_name  ENGINE = 'InnoDB';\n注意：该操作执行的时候会把该表格先写入一个tmp临时表，所以磁盘剩余空间必须大于表空间，否则会执行失败。\n方法三：\n先将整个表的结构和数据导出来，删除整个表，再创建表，最后导入数据。生产环境不建议用这个方法。",
      "content_path": null,
      "diff_base_variant_id": null,
      "metadata": {
        "language": "no",
        "length": 999,
        "rule_count": 0,
        "applied_rules": []
      }
    }
  ],
  "extractions": [
    {
      "id": "f764ff8a-86ca-450f-bd7b-a7501962452b",
      "note_id": "2f15ac2e-0f0c-4ebe-b92d-04da6d6a41d9",
      "extractor": "llm_enhance:v0#qwen3:30b",
      "payload": {
        "summary": "使用SQL命令优化数据库表空间，减少碎片，提升查询性能。",
        "keywords": [
          "表空间",
          "优化",
          "数据库",
          "碎片",
          "SQL"
        ],
        "action_items": [
          "无"
        ],
        "source": "qwen3:30b",
        "category_path": [
          "商务",
          "技术创新"
        ],
        "new_category_suggestion": null
      },
      "version": 1,
      "created_at": "2025-11-11T17:21:18.620337Z",
      "created_by": "llm_enhance:v0",
      "quality_score": 0.381
    }
  ],
  "journal": {
    "id": "f821e61b-bbea-4936-9a82-763fc4b15833",
    "note_id": "2f15ac2e-0f0c-4ebe-b92d-04da6d6a41d9",
    "stage": "ingest",
    "agent_id": "evernote_ingest:v0",
    "started_at": "2025-11-10T15:43:32.185393Z",
    "finished_at": "2025-11-10T15:43:32.185393Z",
    "status": "success",
    "input_ref": {
      "task_id": "910c8ab1-b855-435d-99a1-c56721ad5f3f",
      "source_path": "backups/2023年6月/IT技术/优化表空间.html",
      "checksum": "5b29d7363c0573eb7f27239b75ef2dbe90fcd02b115d4168fa759b217f53c874"
    },
    "output_ref": {
      "ingest_source": "b89c8484-de58-4264-a226-54ac69d4fec8",
      "note": "2f15ac2e-0f0c-4ebe-b92d-04da6d6a41d9",
      "variants": [
        "08efc549-b91f-4968-aa34-8f9aa1d82803",
        "1afab505-1695-4afb-b953-61b43a69aa09"
      ]
    },
    "error_detail": null
  },
  "llm": {
    "status": "success",
    "model": "qwen3:30b",
    "updated_at": "2025-11-11T17:21:18.620175Z",
    "latency_seconds": 65.43454270809889,
    "attempts": 1,
    "summary": {
      "summary": "使用SQL命令优化数据库表空间，减少碎片，提升查询性能。",
      "keywords": [
        "表空间",
        "优化",
        "数据库",
        "碎片",
        "SQL"
      ],
      "action_items": [
        "无"
      ],
      "source": "qwen3:30b",
      "category_path": [
        "商务",
        "技术创新"
      ],
      "new_category_suggestion": null
    },
    "quality": {
      "score": 0.381,
      "metrics": {
        "input_chars": 999.0,
        "input_lines": 24.0,
        "summary_chars": 28.0,
        "summary_coverage_ratio": 0.028,
        "keyword_hit_rate": 1.0,
        "action_item_count": 1.0,
        "unique_summary_sentences": 1.0,
        "estimated_read_seconds": 59.9
      }
    }
  }
}