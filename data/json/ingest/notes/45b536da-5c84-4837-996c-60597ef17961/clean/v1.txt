---
title: 自订阅事件
updated: 2013-06-18 05:28:32Z
created: 2013-06-18 05:28:04Z
tags:
  - c#
---

using

System;
using

System.Collections.Generic;
using

System.ComponentModel;
using

System.Data;
using

System.Drawing;
using

System.Linq;
using

System.Text;
using

System.Windows.Forms;
using

System.Data.SqlClient;
namespace

WindowsFormsApplication6
{
   
public

partial

class

Form1

:

Form
    {
       
public

static

readonly

string

SQLconnString =

"Data Source=TANG-LEPTOP\\SQLEXPRESS;Initial Catalog=health;Integrated Security=True"
;
       
public

Form1()
        {
            InitializeComponent();
        }
       
private

void

dataGridView1_RowsAdded(

object

sender,

DataGridViewRowsAddedEventArgs

e)
        {
            label1.Text=e.RowCount.ToString();
            label2.Text=e.RowIndex.ToString();
           
        }
       
private

void

dataGridView1_CellValuePushed(

object

sender,

DataGridViewCellValueEventArgs

e)
        {
            label3.Text = e.RowIndex.ToString();
        }
       
private

void

datagridview_CellValueChanged(

object

ss,

DataGridViewCellEventArgs

e)
        {
           
////wrote by my self
           
try
            {
                label5.Text =

this
.dataGridView1.Rows[e.ColumnIndex].Cells[e.ColumnIndex].Value.ToString();
            }

finally
            {
            }
       
DataGridViewComboBoxColumn

CreateCheckInfoColumn()
        {
           
DataGridViewComboBoxColumn

combo =

new

DataGridViewComboBoxColumn

();
           
SqlCommand

sqlComm = InitDatabase(SQLconnString);
            sqlComm.CommandType =

CommandType
.Text;
            sqlComm.CommandText =

"select checkName from checklist;"
;
           
if

(sqlComm.Connection.State ==

ConnectionState
.Open)
            {
               
SqlDataReader

dr = sqlComm.ExecuteReader();
               
List
<

string
> _buff_list =

new

List
<

string
>();
               
while

(dr.Read())
                {
                    _buff_list.Add((

string
)dr[

"checkName"
]);
                }
                combo.DataSource = _buff_list;
                combo.DataPropertyName =

"check info"
;
                combo.Name =

"checkinfo"
;
                sqlComm.Connection.Close();
            }
           
return

combo;
        }
       
SqlCommand

InitDatabase(

string

ConnString)
        {
           
SqlConnection

sqlConn =

new

SqlConnection

(ConnString);
            sqlConn.Open();
           
SqlCommand

sqlComm = sqlConn.CreateCommand();
           
return

sqlComm;
        }
       
private

void

Form1_Load(

object

sender,

EventArgs

e)
        {
           
this
.dataGridView1.CellValuePushed += dataGridView1_CellValuePushed;
           
this
.dataGridView1.CellValueChanged += datagridview_CellValueChanged;
        }
       
private

void

button1_Click(

object

sender,

EventArgs

e)
        {
            dataGridView1.Columns.Add(CreateCheckInfoColumn());
        }